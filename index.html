<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ΩìÈáçÂ∞èÊú¨Êú¨ üìù</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Patrick+Hand&family=Zeyada&display=swap" rel="stylesheet">
    <style>
        :root {
            --paper: #faf8f3;
            --ink: #2c3e50;
            --mint: #a8e6cf;
            --peach: #ffd3b6;
            --lavender: #d4a5db;
            --sky: #b8d8e0;
            --coral: #ffaaa5;
            --yellow: #fff5ba;
            --shadow: rgba(44, 62, 80, 0.1);
        }

        .dark-mode {
            --paper: #1a1a2e;
            --ink: #e8e8e8;
            --mint: #2d6a4f;
            --peach: #c9a66b;
            --lavender: #6b4c7a;
            --sky: #3a5a6a;
            --coral: #a85a5a;
            --yellow: #9a8a2a;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        /* Ocean Theme */
        .theme-ocean {
            --paper: #e0f7fa;
            --ink: #006064;
            --mint: #4dd0e1;
            --peach: #81d4fa;
            --lavender: #7986cb;
            --sky: #26c6da;
            --coral: #ff7043;
            --yellow: #fff59d;
            --shadow: rgba(0, 96, 100, 0.1);
        }

        /* Forest Theme */
        .theme-forest {
            --paper: #f1f8e9;
            --ink: #1b5e20;
            --mint: #aed581;
            --peach: #ffcc80;
            --lavender: #9575cd;
            --sky: #81c784;
            --coral: #e57373;
            --yellow: #fff176;
            --shadow: rgba(27, 94, 32, 0.1);
        }

        /* Sunset Theme */
        .theme-sunset {
            --paper: #fff3e0;
            --ink: #bf360c;
            --mint: #ffab91;
            --peach: #ffcc80;
            --lavender: #ce93d8;
            --sky: #ff8a65;
            --coral: #ef5350;
            --yellow: #ffd54f;
            --shadow: rgba(191, 54, 12, 0.1);
        }

        /* Berry Theme */
        .theme-berry {
            --paper: #fce4ec;
            --ink: #880e4f;
            --mint: #f48fb1;
            --peach: #ffcc80;
            --lavender: #ce93d8;
            --sky: #f06292;
            --coral: #ef5350;
            --yellow: #fff59d;
            --shadow: rgba(136, 14, 79, 0.1);
        }

        /* Midnight Theme */
        .theme-midnight {
            --paper: #0d1117;
            --ink: #c9d1d9;
            --mint: #238636;
            --peach: #d29922;
            --lavender: #8957e5;
            --sky: #58a6ff;
            --coral: #f85149;
            --yellow: #d29922;
            --shadow: rgba(255, 255, 255, 0.1);
        }

        /* Lavender Dream Theme */
        .theme-lavender {
            --paper: #f3e5f5;
            --ink: #4a148c;
            --mint: #ce93d8;
            --peach: #ffcc80;
            --lavender: #b39ddb;
            --sky: #9fa8da;
            --coral: #f48fb1;
            --yellow: #fff59d;
            --shadow: rgba(74, 20, 140, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Patrick Hand', cursive;
            background: var(--paper);
            color: var(--ink);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Confetti canvas */
        #confettiCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        /* Paper texture */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            z-index: -1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* SVG doodles */
        .svg-doodle {
            position: fixed;
            pointer-events: none;
            z-index: -1;
            opacity: 0.08;
        }

        .doodle-1 { top: 5%; left: 3%; width: 80px; animation: float 25s ease-in-out infinite; }
        .doodle-2 { top: 50%; right: 2%; width: 70px; animation-delay: 8s; animation: float 30s ease-in-out infinite; }
        .doodle-3 { bottom: 10%; left: 5%; width: 60px; animation-delay: 15s; animation: float 20s ease-in-out infinite; }
        .doodle-4 { top: 25%; right: 8%; width: 75px; animation-delay: 5s; animation: float 28s ease-in-out infinite; }
        .doodle-5 { bottom: 30%; right: 15%; width: 50px; animation-delay: 12s; animation: float 22s ease-in-out infinite; }
        .doodle-6 { top: 70%; left: 8%; width: 65px; animation-delay: 18s; animation: float 26s ease-in-out infinite; }
        .doodle-7 { top: 85%; right: 25%; width: 55px; animation-delay: 22s; animation: float 24s ease-in-out infinite; }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-15px) rotate(3deg); }
            50% { transform: translateY(-5px) rotate(-2deg); }
            75% { transform: translateY(-20px) rotate(2deg); }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(1.4); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.5) rotate(-10deg); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }

        /* Ambient Floating Particles */
        .particle {
            position: fixed;
            pointer-events: none;
            z-index: 0;
            opacity: 0.15;
            animation: particleFloat linear infinite;
        }

        .particle-1 { top: 10%; left: 5%; font-size: 1.5rem; animation-duration: 20s; }
        .particle-2 { top: 20%; right: 10%; font-size: 1.2rem; animation-duration: 25s; animation-delay: 5s; }
        .particle-3 { top: 60%; left: 8%; font-size: 1.8rem; animation-duration: 30s; animation-delay: 10s; }
        .particle-4 { top: 80%; right: 15%; font-size: 1.3rem; animation-duration: 22s; animation-delay: 15s; }
        .particle-5 { top: 40%; left: 15%; font-size: 1rem; animation-duration: 28s; animation-delay: 8s; }
        .particle-6 { bottom: 20%; left: 20%; font-size: 1.6rem; animation-duration: 35s; animation-delay: 12s; }
        .particle-7 { top: 15%; left: 50%; font-size: 1.1rem; animation-duration: 18s; animation-delay: 3s; }
        .particle-8 { bottom: 40%; right: 5%; font-size: 1.4rem; animation-duration: 32s; animation-delay: 18s; }

        @keyframes particleFloat {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0.15;
            }
            25% {
                transform: translateY(-30px) translateX(15px) rotate(90deg);
                opacity: 0.25;
            }
            50% {
                transform: translateY(-15px) translateX(-10px) rotate(180deg);
                opacity: 0.15;
            }
            75% {
                transform: translateY(-40px) translateX(20px) rotate(270deg);
                opacity: 0.2;
            }
            100% {
                transform: translateY(0) translateX(0) rotate(360deg);
                opacity: 0.15;
            }
        }

        /* Sparkle Effects */
        .sparkle {
            position: fixed;
            pointer-events: none;
            z-index: 0;
            font-size: 1rem;
            animation: sparkleAnim 3s ease-in-out infinite;
        }

        .sparkle-1 { top: 8%; left: 12%; animation-delay: 0s; }
        .sparkle-2 { top: 25%; right: 8%; animation-delay: 0.5s; }
        .sparkle-3 { top: 45%; left: 6%; animation-delay: 1s; }
        .sparkle-4 { bottom: 30%; right: 12%; animation-delay: 1.5s; }
        .sparkle-5 { top: 65%; left: 18%; animation-delay: 2s; }
        .sparkle-6 { bottom: 15%; left: 25%; animation-delay: 2.5s; }

        @keyframes sparkleAnim {
            0%, 100% {
                opacity: 0;
                transform: scale(0.5) rotate(0deg);
            }
            50% {
                opacity: 0.4;
                transform: scale(1) rotate(180deg);
            }
        }

        /* Gradient Orbs */
        .gradient-orb {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
            filter: blur(60px);
            opacity: 0.1;
            animation: orbFloat 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 300px;
            height: 300px;
            top: -100px;
            left: -100px;
            background: var(--mint);
            animation-delay: 0s;
        }

        .orb-2 {
            width: 250px;
            height: 250px;
            bottom: -80px;
            right: -80px;
            background: var(--lavender);
            animation-delay: 7s;
        }

        .orb-3 {
            width: 200px;
            height: 200px;
            top: 50%;
            right: -50px;
            background: var(--peach);
            animation-delay: 14s;
        }

        @keyframes orbFloat {
            0%, 100% {
                transform: translate(0, 0) scale(1);
            }
            33% {
                transform: translate(30px, -30px) scale(1.1);
            }
            66% {
                transform: translate(-20px, 20px) scale(0.9);
            }
        }

        /* Wave Decoration */
        .wave-decoration {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.05;
        }

        .wave-decoration svg {
            width: 100%;
            height: 100%;
        }

        /* Rain/Sparkle Shower Effect (conditional) */
        .ambient-shower {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .shower-particle {
            position: absolute;
            top: -20px;
            font-size: 0.8rem;
            animation: showerFall linear infinite;
            opacity: 0.2;
        }

        @keyframes showerFall {
            0% {
                transform: translateY(-20px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.2;
            }
            90% {
                opacity: 0.2;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .container {
            max-width: 950px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            text-align: center;
            padding: 40px 20px 30px;
            position: relative;
        }

        h1 {
            font-family: 'Caveat', cursive;
            font-size: 4rem;
            font-weight: 700;
            color: var(--ink);
            position: relative;
            display: inline-block;
            transform: rotate(-2deg);
        }

        h1 svg {
            position: absolute;
            bottom: -15px;
            left: -10%;
            width: 120%;
            height: 30px;
        }

        .subtitle {
            font-family: 'Zeyada', cursive;
            font-size: 1.5rem;
            color: #7f8c8d;
            margin-top: 15px;
            transform: rotate(1deg);
        }

        /* Card */
        .card {
            background: white;
            border-radius: 255px 15px 225px 15px/15px 225px 15px 255px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 5px 5px 0 var(--shadow), inset 0 0 0 2px var(--ink);
            position: relative;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: scale(1.01) rotate(0.3deg);
            box-shadow: 7px 7px 0 var(--shadow), inset 0 0 0 2px var(--ink);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 2px dashed var(--lavender);
            border-radius: 245px 10px 215px 10px/10px 215px 10px 245px;
            pointer-events: none;
        }

        .card-title {
            font-family: 'Caveat', cursive;
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title .icon {
            font-size: 2rem;
            transform: rotate(-12deg);
        }

        /* Form */
        .form-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .input-wrapper {
            position: relative;
        }

        label {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #555;
            transform: rotate(-0.5deg);
        }

        input, textarea {
            width: 100%;
            padding: 14px 18px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.3rem;
            border: 2px solid var(--ink);
            border-radius: 12px 8px 15px 10px/10px 15px 8px 12px;
            background: var(--paper);
            color: var(--ink);
            transition: all 0.2s ease;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        input:focus, textarea:focus {
            outline: none;
            transform: rotate(-0.5deg) scale(1.02);
            box-shadow: 4px 4px 0 var(--mint);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 30px;
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            font-weight: 600;
            background: var(--mint);
            color: var(--ink);
            border: 2px solid var(--ink);
            border-radius: 255px 15px 225px 15px/15px 225px 15px 255px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 4px 4px 0 var(--ink);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            right: 3px;
            bottom: 3px;
            border: 1px dashed rgba(44, 62, 80, 0.3);
            border-radius: 245px 12px 215px 12px/12px 215px 12px 245px;
        }

        .btn:hover {
            transform: translate(-3px, -3px);
            box-shadow: 6px 6px 0 var(--ink);
        }

        .btn:active {
            transform: translate(1px, 1px);
            box-shadow: 3px 3px 0 var(--ink);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-peach { background: var(--peach); }
        .btn-lavender { background: var(--lavender); }
        .btn-sky { background: var(--sky); }
        .btn-coral { background: var(--coral); }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover { transform: none; box-shadow: 4px 4px 0 var(--ink); }
            .btn:active { transform: translate(-2px, -2px); box-shadow: 6px 6px 0 var(--ink); }
            .fab:active { transform: scale(0.95); }
            .photo-item:active { transform: scale(0.98); }
            .badge-item:active { transform: scale(0.98); }
            .stability-tab:active { transform: scale(0.98); }
            .date-range-preset:active { transform: scale(0.98); }
        }

        /* Increase tap targets for touch devices */
        @media (pointer: coarse) {
            .btn { min-height: 44px; min-width: 44px; }
            .delete-btn, .edit-btn { min-width: 44px; min-height: 44px; }
            .fab { min-width: 60px; min-height: 60px; }
            input[type="number"], input[type="date"], select { min-height: 44px; }
            .export-btn { min-height: 44px; }
        }

        /* Streak badge */
        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--yellow) 0%, var(--peach) 100%);
            border: 2px solid var(--ink);
            border-radius: 20px 15px 25px 12px/15px 25px 12px 20px;
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            margin-left: auto;
        }

        .streak-fire {
            font-size: 1.5rem;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Streak Rewards Section */
        .streak-rewards {
            background: linear-gradient(135deg, var(--yellow) 0%, var(--peach) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 1s ease;
        }

        .streak-rewards-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .streak-rewards-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            color: var(--ink);
        }

        .streak-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
        }

        .streak-number {
            font-family: 'Caveat', cursive;
            font-size: 3rem;
            font-weight: 700;
            color: var(--coral);
            text-shadow: 2px 2px 0 var(--shadow);
        }

        .streak-label {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.3rem;
            color: var(--ink);
        }

        .streak-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }

        .streak-level {
            background: white;
            border-radius: 10px;
            border: 2px dashed var(--ink);
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .streak-level.achieved {
            background: var(--mint);
            border-style: solid;
            animation: popIn 0.3s ease;
        }

        .streak-level.current {
            background: var(--sky);
            border-style: solid;
            border-width: 3px;
            animation: pulse 1s ease-in-out infinite;
        }

        .streak-level-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .streak-level-label {
            font-family: 'Patrick Hand', cursive;
            font-size: 0.9rem;
            color: var(--ink);
        }

        .streak-level-reward {
            font-family: 'Caveat', cursive;
            font-size: 1rem;
            color: var(--coral);
            margin-top: 5px;
        }

        /* Weight Achievement Badges */
        .weight-badges {
            background: linear-gradient(135deg, var(--pink) 0%, var(--coral) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 1.2s ease;
        }

        .weight-badges-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .weight-badges-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            color: var(--ink);
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 12px;
        }

        .badge-item {
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .badge-item.achieved {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-style: solid;
            border-width: 3px;
            animation: popIn 0.5s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .badge-item.locked {
            opacity: 0.5;
            filter: grayscale(0.8);
        }

        .badge-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
            display: block;
        }

        .badge-item.achieved .badge-icon {
            animation: wiggle 2s ease-in-out infinite;
        }

        .badge-label {
            font-family: 'Patrick Hand', cursive;
            font-size: 0.85rem;
            color: var(--ink);
        }

        .badge-target {
            font-family: 'Caveat', cursive;
            font-size: 0.95rem;
            color: var(--coral);
            margin-top: 3px;
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 18px;
            background: linear-gradient(135deg, var(--paper) 0%, white 100%);
            border: 2px solid var(--ink);
            border-radius: 20px 15px 25px 12px/15px 25px 12px 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px) rotate(1deg);
            box-shadow: 5px 5px 0 var(--shadow);
        }

        .stat-icon {
            font-size: 1.6rem;
            margin-bottom: 8px;
            display: block;
        }

        .stat-value {
            font-family: 'Caveat', cursive;
            font-size: 2rem;
            font-weight: 700;
            color: var(--ink);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }

        /* Weekly summary cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .summary-card {
            padding: 15px;
            background: linear-gradient(135deg, var(--sky) 0%, var(--mint) 50%);
            border: 2px dashed var(--ink);
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: scale(1.05);
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .summary-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .summary-value {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            font-weight: 600;
        }

        .summary-label {
            font-size: 0.85rem;
            color: #555;
            margin-top: 3px;
        }

        /* Trend section */
        .trend-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .trend-card {
            padding: 15px;
            background: var(--paper);
            border: 2px dashed var(--ink);
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .trend-card:hover {
            transform: translateY(-3px);
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .trend-period {
            font-size: 0.95rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .trend-value {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            font-weight: 600;
        }

        .trend-value.up { color: #e74c3c; }
        .trend-value.down { color: #27ae60; }
        .trend-value.neutral { color: #7f8c8d; }

        /* BMI Indicator */
        .bmi-indicator {
            margin-top: 20px;
            padding: 20px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
        }

        .bmi-bar {
            height: 30px;
            background: linear-gradient(to right,
                #3498db 0%, #3498db 18.5%,
                #2ecc71 18.5%, #2ecc71 25%,
                #27ae60 25%, #27ae60 30%,
                #f1c40f 30%, #f1c40f 35%,
                #e67e22 35%, #e67e22 45%,
                #e74c3c 45%, #e74c3c 100%
            );
            border-radius: 15px;
            position: relative;
            border: 2px solid var(--ink);
        }

        .bmi-marker {
            position: absolute;
            top: -10px;
            width: 4px;
            height: 50px;
            background: var(--ink);
            transform: translateX(-50%);
            transition: left 0.5s ease;
        }

        .bmi-marker::after {
            content: '‚ñº';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
        }

        .bmi-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.8rem;
            color: #555;
        }

        /* Goal progress */
        .goal-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--yellow) 0%, var(--peach) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
        }

        .goal-section.achieved {
            background: linear-gradient(135deg, var(--mint) 0%, var(--sky) 100%);
            animation: celebrate 0.5s ease;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .goal-title {
            font-family: 'Caveat', cursive;
            font-size: 1.8rem;
        }

        .goal-progress-bar {
            height: 25px;
            background: rgba(255,255,255,0.7);
            border-radius: 15px;
            border: 2px solid var(--ink);
            overflow: hidden;
            position: relative;
        }

        .goal-progress-fill {
            height: 100%;
            background: var(--mint);
            transition: width 0.5s ease;
            position: relative;
        }

        .goal-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(0,0,0,0.05) 10px,
                rgba(0,0,0,0.05) 20px
            );
        }

        /* Weight list */
        .weight-list {
            list-style: none;
            max-height: 420px;
            overflow-y: auto;
        }

        .weight-item {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            gap: 15px;
            padding: 15px;
            margin: 12px 0;
            background: var(--paper);
            border-radius: 12px 15px 10px 14px/15px 10px 14px 12px;
            border: 2px dashed var(--ink);
            align-items: center;
            transition: all 0.2s ease;
            position: relative;
        }

        .weight-item:hover {
            transform: translateX(5px) rotate(-0.5deg);
            background: var(--yellow);
            border-style: solid;
        }

        .weight-item-main {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .weight-date {
            font-size: 1.1rem;
            color: #555;
        }

        .weight-note {
            font-size: 0.85rem;
            color: #7f8c8d;
            font-style: italic;
        }

        .weight-value {
            font-family: 'Caveat', cursive;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--ink);
        }

        .weight-change {
            font-size: 1.2rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 15px;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            transition: all 0.3s ease;
        }

        .weight-change.positive {
            color: white;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 3px 10px rgba(231, 76, 60, 0.3);
        }

        .weight-change.negative {
            color: white;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);
        }

        .weight-change.neutral {
            color: white;
            background: linear-gradient(135deg, #7f8c8d 0%, #6c7a7b 100%);
        }

        .weight-change:hover {
            transform: scale(1.05);
        }

        .weight-trend-icon {
            font-size: 1rem;
            animation: bounce 1s ease-in-out infinite;
        }

        .weight-change.positive .weight-trend-icon {
            animation: shake 0.5s ease-in-out infinite;
        }

        .weight-change.negative .weight-trend-icon {
            animation: wiggle 0.5s ease-in-out infinite;
        }

        .weight-actions {
            display: flex;
            gap: 5px;
        }

        .delete-btn, .edit-btn {
            background: var(--coral);
            border: 2px solid var(--ink);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s ease;
            color: var(--ink);
        }

        .edit-btn {
            background: var(--sky);
        }

        .delete-btn:hover, .edit-btn:hover {
            transform: scale(1.2) rotate(15deg);
        }

        /* Chart */
        .chart-container {
            height: 280px;
            position: relative;
            margin-top: 20px;
            padding: 15px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        /* BMI Chart Section */
        .bmi-chart-section {
            background: linear-gradient(135deg, var(--lavender) 0%, var(--pink) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 1.1s ease;
        }

        .bmi-chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .bmi-chart-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bmi-chart-container {
            height: 250px;
            position: relative;
            padding: 15px;
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
        }

        .bmi-zones {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .bmi-zone {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-family: 'Patrick Hand', cursive;
        }

        .bmi-zone-underweight { background: #3498db; color: white; }
        .bmi-zone-normal { background: #2ecc71; color: white; }
        .bmi-zone-overweight { background: #f39c12; color: white; }
        .bmi-zone-obese { background: #e74c3c; color: white; }

        /* Date Range Filter */
        .date-range-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .date-range-filter-label {
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            color: var(--ink);
            font-weight: 600;
        }

        .date-range-preset {
            padding: 8px 15px;
            background: var(--paper);
            border: 2px solid var(--ink);
            border-radius: 10px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .date-range-preset:hover {
            transform: scale(1.05) rotate(-1deg);
            background: var(--mint);
        }

        .date-range-preset.active {
            background: var(--coral);
            color: white;
            transform: scale(1.05);
        }

        .date-range-custom {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-range-custom input {
            padding: 8px 12px;
            border: 2px solid var(--ink);
            border-radius: 8px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
        }

        .date-range-custom button {
            padding: 8px 15px;
            background: var(--sky);
            border: 2px solid var(--ink);
            border-radius: 10px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .date-range-custom button:hover {
            transform: scale(1.05);
            background: var(--lavender);
        }

        /* Export Buttons */
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 10px 18px;
            background: var(--sky);
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .export-btn:hover {
            transform: scale(1.02);
            background: var(--mint);
        }

        .export-btn-primary {
            background: var(--coral);
            color: white;
        }

        .export-btn-icon {
            font-size: 1.2rem;
        }

        /* Keyboard Shortcuts Help */
        .shortcuts-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .shortcuts-overlay.active {
            display: flex;
        }

        .shortcuts-content {
            background: white;
            border-radius: 20px;
            border: 3px solid var(--ink);
            padding: 30px;
            max-width: 90%;
            width: 450px;
            max-height: 80vh;
            overflow-y: auto;
            animation: popIn 0.3s ease;
        }

        .shortcuts-title {
            font-family: 'Caveat', cursive;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 20px;
        }

        .shortcuts-list {
            display: grid;
            gap: 12px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: var(--paper);
            border-radius: 10px;
            border: 2px solid var(--ink);
        }

        .shortcut-desc {
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            color: var(--ink);
        }

        .shortcut-keys {
            display: flex;
            gap: 5px;
        }

        .shortcut-key {
            background: white;
            border: 2px solid var(--ink);
            border-radius: 6px;
            padding: 5px 10px;
            font-family: monospace;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 2px 0 var(--shadow);
        }

        .shortcuts-close {
            width: 100%;
            margin-top: 20px;
            padding: 12px 20px;
            background: var(--coral);
            border: 2px solid var(--ink);
            border-radius: 10px;
            color: white;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .shortcuts-close:hover {
            background: var(--pink);
            transform: scale(1.02);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #95a5a6;
        }

        .empty-state .emoji {
            font-size: 5rem;
            margin-bottom: 15px;
            display: block;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        .empty-state p {
            font-size: 1.4rem;
            font-family: 'Zeyada', cursive;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 255px 15px 225px 15px/15px 225px 15px 255px;
            border: 3px solid var(--ink);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--coral);
            border: 2px solid var(--ink);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--ink);
        }

        /* Tape */
        .tape {
            position: absolute;
            width: 90px;
            height: 28px;
            background: rgba(255, 255, 255, 0.8);
            top: -12px;
            transform: rotate(-3deg);
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }

        .tape-left { left: 15%; }
        .tape-right { right: 15%; transform: rotate(2deg); }

        /* Sticker */
        .sticker {
            position: absolute;
            font-size: 2rem;
            opacity: 0.8;
            filter: drop-shadow(2px 2px 0 rgba(0,0,0,0.2));
        }

        .sticker-1 { top: -15px; right: 30px; transform: rotate(15deg); }
        .sticker-2 { bottom: -10px; left: 20px; transform: rotate(-10deg); }

        /* Motivation */
        .motivation {
            text-align: center;
            padding: 20px;
            font-family: 'Zeyada', cursive;
            font-size: 1.4rem;
            color: #555;
            background: linear-gradient(135deg, var(--sky) 0%, var(--mint) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .motivation:hover {
            transform: scale(1.02);
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; }
            .container { padding: 15px; }
            .card { padding: 20px; }
            .form-section { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
            .weight-item { grid-template-columns: 1fr auto; gap: 8px; }
            .btn-group { flex-direction: column; }
            .streak-badge { margin-left: 0; margin-top: 10px; }
            .summary-cards { grid-template-columns: 1fr 1fr; }
            .fab { bottom: 20px; right: 20px; width: 55px; height: 55px; }
            .fab-icon { font-size: 1.5rem; }
            .chart-container { height: 220px; }
            .photo-grid { grid-template-columns: repeat(2, 1fr); }
            .badges-grid { grid-template-columns: repeat(4, 1fr); }
            .stability-metrics { grid-template-columns: 1fr; }
            .before-after-comparison { grid-template-columns: 1fr; gap: 10px; }
            .date-range-filter { flex-direction: column; align-items: stretch; }
            .date-range-custom { flex-direction: column; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
            .container { padding: 10px; }
            .card { padding: 15px; }
            .stats-grid { grid-template-columns: 1fr; }
            .weight-value { font-size: 1rem; }
            .weight-change { font-size: 1rem; padding: 3px 8px; }
            .btn { padding: 10px 15px; font-size: 0.95rem; }
            .fab { bottom: 15px; right: 15px; width: 50px; height: 50px; }
            .fab-tooltip { display: none; }
            .modal-content { max-width: 95%; padding: 20px; }
            .photo-grid { grid-template-columns: 1fr; }
            .badges-grid { grid-template-columns: repeat(3, 1fr); }
            .streak-levels { grid-template-columns: repeat(3, 1fr); }
            .quick-stats { display: none; }
            .chart-container { height: 180px; }
        }

        @media (max-width: 600px) {
            .weight-change { font-size: 1rem; }
            .share-modal-content { width: 95%; }
            .shortcuts-content { width: 95%; }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px var(--mint); }
            50% { box-shadow: 0 0 20px var(--mint), 0 0 30px var(--mint); }
        }

        .card { animation: slideIn 0.5s ease forwards; }
        .stat-item { animation: slideIn 0.5s ease forwards; }
        .stat-item:nth-child(2) { animation-delay: 0.1s; }
        .stat-item:nth-child(3) { animation-delay: 0.2s; }
        .stat-item:nth-child(4) { animation-delay: 0.3s; }
        .stat-item:nth-child(5) { animation-delay: 0.4s; }

        .shake { animation: shake 0.5s ease; }
        .glow { animation: glow 2s ease-in-out infinite; }

        /* Export buttons */
        .export-section {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 8px 16px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            background: var(--sky);
            color: var(--ink);
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 3px 3px 0 var(--ink);
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--shadow);
            border-top-color: var(--ink);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Prediction badge */
        .prediction-badge {
            display: inline-block;
            padding: 5px 12px;
            background: linear-gradient(135deg, var(--lavender) 0%, var(--sky) 100%);
            border: 1px solid var(--ink);
            border-radius: 15px;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        .prediction-value {
            font-family: 'Caveat', cursive;
            font-weight: 600;
        }

        /* Theme Switcher */
        .theme-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .theme-toggle-btn {
            width: 60px;
            height: 60px;
            background: var(--yellow);
            border: 3px solid var(--ink);
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 3px 3px 0 var(--ink);
        }

        .theme-toggle-btn:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 5px 5px 0 var(--ink);
        }

        .theme-panel {
            position: absolute;
            top: 70px;
            right: 0;
            background: white;
            border: 3px solid var(--ink);
            border-radius: 20px;
            padding: 20px;
            min-width: 280px;
            box-shadow: 5px 5px 0 var(--shadow);
            opacity: 0;
            transform: scale(0.8) translateY(-10px);
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .theme-panel.active {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: all;
        }

        .theme-panel-title {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 15px;
            color: var(--ink);
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .theme-option {
            background: var(--paper);
            border: 2px dashed var(--ink);
            border-radius: 12px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .theme-option:hover {
            transform: scale(1.05);
            border-style: solid;
            box-shadow: 2px 2px 0 var(--shadow);
        }

        .theme-option.active {
            border-style: solid;
            border-width: 3px;
            background: var(--mint);
        }

        .theme-preview {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--ink);
        }

        .theme-option span:last-child {
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Mood selector */
        .mood-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .mood-option {
            width: 50px;
            height: 50px;
            border: 2px dashed var(--ink);
            border-radius: 50%;
            background: var(--paper);
            cursor: pointer;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .mood-option:hover {
            transform: scale(1.15) rotate(10deg);
            border-style: solid;
            background: var(--mint);
        }

        .mood-option.selected {
            border-style: solid;
            background: var(--peach);
            transform: scale(1.1);
            box-shadow: 0 0 10px var(--peach);
        }

        /* Calendar heatmap */
        .calendar-heatmap {
            margin-top: 20px;
            padding: 20px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
        }

        .heatmap-title {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            max-width: 350px;
            margin: 0 auto;
        }

        .heatmap-day {
            aspect-ratio: 1;
            border-radius: 4px;
            border: 1px solid var(--ink);
            position: relative;
            transition: all 0.2s ease;
        }

        .heatmap-day:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        .heatmap-day.empty {
            background: transparent;
        }

        .heatmap-day.level-1 {
            background: var(--sky);
            opacity: 0.4;
        }

        .heatmap-day.level-2 {
            background: var(--sky);
            opacity: 0.6;
        }

        .heatmap-day.level-3 {
            background: var(--mint);
            opacity: 0.8;
        }

        .heatmap-day.level-4 {
            background: var(--mint);
            opacity: 1;
        }

        .heatmap-day.level-5 {
            background: linear-gradient(135deg, var(--mint) 0%, var(--sky) 100%);
        }

        .heatmap-day.today {
            border: 2px solid var(--coral);
            box-shadow: 0 0 8px var(--coral);
        }

        .heatmap-labels {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 5px;
            font-size: 0.75rem;
            text-align: center;
            color: #7f8c8d;
        }

        /* Health insights */
        .health-insights {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--lavender) 0%, var(--sky) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
        }

        .insight-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-tips {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .insight-tip {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
            border: 1px dashed var(--ink);
        }

        .tip-icon {
            font-size: 1.5rem;
        }

        .tip-content {
            flex: 1;
        }

        .tip-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .tip-text {
            font-size: 0.95rem;
            color: #555;
        }

        .tip-positive {
            border-left: 4px solid #27ae60;
            background: linear-gradient(90deg, rgba(39, 174, 96, 0.1) 0%, transparent 100%);
        }

        .tip-warning {
            border-left: 4px solid #f1c40f;
            background: linear-gradient(90deg, rgba(241, 196, 15, 0.1) 0%, transparent 100%);
        }

        .tip-alert {
            border-left: 4px solid #e74c3c;
            background: linear-gradient(90deg, rgba(231, 76, 60, 0.1) 0%, transparent 100%);
        }

        .tip-info {
            border-left: 4px solid #3498db;
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.1) 0%, transparent 100%);
        }

        /* Smart Insights Panel */
        .smart-insights {
            margin-top: 20px;
            padding: 20px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
            animation: slideInUp 0.5s ease;
        }

        .insights-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .insights-header h3 {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-badge {
            padding: 4px 10px;
            background: var(--mint);
            border-radius: 15px;
            font-size: 0.75rem;
            border: 1px solid var(--ink);
        }

        .insight-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .insight-card {
            padding: 15px;
            background: white;
            border-radius: 12px;
            border: 2px solid var(--ink);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }

        .insight-card:hover {
            transform: translateY(-3px);
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .insight-card-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .insight-card-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 5px;
        }

        .insight-card-value {
            font-family: 'Caveat', cursive;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--ink);
        }

        .insight-card-trend {
            font-size: 0.8rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .trend-up { color: #27ae60; }
        .trend-down { color: #e74c3c; }
        .trend-stable { color: #7f8c8d; }

        /* Prediction Chart */
        .prediction-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--peach) 0%, var(--yellow) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            animation: slideInUp 0.6s ease;
        }

        .prediction-header {
            font-family: 'Caveat', cursive;
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prediction-cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .prediction-card {
            flex: 1;
            min-width: 140px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            text-align: center;
            transition: all 0.3s ease;
        }

        .prediction-card:hover {
            transform: scale(1.05);
        }

        .prediction-card-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .prediction-card-value {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--accent);
        }

        .prediction-card-emoji {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        /* Weekly Report Card */
        .weekly-report {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--mint) 0%, var(--sky) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            animation: slideInUp 0.7s ease;
        }

        .report-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .report-title {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-period {
            font-size: 0.85rem;
            color: #666;
            padding: 5px 12px;
            background: white;
            border-radius: 15px;
            border: 1px solid var(--ink);
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .report-item {
            padding: 12px;
            background: white;
            border-radius: 10px;
            border: 1px dashed var(--ink);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-item-icon {
            font-size: 1.3rem;
        }

        .report-item-content {
            flex: 1;
        }

        .report-item-label {
            font-size: 0.75rem;
            color: #666;
        }

        .report-item-value {
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* Celebration Effects */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3000;
            display: none;
        }

        .celebration-overlay.active {
            display: block;
        }

        .milestone-card {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 25px;
            border: 4px dashed var(--ink);
            box-shadow: 8px 8px 0 var(--shadow);
            text-align: center;
            z-index: 3001;
            animation: bounceIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            min-width: 300px;
        }

        .milestone-emoji {
            font-size: 5rem;
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }

        .milestone-title {
            font-family: 'Caveat', cursive;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .milestone-message {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
        }

        .milestone-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .milestone-stat {
            text-align: center;
        }

        .milestone-stat-value {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .milestone-stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        .milestone-close {
            padding: 10px 30px;
            background: var(--mint);
            border: 2px solid var(--ink);
            border-radius: 15px;
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .milestone-close:hover {
            transform: scale(1.05);
            background: var(--sky);
        }

        /* Notification System */
        .notification-container {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .notification {
            background: white;
            border: 3px solid var(--ink);
            border-radius: 15px;
            padding: 15px 20px;
            min-width: 280px;
            max-width: 350px;
            box-shadow: 4px 4px 0 var(--shadow);
            pointer-events: all;
            animation: slideInRight 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .notification::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: var(--mint);
        }

        .notification.success::before { background: var(--mint); }
        .notification.warning::before { background: var(--yellow); }
        .notification.error::before { background: var(--coral); }
        .notification.info::before { background: var(--sky); }
        .notification.achievement::before { background: linear-gradient(to bottom, var(--yellow), var(--peach)); }

        .notification-icon {
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .notification-close {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            opacity: 0.5;
            transition: opacity 0.2s;
        }

        .notification-close:hover {
            opacity: 1;
        }

        .notification.removing {
            animation: slideOutRight 0.3s ease forwards;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        /* Quick Stats Widget */
        .quick-stats-widget {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            border: 3px solid var(--ink);
            border-radius: 20px;
            padding: 15px 20px;
            box-shadow: 4px 4px 0 var(--shadow);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }

        .quick-stats-widget:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 0 var(--shadow);
        }

        .quick-stats-widget.expanded {
            border-radius: 20px;
            padding: 20px;
        }

        .quick-stats-icon {
            font-size: 2rem;
            animation: pulse 2s ease-in-out infinite;
        }

        .quick-stats-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .quick-stats-label {
            font-size: 0.8rem;
            color: #666;
        }

        .quick-stats-value {
            font-family: 'Caveat', cursive;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .quick-stats-trend {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .quick-stats-trend.up { color: #27ae60; }
        .quick-stats-trend.down { color: #e74c3c; }
        .quick-stats-trend.neutral { color: #7f8c8d; }

        /* Period Comparison Card */
        .period-comparison {
            background: linear-gradient(135deg, var(--sky) 0%, var(--lavender) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 0.5s ease;
        }

        .comparison-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .comparison-title {
            font-family: 'Caveat', cursive;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .comparison-periods {
            display: flex;
            gap: 10px;
            font-size: 0.85rem;
        }

        .comparison-period-btn {
            padding: 6px 12px;
            background: white;
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .comparison-period-btn:hover {
            transform: scale(1.05);
        }

        .comparison-period-btn.active {
            background: var(--mint);
            border-width: 3px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .comparison-item {
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            padding: 15px;
            text-align: center;
        }

        .comparison-item-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .comparison-item-value {
            font-family: 'Caveat', cursive;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .comparison-item-change {
            font-size: 0.85rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .comparison-item-change.positive { color: #27ae60; }
        .comparison-item-change.negative { color: #e74c3c; }
        .comparison-item-change.neutral { color: #7f8c8d; }

        /* Goal Calculator */
        .goal-calculator {
            background: linear-gradient(135deg, var(--coral) 0%, var(--pink) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 0.5s ease;
        }

        .goal-calc-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .goal-calc-title {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
        }

        .goal-calc-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .goal-calc-input-group {
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            padding: 12px;
        }

        .goal-calc-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }

        .goal-calc-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--ink);
            border-radius: 10px;
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
        }

        .goal-calc-btn {
            width: 100%;
            padding: 12px;
            background: var(--mint);
            border: 2px solid var(--ink);
            border-radius: 12px;
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .goal-calc-btn:hover {
            background: var(--sky);
            transform: translateY(-2px);
        }

        .goal-calc-results {
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .goal-calc-results.show {
            display: block;
            animation: slideInUp 0.3s ease;
        }

        .goal-result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed var(--ink);
        }

        .goal-result-row:last-child {
            border-bottom: none;
        }

        .goal-result-label {
            font-size: 0.9rem;
            color: #666;
        }

        .goal-result-value {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent);
        }

        /* Body Fat Calculator */
        .body-fat-calculator {
            background: linear-gradient(135deg, var(--lavender) 0%, var(--pink) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 0.7s ease;
        }

        .body-fat-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .body-fat-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            color: var(--ink);
        }

        .body-fat-formula {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .body-fat-formula-btn {
            padding: 8px 15px;
            background: white;
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            transition: all 0.2s ease;
        }

        .body-fat-formula-btn:hover {
            transform: scale(1.05);
        }

        .body-fat-formula-btn.active {
            background: var(--lavender);
            border-width: 3px;
        }

        .body-fat-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .body-fat-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .body-fat-label {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
            color: var(--ink);
        }

        .body-fat-input {
            padding: 10px 15px;
            border: 2px solid var(--ink);
            border-radius: 10px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
            background: white;
        }

        .body-fat-calculate-btn {
            width: 100%;
            padding: 12px 20px;
            background: var(--sky);
            border: 2px solid var(--ink);
            border-radius: 10px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .body-fat-calculate-btn:hover {
            transform: scale(1.02);
            background: var(--mint);
        }

        .body-fat-results {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px dashed var(--ink);
            display: none;
        }

        .body-fat-results.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .body-fat-result-value {
            font-family: 'Caveat', cursive;
            font-size: 2rem;
            color: var(--coral);
            text-align: center;
            margin-bottom: 10px;
        }

        .body-fat-result-category {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.3rem;
            text-align: center;
            color: var(--ink);
            margin-bottom: 15px;
        }

        .body-fat-ranges {
            display: grid;
            gap: 8px;
            font-size: 0.9rem;
        }

        .body-fat-range {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .body-fat-range.current {
            background: var(--mint);
            font-weight: 600;
        }

        /* Milestone Tracker */
        .milestone-tracker {
            background: linear-gradient(135deg, var(--yellow) 0%, var(--coral) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 0.8s ease;
        }

        .milestone-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .milestone-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            color: var(--ink);
        }

        .milestone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }

        .milestone-item {
            background: white;
            border-radius: 10px;
            border: 2px dashed var(--ink);
            padding: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .milestone-item.achieved {
            background: var(--mint);
            border-style: solid;
            animation: popIn 0.3s ease;
        }

        .milestone-item.locked {
            opacity: 0.5;
            filter: grayscale(0.5);
        }

        .milestone-icon {
            font-size: 1.5rem;
        }

        .milestone-label {
            font-size: 0.75rem;
            margin-top: 5px;
            font-family: 'Patrick Hand', cursive;
        }

        .milestone-progress {
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            border: 2px dashed var(--ink);
        }

        .milestone-progress-bar {
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
            border: 2px solid var(--ink);
        }

        .milestone-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--mint) 0%, var(--coral) 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--ink);
        }

        /* Progress Photo Gallery */
        .photo-gallery {
            background: linear-gradient(135deg, var(--pink) 0%, var(--lavender) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 0.9s ease;
        }

        .photo-gallery-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .photo-gallery-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .photo-upload-btn {
            padding: 10px 20px;
            background: var(--sky);
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .photo-upload-btn:hover {
            transform: scale(1.05);
            background: var(--mint);
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .photo-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--ink);
            background: white;
            transition: all 0.3s ease;
        }

        .photo-item:hover {
            transform: scale(1.03) rotate(1deg);
            box-shadow: 5px 5px 0 var(--shadow);
        }

        .photo-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .photo-item-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            padding: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .photo-date {
            color: white;
            font-size: 0.85rem;
            font-family: 'Patrick Hand', cursive;
        }

        .photo-weight {
            color: var(--mint);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .photo-delete {
            background: rgba(231, 76, 60, 0.8);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .photo-delete:hover {
            background: #e74c3c;
            transform: scale(1.1);
        }

        .photo-empty {
            text-align: center;
            padding: 40px;
            color: white;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
        }

        .photo-empty-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Before/After Comparison */
        .before-after-section {
            background: linear-gradient(135deg, var(--sky) 0%, var(--mint) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 1.3s ease;
        }

        .before-after-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .before-after-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .before-after-selectors {
            display: flex;
            gap: 10px;
        }

        .before-after-btn {
            padding: 8px 15px;
            background: white;
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            transition: all 0.2s ease;
        }

        .before-after-btn:hover {
            transform: scale(1.02);
            background: var(--mint);
        }

        .before-after-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .comparison-side {
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            padding: 15px;
            text-align: center;
        }

        .comparison-label {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
            color: var(--ink);
            margin-bottom: 10px;
        }

        .comparison-image {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid var(--ink);
        }

        .comparison-info {
            margin-top: 10px;
            font-family: 'Caveat', cursive;
        }

        .comparison-date {
            font-size: 1.1rem;
            color: #7f8c8d;
        }

        .comparison-weight {
            font-size: 1.4rem;
            color: var(--coral);
            font-weight: 600;
        }

        .comparison-diff {
            margin-top: 15px;
            padding: 10px;
            background: linear-gradient(135deg, var(--yellow) 0%, var(--peach) 100%);
            border-radius: 10px;
            border: 2px solid var(--ink);
            grid-column: 1 / -1;
        }

        .comparison-diff-value {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            text-align: center;
            color: var(--ink);
        }

        .comparison-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            color: white;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
        }

        /* Weight Stability Indicator */
        .stability-indicator {
            background: linear-gradient(135deg, var(--mint) 0%, var(--sky) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 1.4s ease;
        }

        .stability-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stability-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            color: var(--ink);
        }

        .staturity-period-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stability-tab {
            padding: 8px 15px;
            background: white;
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            transition: all 0.2s ease;
        }

        .stability-tab.active {
            background: var(--coral);
            color: white;
        }

        .stability-tab:hover:not(.active) {
            background: var(--mint);
        }

        .stability-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px dashed var(--ink);
        }

        .stability-main {
            text-align: center;
            margin-bottom: 15px;
        }

        .stability-icon {
            font-size: 4rem;
            display: block;
            margin-bottom: 10px;
        }

        .stability-status {
            font-family: 'Caveat', cursive;
            font-size: 1.8rem;
            color: var(--ink);
            margin-bottom: 5px;
        }

        .stability-description {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
            color: #7f8c8d;
        }

        .stability-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .stability-metric {
            text-align: center;
            padding: 10px;
            background: var(--paper);
            border-radius: 10px;
            border: 2px solid var(--ink);
        }

        .stability-metric-label {
            font-family: 'Patrick Hand', cursive;
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .stability-metric-value {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            color: var(--coral);
            font-weight: 600;
        }

        /* Share Buttons */
        .share-btn {
            padding: 8px 16px;
            background: var(--sky);
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .share-btn:hover {
            transform: scale(1.05);
            background: var(--mint);
        }

        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .share-modal.active {
            display: flex;
        }

        .share-modal-content {
            background: white;
            border-radius: 15px;
            border: 3px solid var(--ink);
            padding: 25px;
            max-width: 90%;
            width: 400px;
            animation: popIn 0.3s ease;
        }

        .share-modal-title {
            font-family: 'Caveat', cursive;
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 15px;
        }

        .share-preview {
            background: linear-gradient(135deg, var(--mint) 0%, var(--sky) 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .share-preview-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .share-preview-text {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
            color: var(--ink);
            margin-bottom: 5px;
        }

        .share-preview-stats {
            font-family: 'Caveat', cursive;
            font-size: 1.4rem;
            color: var(--coral);
            font-weight: 600;
        }

        .share-options {
            display: grid;
            gap: 10px;
        }

        .share-option {
            padding: 12px 20px;
            background: var(--paper);
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .share-option:hover {
            transform: scale(1.02);
            background: var(--mint);
        }

        .share-option-icon {
            font-size: 1.3rem;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--coral) 0%, var(--pink) 100%);
            border: 3px solid var(--ink);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 4px 4px 0 var(--shadow);
            z-index: 999;
            transition: all 0.3s ease;
            animation: bounce 2s ease-in-out infinite;
        }

        .fab:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 6px 6px 0 var(--shadow);
        }

        .fab:active {
            transform: scale(0.95);
            box-shadow: 2px 2px 0 var(--shadow);
        }

        .fab-icon {
            font-size: 1.8rem;
            color: white;
        }

        .fab-tooltip {
            position: absolute;
            right: 70px;
            background: var(--ink);
            color: white;
            padding: 8px 15px;
            border-radius: 10px;
            font-family: 'Patrick Hand', cursive;
            font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .fab-tooltip::after {
            content: '';
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            border: 8px solid transparent;
            border-left-color: var(--ink);
        }

        .fab:hover .fab-tooltip {
            opacity: 1;
            right: 75px;
        }

        /* Quick Add Modal */
        .quick-add-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .quick-add-modal.active {
            display: flex;
        }

        .quick-add-content {
            background: white;
            border-radius: 20px;
            border: 3px solid var(--ink);
            padding: 30px;
            max-width: 90%;
            width: 350px;
            animation: popIn 0.3s ease;
        }

        .quick-add-title {
            font-family: 'Caveat', cursive;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 20px;
        }

        .quick-add-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--ink);
            border-radius: 15px;
            font-size: 2rem;
            text-align: center;
            font-family: 'Caveat', cursive;
            margin-bottom: 20px;
        }

        .quick-add-input:focus {
            outline: none;
            border-color: var(--coral);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
        }

        .quick-add-buttons {
            display: flex;
            gap: 10px;
        }

        .quick-add-btn {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid var(--ink);
            border-radius: 12px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-add-btn-primary {
            background: var(--coral);
            color: white;
        }

        .quick-add-btn-primary:hover {
            background: var(--pink);
            transform: scale(1.02);
        }

        .quick-add-btn-secondary {
            background: var(--paper);
        }

        .quick-add-btn-secondary:hover {
            background: var(--mint);
            transform: scale(1.02);
        }

        /* Statistics Dashboard */
        .stats-dashboard {
            background: linear-gradient(135deg, var(--yellow) 0%, var(--mint) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            padding: 20px;
            margin-top: 20px;
            animation: slideInUp 0.6s ease;
        }

        .stats-dashboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .stats-dashboard-title {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-time-range {
            display: flex;
            gap: 8px;
        }

        .stats-range-btn {
            padding: 6px 12px;
            background: white;
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .stats-range-btn:hover {
            transform: scale(1.05);
        }

        .stats-range-btn.active {
            background: var(--coral);
            border-width: 3px;
        }

        .stats-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .stat-metric {
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            padding: 15px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .stat-metric:hover {
            transform: translateY(-3px);
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .stat-metric-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .stat-metric-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-metric-value {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            font-weight: 600;
        }

        .stat-metric-change {
            font-size: 0.8rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
        }

        .stat-metric-change.positive { color: #27ae60; }
        .stat-metric-change.negative { color: #e74c3c; }
        .stat-metric-change.neutral { color: #7f8c8d; }

        /* Reminder System */
        .reminder-banner {
            background: linear-gradient(135deg, var(--sky) 0%, var(--lavender) 100%);
            border: 2px solid var(--ink);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideInDown 0.5s ease;
        }

        .reminder-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .reminder-icon {
            font-size: 2rem;
            animation: pulse 2s ease-in-out infinite;
        }

        .reminder-text {
            flex: 1;
        }

        .reminder-title {
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .reminder-subtitle {
            font-size: 0.85rem;
            color: #666;
        }

        .reminder-actions {
            display: flex;
            gap: 10px;
        }

        .reminder-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .reminder-btn:hover {
            transform: scale(1.05);
            background: var(--mint);
        }

        .reminder-close {
            padding: 6px 10px;
            background: none;
            border: 2px solid var(--ink);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }

        .reminder-close:hover {
            background: var(--peach);
        }

        /* Floating action button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--mint) 0%, var(--sky) 100%);
            border: 3px solid var(--ink);
            border-radius: 50%;
            cursor: pointer;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.3s ease;
            box-shadow: 4px 4px 0 var(--ink);
        }

        .fab:hover {
            transform: scale(1.15) rotate(90deg);
            box-shadow: 6px 6px 0 var(--ink);
        }

        .fab-menu {
            position: fixed;
            bottom: 110px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 99;
        }

        .fab-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.3s ease;
        }

        .fab-menu-item.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .fab-menu-btn {
            width: 50px;
            height: 50px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: white;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 2px 2px 0 var(--ink);
        }

        .fab-menu-btn:hover {
            transform: scale(1.1);
        }

        .fab-menu-label {
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            padding: 5px 10px;
            background: white;
            border: 1px solid var(--ink);
            border-radius: 10px;
        }

        /* Mood display in list */
        .mood-display {
            font-size: 1.2rem;
        }

        /* Stats summary */
        .stats-summary {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .summary-stat {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            background: var(--paper);
            border: 2px dashed var(--ink);
            border-radius: 15px;
            text-align: center;
        }

        .summary-stat-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .summary-stat-value {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .summary-stat-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 3px;
        }

        /* Weight distribution chart */
        .distribution-chart {
            margin-top: 15px;
            padding: 15px;
            background: var(--paper);
            border-radius: 10px;
            border: 1px dashed var(--ink);
        }

        .distribution-bar {
            height: 20px;
            background: linear-gradient(to right,
                var(--coral) 0%, var(--coral) 20%,
                var(--yellow) 20%, var(--yellow) 40%,
                var(--mint) 40%, var(--mint) 60%,
                var(--sky) 60%, var(--sky) 80%,
                var(--lavender) 80%, var(--lavender) 100%
            );
            border-radius: 10px;
            border: 1px solid var(--ink);
            position: relative;
        }

        .distribution-marker {
            position: absolute;
            top: -5px;
            width: 4px;
            height: 30px;
            background: var(--ink);
            transform: translateX(-50%);
        }

        .distribution-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.7rem;
            color: #7f8c8d;
        }

        /* Body Measurements */
        .measurements-card {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--peach) 0%, var(--yellow) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
        }

        .measurements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .measurement-item {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border: 2px dashed var(--ink);
            border-radius: 12px;
            position: relative;
        }

        .measurement-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .measurement-value {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .measurement-change {
            font-size: 0.8rem;
            margin-top: 3px;
        }

        .measurement-change.positive { color: #e74c3c; }
        .measurement-change.negative { color: #27ae60; }

        /* Achievements */
        .achievements-section {
            margin-top: 20px;
            padding: 20px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
        }

        .achievements-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
        }

        .achievement-badge {
            text-align: center;
            padding: 15px 10px;
            background: white;
            border: 2px dashed var(--ink);
            border-radius: 15px;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .achievement-badge.unlocked {
            opacity: 1;
            border-style: solid;
            background: linear-gradient(135deg, var(--yellow) 0%, var(--mint) 100%);
        }

        .achievement-badge.new {
            animation: glow 2s ease-in-out infinite;
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .achievement-name {
            font-size: 0.75rem;
            color: #555;
        }

        .achievement-share-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: white;
            border: 1px solid var(--ink);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
            opacity: 0;
        }

        .achievement-badge.unlocked:hover .achievement-share-btn {
            opacity: 1;
        }

        .achievement-share-btn:hover {
            background: var(--mint);
            transform: scale(1.1);
        }

        /* Share Modal */
        .share-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .share-modal.active {
            display: flex;
        }

        .share-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            border: 3px dashed var(--ink);
            max-width: 400px;
            width: 90%;
            box-shadow: 5px 5px 0 var(--shadow);
            animation: popIn 0.3s ease;
        }

        .share-card-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .share-card-badge {
            font-size: 4rem;
            margin-bottom: 10px;
            animation: float 3s ease-in-out infinite;
        }

        .share-card-title {
            font-family: 'Caveat', cursive;
            font-size: 2rem;
            color: var(--ink);
            margin-bottom: 5px;
        }

        .share-card-subtitle {
            font-size: 0.9rem;
            color: #666;
        }

        .share-card-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
        }

        .share-stat {
            text-align: center;
        }

        .share-stat-value {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .share-stat-label {
            font-size: 0.75rem;
            color: #666;
        }

        .share-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .share-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--ink);
            border-radius: 12px;
            background: var(--mint);
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 2px 2px 0 var(--shadow);
        }

        .share-btn.download {
            background: var(--lavender);
        }

        .share-btn.close {
            background: var(--peach);
        }

        /* Profile Card */
        .profile-card {
            background: linear-gradient(135deg, var(--yellow) 0%, var(--peach) 100%);
            border-radius: 20px;
            border: 3px solid var(--ink);
            padding: 20px;
            box-shadow: 5px 5px 0 var(--shadow);
            margin-bottom: 20px;
            animation: slideInUp 0.5s ease;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .profile-avatar {
            position: relative;
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            border: 3px solid var(--ink);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .profile-avatar:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 4px 4px 0 var(--shadow);
        }

        .avatar-emoji {
            font-size: 2.5rem;
        }

        .avatar-level {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: var(--mint);
            border: 2px solid var(--ink);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-family: 'Caveat', cursive;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--ink);
        }

        .profile-title {
            font-size: 0.9rem;
            color: #666;
            margin-top: 2px;
        }

        .profile-settings {
            background: white;
            border: 2px solid var(--ink);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-settings:hover {
            transform: rotate(90deg);
            background: var(--mint);
        }

        .profile-progress {
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            border: 2px solid var(--ink);
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--mint) 0%, var(--sky) 100%);
            border-radius: 8px;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            font-size: 0.85rem;
            color: #555;
            font-weight: 600;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .profile-stat {
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            padding: 10px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .profile-stat:hover {
            transform: translateY(-3px);
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .profile-stat .stat-icon {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .profile-stat .stat-value {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .profile-stat .stat-label {
            font-size: 0.7rem;
            color: #666;
            margin-top: 2px;
        }

        /* Daily Challenges */
        .challenges-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--coral) 0%, var(--pink) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
            animation: slideInUp 0.6s ease;
        }

        .challenges-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .challenges-header h3 {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .challenges-date {
            font-size: 0.85rem;
            color: #666;
            padding: 5px 12px;
            background: white;
            border-radius: 15px;
            border: 1px solid var(--ink);
        }

        .challenges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .challenge-item {
            background: white;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .challenge-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--peach);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .challenge-item.completed::before {
            background: var(--mint);
            transform: scaleX(1);
        }

        .challenge-item:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .challenge-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            display: block;
        }

        .challenge-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .challenge-reward {
            font-size: 0.8rem;
            color: #f39c12;
            font-weight: 600;
        }

        .challenge-check {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            background: white;
            border: 2px solid var(--ink);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .challenge-item.completed .challenge-check {
            opacity: 1;
            transform: scale(1);
            background: var(--mint);
        }

        /* Progress Timeline */
        .timeline-section {
            margin-top: 20px;
            padding: 20px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
        }

        .timeline-title {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, var(--mint), var(--sky), var(--lavender));
            border-radius: 2px;
        }

        .timeline-item {
            position: relative;
            padding-left: 50px;
            margin-bottom: 25px;
            animation: slideInLeft 0.5s ease;
        }

        .timeline-dot {
            position: absolute;
            left: 11px;
            top: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--ink);
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .timeline-dot.weight {
            background: var(--mint);
        }

        .timeline-dot.milestone {
            background: var(--yellow);
            font-size: 1rem;
        }

        .timeline-dot.achievement {
            background: var(--coral);
        }

        .timeline-content {
            background: white;
            padding: 12px 15px;
            border-radius: 12px;
            border: 2px dashed var(--ink);
            box-shadow: 2px 2px 0 var(--shadow);
            transition: all 0.2s ease;
        }

        .timeline-content:hover {
            transform: translateX(5px);
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .timeline-date {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 5px;
        }

        .timeline-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .timeline-icon {
            font-size: 1.2rem;
        }

        .timeline-label {
            font-weight: 600;
            color: var(--ink);
        }

        .timeline-value {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            color: var(--accent);
        }

        .timeline-note {
            font-size: 0.85rem;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }

        .timeline-mood {
            font-size: 1.2rem;
        }

        .timeline-milestone {
            background: linear-gradient(135deg, var(--yellow) 0%, var(--peach) 100%);
            border-style: solid;
        }

        .timeline-achievement {
            background: linear-gradient(135deg, var(--coral) 0%, var(--pink) 100%);
            border-style: solid;
        }

        .timeline-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .timeline-stat {
            font-size: 0.8rem;
            padding: 4px 8px;
            background: var(--paper);
            border-radius: 8px;
            border: 1px solid var(--ink);
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Additional Micro-interactions */
        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-3deg); }
            75% { transform: rotate(3deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
            20%, 40%, 60%, 80% { transform: translateX(2px); }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 0.5;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Enhanced button interactions */
        .btn {
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::after {
            width: 300px;
            height: 300px;
        }

        /* Enhanced card hover effects */
        .card {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .card:hover {
            transform: translateY(-3px);
        }

        /* Input focus effects */
        .input-wrapper input:focus,
        .input-wrapper textarea:focus {
            animation: slideInDown 0.3s ease;
        }

        /* Sticker animations */
        .sticker {
            transition: transform 0.3s ease;
        }

        .sticker:hover {
            animation: wiggle 0.5s ease-in-out;
            transform: scale(1.1);
        }

        /* Water glass interactions */
        .water-glass {
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .water-glass:hover {
            transform: scale(1.1);
        }

        .water-glass.filled {
            animation: bounceIn 0.5s ease;
        }

        /* Achievement badge interactions */
        .achievement-badge {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .achievement-badge.unlocked:hover {
            transform: scale(1.1) rotate(2deg);
        }

        .achievement-badge.new {
            animation: glow 2s ease-in-out infinite, bounceIn 0.5s ease;
        }

        /* Mood option interactions */
        .mood-option {
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .mood-option:hover {
            transform: scale(1.2) rotate(5deg);
        }

        .mood-option.selected {
            animation: bounceIn 0.4s ease;
        }

        /* Dashboard widget interactions */
        .dashboard-widget {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .dashboard-widget:hover {
            transform: translateY(-5px);
            box-shadow: 4px 4px 0 var(--shadow);
        }

        /* Stat item interactions */
        .stat-item {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .stat-item:hover {
            animation: wiggle 0.5s ease;
        }

        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(44, 62, 80, 0.2);
            border-radius: 50%;
            border-top-color: var(--ink);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Progress bar animations */
        .goal-progress-fill {
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Calendar heatmap cell interactions */
        .heatmap-cell {
            transition: all 0.2s ease;
        }

        .heatmap-cell:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        /* FAB menu interactions */
        .fab {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
        }

        .fab-menu-item {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .fab-menu-btn:hover {
            transform: scale(1.1);
        }

        /* Quick action button interactions */
        .quick-action-btn {
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .quick-action-btn:hover {
            transform: scale(1.15);
        }

        /* Mood Distribution Chart */
        .mood-chart-container {
            margin-top: 20px;
            padding: 20px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
        }

        .mood-chart-title {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .mood-chart {
            display: flex;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--ink);
        }

        .mood-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .mood-segment:hover {
            transform: scaleY(1.1);
        }

        .mood-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            justify-content: center;
        }

        .mood-legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .mood-legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            border: 1px solid var(--ink);
        }

        /* Progress Photos */
        .photos-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--sky) 0%, var(--mint) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
        }

        .photos-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .add-photo-btn {
            padding: 8px 16px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
            background: var(--yellow);
            border: 2px solid var(--ink);
            border-radius: 10px;
            cursor: pointer;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }

        .photo-item {
            position: relative;
            aspect-ratio: 3/4;
            background: rgba(255,255,255,0.8);
            border: 2px dashed var(--ink);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-item:hover {
            transform: scale(1.05);
            border-style: solid;
        }

        .photo-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-date {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 5px;
            background: rgba(44, 62, 80, 0.8);
            color: white;
            font-size: 0.75rem;
            text-align: center;
        }

        .photo-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            background: var(--coral);
            border: 1px solid var(--ink);
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Reminders */
        .reminder-section {
            margin-top: 20px;
            padding: 20px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
        }

        .reminder-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .reminder-time {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .toggle-switch {
            width: 60px;
            height: 30px;
            background: var(--shadow);
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--ink);
        }

        .toggle-switch.active {
            background: var(--mint);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            border: 1px solid var(--ink);
        }

        .toggle-switch.active::after {
            left: 32px;
        }

        /* Measurements Modal */
        .measurements-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        /* Empty states */
        .empty-photos {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
        }

        .empty-photos .emoji {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Dashboard Widgets */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .dashboard-widget {
            padding: 20px;
            background: linear-gradient(135deg, var(--paper) 0%, white 100%);
            border: 2px dashed var(--ink);
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .dashboard-widget:hover {
            transform: translateY(-5px) rotate(1deg);
            box-shadow: 5px 5px 0 var(--shadow);
            border-style: solid;
        }

        .widget-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .widget-value {
            font-family: 'Caveat', cursive;
            font-size: 2rem;
            font-weight: 700;
            color: var(--ink);
        }

        .widget-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .widget-trend {
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .widget-trend.up { color: #e74c3c; }
        .widget-trend.down { color: #27ae60; }
        .widget-trend.neutral { color: #7f8c8d; }

        /* Health Calculators */
        .calculators-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--lavender) 0%, var(--peach) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
        }

        .calculator-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .calculator-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .calculator-tab {
            padding: 8px 16px;
            background: rgba(255,255,255,0.7);
            border: 2px dashed var(--ink);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            transition: all 0.2s ease;
        }

        .calculator-tab.active {
            border-style: solid;
            background: var(--mint);
        }

        .calculator-content {
            background: rgba(255,255,255,0.8);
            padding: 15px;
            border-radius: 12px;
            border: 1px dashed var(--ink);
        }

        .calculator-result {
            margin-top: 15px;
            padding: 15px;
            background: var(--yellow);
            border-radius: 10px;
            border: 2px solid var(--ink);
            text-align: center;
        }

        .result-value {
            font-family: 'Caveat', cursive;
            font-size: 2rem;
            font-weight: 700;
        }

        .result-description {
            font-size: 0.95rem;
            margin-top: 5px;
            color: #555;
        }

        /* Water Tracker */
        .water-tracker {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--sky) 0%, var(--mint) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
        }

        .water-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .water-visual {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 8px;
            height: 120px;
            margin-bottom: 15px;
        }

        .water-glass {
            width: 30px;
            background: rgba(255,255,255,0.6);
            border: 2px solid var(--ink);
            border-radius: 0 0 8px 8px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .water-glass:hover {
            transform: translateY(-3px);
        }

        .water-glass.filled::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(to top, var(--sky), var(--mint));
            animation: fillWater 0.3s ease;
        }

        @keyframes fillWater {
            from { height: 0; }
            to { height: 100%; }
        }

        .water-glass.empty::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 0;
            background: linear-gradient(to top, var(--sky), var(--mint));
        }

        .water-info {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }

        .water-stat {
            text-align: center;
        }

        .water-stat-value {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .water-stat-label {
            font-size: 0.85rem;
            color: #555;
        }

        /* Exercise Logger */
        .exercise-logger {
            margin-top: 20px;
            padding: 20px;
            background: var(--paper);
            border-radius: 15px;
            border: 2px dashed var(--ink);
        }

        .exercise-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .exercise-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .exercise-type {
            padding: 12px 8px;
            background: white;
            border: 2px dashed var(--ink);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .exercise-type:hover {
            transform: scale(1.05);
            background: var(--mint);
        }

        .exercise-type.selected {
            border-style: solid;
            background: var(--peach);
        }

        .exercise-icon {
            font-size: 1.8rem;
            display: block;
            margin-bottom: 5px;
        }

        .exercise-name {
            font-size: 0.75rem;
        }

        .exercise-duration {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .exercise-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .exercise-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.7);
            border: 1px dashed var(--ink);
            border-radius: 10px;
        }

        .exercise-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exercise-calories {
            font-family: 'Caveat', cursive;
            font-weight: 600;
            color: #e74c3c;
        }

        /* Sleep Tracker */
        .sleep-tracker {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--lavender) 0%, var(--sky) 100%);
            border-radius: 15px;
            border: 2px solid var(--ink);
        }

        .sleep-title {
            font-family: 'Caveat', cursive;
            font-size: 1.6rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sleep-input {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .sleep-quality {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .quality-option {
            flex: 1;
            padding: 10px;
            background: rgba(255,255,255,0.7);
            border: 2px dashed var(--ink);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quality-option:hover {
            background: var(--mint);
        }

        .quality-option.selected {
            border-style: solid;
            background: var(--peach);
        }

        .sleep-visual {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.6);
            border-radius: 12px;
        }

        .moon {
            font-size: 3rem;
            animation: float 3s ease-in-out infinite;
        }

        .sleep-info {
            text-align: center;
        }

        .sleep-hours {
            font-family: 'Caveat', cursive;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .sleep-avg {
            font-size: 0.9rem;
            color: #555;
            margin-top: 5px;
        }

        /* Range slider */
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: var(--shadow);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--mint);
            cursor: pointer;
            border: 2px solid var(--ink);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--mint);
            cursor: pointer;
            border: 2px solid var(--ink);
        }

        /* Quick actions panel */
        .quick-actions {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 90;
        }

        .quick-action-btn {
            width: 50px;
            height: 50px;
            background: var(--yellow);
            border: 2px solid var(--ink);
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 2px 2px 0 var(--ink);
        }

        .quick-action-btn:hover {
            transform: scale(1.15);
            box-shadow: 3px 3px 0 var(--ink);
        }

        @media (max-width: 768px) {
            .quick-actions {
                display: none;
            }
        }

        /* Widget Bar */
        .widget-bar {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            padding: 12px 15px;
            background: linear-gradient(135deg, var(--paper) 0%, white 100%);
            border: 2px dashed var(--ink);
            border-radius: 15px;
            overflow-x: auto;
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .widget-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: white;
            border: 2px solid var(--ink);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
            min-width: fit-content;
        }

        .widget-item:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 3px 3px 0 var(--shadow);
        }

        .widget-icon-mini {
            font-size: 1.2rem;
        }

        .widget-value-mini {
            font-family: 'Caveat', cursive;
            font-size: 1.1rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <canvas id="confettiCanvas"></canvas>

    <!-- Ambient Effects -->
    <div class="gradient-orb orb-1"></div>
    <div class="gradient-orb orb-2"></div>
    <div class="gradient-orb orb-3"></div>

    <div class="particle particle-1">‚ú®</div>
    <div class="particle particle-2">‚≠ê</div>
    <div class="particle particle-3">üí´</div>
    <div class="particle particle-4">‚ú®</div>
    <div class="particle particle-5">‚≠ê</div>
    <div class="particle particle-6">üí´</div>
    <div class="particle particle-7">‚ú®</div>
    <div class="particle particle-8">‚≠ê</div>

    <div class="sparkle sparkle-1">‚ú¶</div>
    <div class="sparkle sparkle-2">‚úß</div>
    <div class="sparkle sparkle-3">‚ú¶</div>
    <div class="sparkle sparkle-4">‚úß</div>
    <div class="sparkle sparkle-5">‚ú¶</div>
    <div class="sparkle sparkle-6">‚úß</div>

    <div class="wave-decoration">
        <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
            <path fill="currentColor" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"/>
        </svg>
    </div>

    <div class="ambient-shower" id="ambientShower"></div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Quick Stats Widget -->
    <div class="quick-stats-widget" id="quickStatsWidget" onclick="toggleQuickStats()">
        <span class="quick-stats-icon">‚öñÔ∏è</span>
        <div class="quick-stats-info">
            <span class="quick-stats-label">ÂΩìÂâç‰ΩìÈáç</span>
            <span class="quick-stats-value" id="quickStatsWeight">--</span>
            <span class="quick-stats-trend" id="quickStatsTrend">--</span>
        </div>
    </div>

    <!-- Theme Switcher -->
    <div class="theme-switcher" id="themeSwitcher">
        <button class="theme-toggle-btn" onclick="toggleThemePanel()" title="ÂàáÊç¢‰∏ªÈ¢ò">üé®</button>
        <div class="theme-panel" id="themePanel">
            <div class="theme-panel-title">ÈÄâÊã©‰∏ªÈ¢ò</div>
            <div class="theme-grid">
                <button class="theme-option" onclick="setTheme('default')" title="ÈªòËÆ§‰∏ªÈ¢ò">
                    <span class="theme-preview" style="background: linear-gradient(135deg, #a8e6cf 0%, #ffd3b6 100%);"></span>
                    <span>ÈªòËÆ§</span>
                </button>
                <button class="theme-option" onclick="setTheme('ocean')" title="Êµ∑Ê¥ã‰∏ªÈ¢ò">
                    <span class="theme-preview" style="background: linear-gradient(135deg, #4dd0e1 0%, #81d4fa 100%);"></span>
                    <span>Êµ∑Ê¥ã</span>
                </button>
                <button class="theme-option" onclick="setTheme('forest')" title="Ê£ÆÊûó‰∏ªÈ¢ò">
                    <span class="theme-preview" style="background: linear-gradient(135deg, #aed581 0%, #81c784 100%);"></span>
                    <span>Ê£ÆÊûó</span>
                </button>
                <button class="theme-option" onclick="setTheme('sunset')" title="Êó•ËêΩ‰∏ªÈ¢ò">
                    <span class="theme-preview" style="background: linear-gradient(135deg, #ffab91 0%, #ff8a65 100%);"></span>
                    <span>Êó•ËêΩ</span>
                </button>
                <button class="theme-option" onclick="setTheme('berry')" title="ÊµÜÊûú‰∏ªÈ¢ò">
                    <span class="theme-preview" style="background: linear-gradient(135deg, #f48fb1 0%, #f06292 100%);"></span>
                    <span>ÊµÜÊûú</span>
                </button>
                <button class="theme-option" onclick="setTheme('lavender')" title="Ëñ∞Ë°£Ëçâ‰∏ªÈ¢ò">
                    <span class="theme-preview" style="background: linear-gradient(135deg, #ce93d8 0%, #9fa8da 100%);"></span>
                    <span>Ëñ∞Ë°£Ëçâ</span>
                </button>
                <button class="theme-option" onclick="setTheme('midnight')" title="ÂçàÂ§ú‰∏ªÈ¢ò">
                    <span class="theme-preview" style="background: linear-gradient(135deg, #238636 0%, #8957e5 100%);"></span>
                    <span>ÂçàÂ§ú</span>
                </button>
                <button class="theme-option" onclick="setTheme('dark')" title="Ê∑±Ëâ≤‰∏ªÈ¢ò">
                    <span class="theme-preview" style="background: linear-gradient(135deg, #2d6a4f 0%, #6b4c7a 100%);"></span>
                    <span>Ê∑±Ëâ≤</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Actions Panel -->
    <div class="quick-actions">
        <button class="quick-action-btn" onclick="scrollToForm()" title="Ê∑ªÂä†ËÆ∞ÂΩï">üìù</button>
        <button class="quick-action-btn" onclick="document.getElementById('waterTracker').scrollIntoView({behavior:'smooth'})" title="ÂñùÊ∞¥ËÆ∞ÂΩï">üíß</button>
        <button class="quick-action-btn" onclick="document.getElementById('exerciseLogger').scrollIntoView({behavior:'smooth'})" title="ËøêÂä®ËÆ∞ÂΩï">üèÉ</button>
        <button class="quick-action-btn" onclick="document.getElementById('sleepTracker').scrollIntoView({behavior:'smooth'})" title="Áù°Áú†ËÆ∞ÂΩï">üò¥</button>
    </div>

    <!-- Floating Action Button -->
    <div class="fab-menu" id="fabMenu">
        <div class="fab-menu-item" id="fabItem1">
            <span class="fab-menu-label">Ê∑ªÂä†ËÆ∞ÂΩï</span>
            <button class="fab-menu-btn" onclick="scrollToForm()">üìù</button>
        </div>
        <div class="fab-menu-item" id="fabItem2">
            <span class="fab-menu-label">Êü•ÁúãÁªüËÆ°</span>
            <button class="fab-menu-btn" onclick="scrollToStats()">üìä</button>
        </div>
        <div class="fab-menu-item" id="fabItem3">
            <span class="fab-menu-label">Êü•ÁúãÂõæË°®</span>
            <button class="fab-menu-btn" onclick="scrollToChart()">üìà</button>
        </div>
    </div>
    <div class="fab" onclick="toggleFabMenu()" title="Âø´Êç∑Êìç‰Ωú">‚ö°</div>

    <!-- SVG doodles -->
    <svg class="svg-doodle doodle-1" viewBox="0 0 100 100">
        <path d="M20,80 Q30,20 50,50 Q70,80 80,30" fill="none" stroke="#2c3e50" stroke-width="2" stroke-linecap="round"/>
        <circle cx="30" cy="40" r="8" fill="none" stroke="#2c3e50" stroke-width="2"/>
        <path d="M45,35 L55,45 M55,35 L45,45" stroke="#2c3e50" stroke-width="2"/>
    </svg>
    <svg class="svg-doodle doodle-2" viewBox="0 0 100 100">
        <path d="M30,70 Q40,30 70,50" fill="none" stroke="#2c3e50" stroke-width="2"/>
        <circle cx="50" cy="60" r="5" fill="#a8e6cf" stroke="#2c3e50" stroke-width="2"/>
    </svg>
    <svg class="svg-doodle doodle-3" viewBox="0 0 100 100">
        <path d="M20,50 Q40,20 60,50 Q80,80 100,50" fill="none" stroke="#2c3e50" stroke-width="2" stroke-dasharray="5,5"/>
        <path d="M30,60 L40,50 L50,60 L60,50 L70,60" fill="none" stroke="#2c3e50" stroke-width="2"/>
    </svg>
    <svg class="svg-doodle doodle-4" viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="30" fill="none" stroke="#2c3e50" stroke-width="2"/>
        <path d="M40,40 L60,60 M60,40 L40,60" stroke="#2c3e50" stroke-width="2"/>
    </svg>
    <svg class="svg-doodle doodle-5" viewBox="0 0 100 100">
        <path d="M20,60 C20,30 50,20 70,40 C90,60 80,90 50,90 C20,90 20,60 20,60" fill="#ffd3b6" stroke="#2c3e50" stroke-width="2"/>
        <circle cx="40" cy="55" r="5" fill="#2c3e50"/>
        <circle cx="60" cy="55" r="5" fill="#2c3e50"/>
        <path d="M40,70 Q50,80 60,70" fill="none" stroke="#2c3e50" stroke-width="2"/>
    </svg>
    <svg class="svg-doodle doodle-6" viewBox="0 0 100 100">
        <path d="M20,30 L30,70 L50,50 L70,70 L80,30" fill="none" stroke="#2c3e50" stroke-width="2" stroke-linejoin="round"/>
        <circle cx="50" cy="50" r="15" fill="#b8d8e0" stroke="#2c3e50" stroke-width="2"/>
    </svg>
    <svg class="svg-doodle doodle-7" viewBox="0 0 100 100">
        <path d="M30,70 C30,40 70,40 70,70 C70,90 30,90 30,70" fill="none" stroke="#2c3e50" stroke-width="2"/>
        <path d="M35,60 L45,65 L55,55 L65,60" fill="none" stroke="#2c3e50" stroke-width="2"/>
        <circle cx="50" cy="50" r="3" fill="#ffaaa5"/>
    </svg>
    <svg class="svg-doodle doodle-8" viewBox="0 0 100 100" style="top: 15%; right: 5%;">
        <path d="M50,20 L55,40 L75,40 L60,55 L65,75 L50,60 L35,75 L40,55 L25,40 L45,40 Z" fill="none" stroke="#ffd700" stroke-width="2"/>
        <circle cx="50" cy="50" r="8" fill="#fff5ba"/>
    </svg>
    <svg class="svg-doodle doodle-9" viewBox="0 0 100 100" style="top: 45%; left: 3%;">
        <ellipse cx="50" cy="50" rx="35" ry="20" fill="none" stroke="#a8e6cf" stroke-width="2"/>
        <path d="M50,30 L50,70 M30,40 Q50,50 70,40 M30,60 Q50,50 70,60" fill="none" stroke="#a8e6cf" stroke-width="1.5"/>
    </svg>
    <svg class="svg-doodle doodle-10" viewBox="0 0 100 100" style="bottom: 20%; right: 8%;">
        <path d="M50,10 Q60,30 50,50 Q40,70 50,90" fill="none" stroke="#d4a5db" stroke-width="2"/>
        <path d="M30,30 Q50,40 70,30" fill="none" stroke="#d4a5db" stroke-width="2"/>
        <path d="M30,50 Q50,60 70,50" fill="none" stroke="#d4a5db" stroke-width="2"/>
        <circle cx="50" cy="20" r="5" fill="#d4a5db"/>
    </svg>

    <div class="container">
        <header>
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap; position: relative;">
                <!-- Left decoration -->
                <span style="font-size: 2rem; animation: float 3s ease-in-out infinite 0.5s;">üåø</span>

                <h1 style="position: relative;">
                    ‰ΩìÈáçÂ∞èÊú¨Êú¨
                    <svg viewBox="0 0 200 30" preserveAspectRatio="none" style="position: absolute; bottom: -5px; left: 0; width: 100%;">
                        <path d="M0,15 Q25,5 50,15 T100,15 T150,15 T200,15" fill="none" stroke="#a8e6cf" stroke-width="4" stroke-linecap="round"/>
                    </svg>
                    <!-- Sparkles -->
                    <span style="position: absolute; top: -10px; right: -15px; font-size: 1.2rem; animation: twinkle 2s ease-in-out infinite;">‚ú®</span>
                    <span style="position: absolute; top: 5px; right: -25px; font-size: 0.8rem; animation: twinkle 2s ease-in-out infinite 0.5s;">üí´</span>
                </h1>

                <div class="streak-badge" id="streakBadge" style="display: none;">
                    <span class="streak-fire">üî•</span>
                    <span id="streakCount">0</span> Â§©
                </div>

                <!-- Right decoration -->
                <span style="font-size: 2rem; animation: float 3s ease-in-out infinite 1s;">üå∏</span>
            </div>
            <p class="subtitle">ËÆ∞ÂΩïÊØè‰∏ÄÂ§©ÁöÑÂèòÂåñÔºåÈÅáËßÅÊõ¥Â•ΩÁöÑËá™Â∑± ‚ú®</p>

            <!-- Decorative tape -->
            <div style="display: flex; justify-content: center; gap: 30px; margin-top: 10px;">
                <div style="width: 40px; height: 15px; background: linear-gradient(135deg, var(--peach) 0%, var(--yellow) 100%); border: 1px solid var(--ink); transform: rotate(-3deg); box-shadow: 2px 2px 0 var(--shadow);"></div>
                <div style="width: 40px; height: 15px; background: linear-gradient(135deg, var(--mint) 0%, var(--sky) 100%); border: 1px solid var(--ink); transform: rotate(2deg); box-shadow: 2px 2px 0 var(--shadow);"></div>
                <div style="width: 40px; height: 15px; background: linear-gradient(135deg, var(--lavender) 0%, var(--coral) 100%); border: 1px solid var(--ink); transform: rotate(-2deg); box-shadow: 2px 2px 0 var(--shadow);"></div>
            </div>
        </header>

        <!-- Compact Widget Bar -->
        <div class="widget-bar" id="widgetBar">
            <div class="widget-item" onclick="document.getElementById('weight').focus()">
                <span class="widget-icon-mini">‚öñÔ∏è</span>
                <span class="widget-value-mini" id="widgetWeight">--</span>
            </div>
            <div class="widget-item" onclick="toggleDashboardView()">
                <span class="widget-icon-mini">üìä</span>
                <span class="widget-value-mini" id="widgetChange">--</span>
            </div>
            <div class="widget-item" onclick="document.getElementById('waterTracker').scrollIntoView({behavior:'smooth'})">
                <span class="widget-icon-mini">üíß</span>
                <span class="widget-value-mini" id="widgetWaterBar">0/8</span>
            </div>
            <div class="widget-item" onclick="document.getElementById('exerciseLogger').scrollIntoView({behavior:'smooth'})">
                <span class="widget-icon-mini">üî•</span>
                <span class="widget-value-mini" id="widgetCaloriesBar">0</span>
            </div>
            <div class="widget-item" onclick="document.getElementById('streakBadge').scrollIntoView({behavior:'smooth'})">
                <span class="widget-icon-mini">üî•</span>
                <span class="widget-value-mini" id="widgetStreakBar">0</span>
            </div>
        </div>

        <!-- Summary Dashboard -->
        <div class="card" id="summaryDashboard">
            <h2 class="card-title">
                <span class="icon">üìä</span>
                ‰ªäÊó•Ê¶ÇËßà
                <button class="export-btn" onclick="toggleDashboardView()" id="dashboardToggle" style="font-size: 0.85rem;">Â±ïÂºÄ</button>
            </h2>
            <div class="dashboard-grid" id="dashboardGrid" style="display: none;">
                <div class="dashboard-widget">
                    <span class="widget-icon">‚öñÔ∏è</span>
                    <div class="widget-value" id="dashWeight">--</div>
                    <div class="widget-label">ÂΩìÂâç‰ΩìÈáç</div>
                </div>
                <div class="dashboard-widget">
                    <span class="widget-icon">üìà</span>
                    <div class="widget-value" id="dashChange">--</div>
                    <div class="widget-label">ËæÉ‰∏äÊ¨°</div>
                </div>
                <div class="dashboard-widget">
                    <span class="widget-icon">üíß</span>
                    <div class="widget-value" id="dashWater">0/8</div>
                    <div class="widget-label">È•ÆÊ∞¥Èáè</div>
                </div>
                <div class="dashboard-widget">
                    <span class="widget-icon">üî•</span>
                    <div class="widget-value" id="dashStreak">0</div>
                    <div class="widget-label">ËøûÁª≠Â§©Êï∞</div>
                </div>
                <div class="dashboard-widget">
                    <span class="widget-icon">üèÉ</span>
                    <div class="widget-value" id="dashCalories">0</div>
                    <div class="widget-label">Ê∂àËÄóÂçÉÂç°</div>
                </div>
                <div class="dashboard-widget">
                    <span class="widget-icon">üò¥</span>
                    <div class="widget-value" id="dashSleep">--</div>
                    <div class="widget-label">Áù°Áú†Êó∂Èïø</div>
                </div>
            </div>
        </div>

        <!-- User Profile Card -->
        <div class="profile-card" id="profileCard">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar" onclick="openAvatarModal()">
                    <span class="avatar-emoji" id="avatarEmoji">üßë</span>
                    <div class="avatar-level" id="avatarLevel">1</div>
                </div>
                <div class="profile-info">
                    <div class="profile-name" id="profileName">ÂÅ•Â∫∑Ëææ‰∫∫</div>
                    <div class="profile-title" id="profileTitle">ÂàùÁ∫ßËÆ∞ÂΩïËÄÖ</div>
                </div>
                <button class="profile-settings" onclick="openProfileSettings()" title="ËÆæÁΩÆ">‚öôÔ∏è</button>
            </div>
            <div class="profile-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="profileProgressFill" style="width: 0%"></div>
                </div>
                <div class="progress-text">
                    <span id="profileXP">0</span> / <span id="profileXPNext">100</span> XP
                </div>
            </div>
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-value" id="profileStreak">0</div>
                    <div class="stat-label">Â§©Êï∞</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-value" id="profileRecords">0</div>
                    <div class="stat-label">ËÆ∞ÂΩï</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-value" id="profileAchievements">0</div>
                    <div class="stat-label">ÊàêÂ∞±</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-icon">‚öñÔ∏è</div>
                    <div class="stat-value" id="profileWeightChange">--</div>
                    <div class="stat-label">ÂèòÂåñ</div>
                </div>
            </div>
        </div>

        <!-- Daily Challenges -->
        <div class="challenges-section" id="challengesSection" style="display: none;">
            <div class="challenges-header">
                <h3>üéØ ÊØèÊó•ÊåëÊàò</h3>
                <span class="challenges-date" id="challengesDate">‰ªäÂ§©</span>
            </div>
            <div class="challenges-grid" id="challengesGrid">
                <!-- Challenges will be dynamically added -->
            </div>
        </div>

        <!-- Today's Focus -->
        <div class="card" id="todayFocus" style="background: linear-gradient(135deg, var(--mint) 0%, var(--sky) 100%);">
            <span class="sticker" style="position: absolute; top: -10px; right: 20px; font-size: 2rem;">‚ú®</span>
            <h2 class="card-title">
                <span class="icon">üåü</span>
                ‰ªäÊó•ÂÖ≥Ê≥®
            </h2>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                <button class="btn" onclick="document.getElementById('weight').focus()" style="flex: 1; min-width: 120px;">
                    ‚öñÔ∏è ËÆ∞ÂΩï‰ΩìÈáç
                </button>
                <button class="btn" onclick="document.getElementById('waterTracker').scrollIntoView({behavior:'smooth'})" style="flex: 1; min-width: 120px;">
                    üíß ÂñùÊ∞¥ÊâìÂç°
                </button>
                <button class="btn" onclick="document.getElementById('exerciseLogger').scrollIntoView({behavior:'smooth'})" style="flex: 1; min-width: 120px;">
                    üèÉ ËøêÂä®ËÆ∞ÂΩï
                </button>
                <button class="btn" onclick="toggleDashboardView()" style="flex: 1; min-width: 120px;">
                    üìä Êü•ÁúãÊï∞ÊçÆ
                </button>
            </div>
            <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 10px; border: 1px dashed var(--ink);">
                <div style="font-size: 0.95rem; color: #555;">
                    <strong>üí° ‰ªäÊó•Â∞èË¥¥Â£´Ôºö</strong>
                    <span id="dailyTip" style="font-style: italic;">‰øùÊåÅËßÑÂæã‰ΩúÊÅØÔºåÂùáË°°È•ÆÈ£üÔºåÈÄÇÈáèËøêÂä®ÊòØÂÅ•Â∫∑ÁîüÊ¥ªÁöÑ‰∏âÂ§ßÂü∫Áü≥„ÄÇ</span>
                </div>
            </div>
        </div>

        <div class="motivation" id="motivation">
            ÊØè‰∏Ä‰∏™Â∞èËøõÊ≠•ÈÉΩÂÄºÂæóÂ∫ÜÁ•ùÔºÅüí™
        </div>

        <!-- Weight Entry -->
        <div class="card">
            <span class="sticker sticker-1">üåü</span>
            <div class="tape tape-left"></div>
            <div class="tape tape-right"></div>
            <h2 class="card-title">
                <span class="icon">üìù</span>
                ËÆ∞ÂΩï‰ªäÊó•‰ΩìÈáç
            </h2>

            <!-- Mini Stats -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 100px; padding: 10px; background: var(--mint); border-radius: 10px; border: 1px dashed var(--ink); text-align: center;">
                    <div style="font-size: 0.8rem; color: #555;">‰∏äÊ¨°</div>
                    <div style="font-family: 'Caveat', cursive; font-size: 1.3rem; font-weight: 600;" id="miniLastWeight">--</div>
                </div>
                <div style="flex: 1; min-width: 100px; padding: 10px; background: var(--peach); border-radius: 10px; border: 1px dashed var(--ink); text-align: center;">
                    <div style="font-size: 0.8rem; color: #555;">ÂΩìÂâç</div>
                    <div style="font-family: 'Caveat', cursive; font-size: 1.3rem; font-weight: 600;" id="miniCurrentWeight">--</div>
                </div>
                <div style="flex: 1; min-width: 100px; padding: 10px; background: var(--lavender); border-radius: 10px; border: 1px dashed var(--ink); text-align: center;">
                    <div style="font-size: 0.8rem; color: #555;">ÁõÆÊ†á</div>
                    <div style="font-family: 'Caveat', cursive; font-size: 1.3rem; font-weight: 600;" id="miniGoalWeight">--</div>
                </div>
            </div>

            <form id="weightForm" class="form-section">
                <div class="input-wrapper">
                    <label for="date">üìÖ Êó•Êúü</label>
                    <input type="date" id="date" required>
                </div>
                <div class="input-wrapper">
                    <label for="weight">‚öñÔ∏è ‰ΩìÈáç (kg)</label>
                    <input type="number" id="weight" step="0.1" min="0" max="500" placeholder="‰æãÂ¶Ç: 65.5" required>
                </div>
                <div class="input-wrapper">
                    <label for="note">üí≠ Â§áÊ≥® (ÂèØÈÄâ)</label>
                    <textarea id="note" placeholder="‰ªäÂ§©ÊÑüËßâÊÄé‰πàÊ†∑Ôºü..." rows="1"></textarea>
                </div>
                <div class="input-wrapper">
                    <label>üòä ‰ªäÊó•ÂøÉÊÉÖ</label>
                    <div class="mood-selector" id="moodSelector">
                        <div class="mood-option" data-mood="great" title="ÂæàÊ£í">üòÑ</div>
                        <div class="mood-option" data-mood="good" title="‰∏çÈîô">üôÇ</div>
                        <div class="mood-option" data-mood="okay" title="‰∏ÄËà¨">üòê</div>
                        <div class="mood-option" data-mood="bad" title="‰∏çÂ•Ω">üòî</div>
                        <div class="mood-option" data-mood="awful" title="Á≥üÁ≥ï">üò´</div>
                    </div>
                    <input type="hidden" id="mood" value="">
                </div>
            </form>
            <div class="btn-group">
                <button type="button" class="btn btn-lavender" onclick="openSettings()">
                    ‚öôÔ∏è ËÆæÁΩÆ
                </button>
                <button type="submit" form="weightForm" class="btn" id="submitBtn">
                    ËÆ∞ÂΩï‰ΩìÈáç ‚úèÔ∏è
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="card">
            <span class="sticker sticker-2">üéØ</span>
            <h2 class="card-title">
                <span class="icon">üìä</span>
                ÂÅ•Â∫∑ÁªüËÆ°
                <span class="prediction-badge" id="predictionBadge" style="display: none;">
                    È¢ÑÊµã: <span class="prediction-value" id="predictionValue">--</span>
                </span>
            </h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-icon">‚öñÔ∏è</span>
                    <div class="stat-value" id="currentWeight">--</div>
                    <div class="stat-label">ÂΩìÂâç‰ΩìÈáç</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üìà</span>
                    <div class="stat-value" id="weightChange">--</div>
                    <div class="stat-label">ËæÉ‰∏äÊ¨°</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üìâ</span>
                    <div class="stat-value" id="totalChange">--</div>
                    <div class="stat-label">ÊÄªÂèòÂåñ</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üìä</span>
                    <div class="stat-value" id="avgWeight">--</div>
                    <div class="stat-label">Âπ≥Âùá‰ΩìÈáç</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üéØ</span>
                    <div class="stat-value" id="bmiValue">--</div>
                    <div class="stat-label">BMI</div>
                </div>
            </div>

            <!-- Weekly Summary -->
            <div class="summary-cards" id="summaryCards" style="display: none;">
                <div class="summary-card">
                    <div class="summary-icon">üìÖ</div>
                    <div class="summary-value" id="weeklyAvg">--</div>
                    <div class="summary-label">Êú¨Âë®Âπ≥Âùá</div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">üìÜ</div>
                    <div class="summary-value" id="monthlyAvg">--</div>
                    <div class="summary-label">Êú¨ÊúàÂπ≥Âùá</div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">üìà</div>
                    <div class="summary-value" id="weeklyChange">--</div>
                    <div class="summary-label">Âë®ÂèòÂåñ</div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">üìâ</div>
                    <div class="summary-value" id="monthlyChange">--</div>
                    <div class="summary-label">ÊúàÂèòÂåñ</div>
                </div>
            </div>

            <!-- Trend Analysis -->
            <div class="trend-section" id="trendSection" style="display: none;">
                <div class="trend-card">
                    <div class="trend-period">üìÖ 7Â§©Ë∂ãÂäø</div>
                    <div class="trend-value" id="trend7days">--</div>
                </div>
                <div class="trend-card">
                    <div class="trend-period">üìÜ 30Â§©Ë∂ãÂäø</div>
                    <div class="trend-value" id="trend30days">--</div>
                </div>
                <div class="trend-card">
                    <div class="trend-period">‚¨ÜÔ∏è ÊúÄÈ´ò</div>
                    <div class="trend-value" id="maxWeight">--</div>
                </div>
                <div class="trend-card">
                    <div class="trend-period">‚¨áÔ∏è ÊúÄ‰Ωé</div>
                    <div class="trend-value" id="minWeight">--</div>
                </div>
            </div>

            <!-- Calendar Heatmap -->
            <div class="calendar-heatmap" id="calendarHeatmap" style="display: none;">
                <div class="heatmap-title">üìÖ ËÆ∞ÂΩïÊó•ÂéÜÁÉ≠ÂäõÂõæ</div>
                <div class="heatmap-grid" id="heatmapGrid"></div>
                <div class="heatmap-labels">
                    <span>Êó•</span><span>‰∏Ä</span><span>‰∫å</span><span>‰∏â</span><span>Âõõ</span><span>‰∫î</span><span>ÂÖ≠</span>
                </div>
                <div class="stats-summary" id="statsSummary" style="margin-top: 20px;">
                    <div class="summary-stat">
                        <div class="summary-stat-icon">üìä</div>
                        <div class="summary-stat-value" id="totalDays">0</div>
                        <div class="summary-stat-label">ËÆ∞ÂΩïÂ§©Êï∞</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-icon">üî•</div>
                        <div class="summary-stat-value" id="bestStreak">0</div>
                        <div class="summary-stat-label">ÊúÄÈïøËøûÁª≠</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-icon">üòä</div>
                        <div class="summary-stat-value" id="avgMood">--</div>
                        <div class="summary-stat-label">Âπ≥ÂùáÂøÉÊÉÖ</div>
                    </div>
                </div>
            </div>

            <!-- Health Insights -->
            <div class="health-insights" id="healthInsights" style="display: none;">
                <div class="insight-title">üí° ÂÅ•Â∫∑Ê¥ûÂØü</div>
                <div class="insight-tips" id="insightTips">
                    <!-- Tips will be dynamically added -->
                </div>
            </div>

            <!-- BMI -->
            <div class="bmi-indicator">
                <div class="bmi-bar">
                    <div class="bmi-marker" id="bmiMarker"></div>
                </div>
                <div class="bmi-labels">
                    <span>ÂÅèÁò¶</span>
                    <span>Ê≠£Â∏∏</span>
                    <span>ÂÅèËÉñ</span>
                    <span>ËÇ•ËÉñ</span>
                </div>
                <p id="bmiStatus" style="text-align: center; margin-top: 10px; font-family: 'Caveat', cursive; font-size: 1.3rem;"></p>
            </div>

            <!-- Goal -->
            <div class="goal-section" id="goalSection" style="display: none;">
                <div class="goal-header">
                    <span class="goal-title">üéØ ÁõÆÊ†áËøõÂ∫¶</span>
                    <span id="goalText"></span>
                </div>
                <div class="goal-progress-bar">
                    <div class="goal-progress-fill" id="goalProgress"></div>
                </div>
                <p style="text-align: center; margin-top: 10px;">
                    <span id="goalRemaining"></span>
                </p>
            </div>
        </div>

        <!-- Chart -->
        <div class="card">
            <h2 class="card-title">
                <span class="icon">üìà</span>
                ‰ΩìÈáçÊõ≤Á∫ø
            </h2>
            <div class="date-range-filter">
                <span class="date-range-filter-label">üìÖ Êó∂Èó¥ËåÉÂõ¥:</span>
                <button class="date-range-preset active" data-range="all" onclick="setDateRange('all')">ÂÖ®ÈÉ®</button>
                <button class="date-range-preset" data-range="week" onclick="setDateRange('week')">Ëøë‰∏ÄÂë®</button>
                <button class="date-range-preset" data-range="month" onclick="setDateRange('month')">Ëøë‰∏ÄÊúà</button>
                <button class="date-range-preset" data-range="quarter" onclick="setDateRange('quarter')">Ëøë‰∏âÊúà</button>
                <button class="date-range-preset" data-range="year" onclick="setDateRange('year')">Ëøë‰∏ÄÂπ¥</button>
                <div class="date-range-custom">
                    <input type="date" id="dateRangeStart" placeholder="ÂºÄÂßãÊó•Êúü">
                    <span>-</span>
                    <input type="date" id="dateRangeEnd" placeholder="ÁªìÊùüÊó•Êúü">
                    <button onclick="setCustomDateRange()">Â∫îÁî®</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="weightChart"></canvas>
            </div>
        </div>

        <!-- Progress Timeline -->
        <div class="timeline-section" id="progressTimeline" style="display: none;">
            <div class="timeline-title">
                <span>üìÖ</span>
                <span>ËøõÂ∫¶Êó∂Èó¥Á∫ø</span>
                <span>‚ú®</span>
            </div>
            <div class="timeline" id="timeline">
                <!-- Timeline items will be dynamically added -->
            </div>
        </div>

        <!-- Smart Insights -->
        <div class="smart-insights" id="smartInsights" style="display: none;">
            <div class="insights-header">
                <h3>üîÆ Êô∫ËÉΩÊ¥ûÂØü</h3>
                <span class="insight-badge">AIÂàÜÊûê</span>
            </div>
            <div class="insight-cards" id="insightCards">
                <!-- Insight cards will be dynamically added -->
            </div>
        </div>

        <!-- Prediction Section -->
        <div class="prediction-section" id="predictionSection" style="display: none;">
            <div class="prediction-header">
                <span>üéØ</span>
                <span>ÁõÆÊ†áÈ¢ÑÊµã</span>
            </div>
            <div class="prediction-cards" id="predictionCards">
                <!-- Prediction cards will be dynamically added -->
            </div>
        </div>

        <!-- Weekly Report -->
        <div class="weekly-report" id="weeklyReport" style="display: none;">
            <div class="report-header">
                <div class="report-title">
                    <span>üìä</span>
                    <span>Êú¨Âë®Êä•Âëä</span>
                </div>
                <span class="report-period" id="reportPeriod">Êú¨Âë®</span>
            </div>
            <div class="report-grid" id="reportGrid">
                <!-- Report items will be dynamically added -->
            </div>
        </div>

        <!-- Celebration Overlay -->
        <div class="celebration-overlay" id="celebrationOverlay">
            <div class="milestone-card" id="milestoneCard">
                <div class="milestone-emoji" id="milestoneEmoji">üéâ</div>
                <div class="milestone-title" id="milestoneTitle">ÊÅ≠ÂñúÔºÅ</div>
                <div class="milestone-message" id="milestoneMessage">ËææÊàê‰∫Ü‰∏Ä‰∏™ÈáçË¶ÅÁöÑÈáåÁ®ãÁ¢ëÔºÅ</div>
                <div class="milestone-stats" id="milestoneStats">
                    <!-- Stats will be dynamically added -->
                </div>
                <button class="milestone-close" onclick="closeMilestoneCard()">Â§™Ê£í‰∫ÜÔºÅÁªßÁª≠Âä†Ê≤π üí™</button>
            </div>
        </div>

        <!-- Body Measurements -->
        <div class="card">
            <h2 class="card-title">
                <span class="icon">üìè</span>
                Ë∫´‰ΩìÂõ¥Â∫¶
                <button class="export-btn" onclick="openMeasurementsModal()" style="margin-left: auto;">+ Ê∑ªÂä†</button>
            </h2>
            <div class="measurements-grid" id="measurementsGrid" style="display: none;">
                <!-- Measurements will be dynamically added -->
            </div>
            <div id="measurementsEmpty" style="text-align: center; padding: 30px; color: #7f8c8d;">
                <span style="font-size: 3rem;">üìè</span>
                <p>ËøòÊ≤°ÊúâËÆ∞ÂΩïÂõ¥Â∫¶ÔºåÁÇπÂáª"Ê∑ªÂä†"ÂºÄÂßãËÆ∞ÂΩïÔºÅ</p>
            </div>
        </div>

        <!-- Mood Distribution -->
        <div class="mood-chart-container" id="moodChartContainer" style="display: none;">
            <div class="mood-chart-title">üòä ÂøÉÊÉÖÂàÜÂ∏É</div>
            <div class="mood-chart" id="moodChart"></div>
            <div class="mood-legend" id="moodLegend"></div>
        </div>

        <!-- Achievements -->
        <div class="achievements-section" id="achievementsSection" style="display: none;">
            <div class="achievements-title">üèÜ ÊàêÂ∞±ÂæΩÁ´†</div>
            <div class="achievements-grid" id="achievementsGrid">
                <!-- Achievements will be dynamically added -->
            </div>
        </div>

        <!-- Share Modal -->
        <div class="share-modal" id="shareModal">
            <div class="share-card" id="shareCard">
                <div class="share-card-header">
                    <div class="share-card-badge" id="shareBadge">üèÜ</div>
                    <div class="share-card-title" id="shareTitle">ÊàêÂ∞±Ëß£ÈîÅÔºÅ</div>
                    <div class="share-card-subtitle" id="shareSubtitle">ÊàëÂú®‰ΩìÈáçÂ∞èÊú¨Êú¨‰∏≠Ëé∑Âæó‰∫Ü‰∏Ä‰∏™ÊàêÂ∞±</div>
                </div>
                <div class="share-card-stats" id="shareStats">
                    <div class="share-stat">
                        <div class="share-stat-value" id="shareWeight">--</div>
                        <div class="share-stat-label">ÂΩìÂâç‰ΩìÈáç</div>
                    </div>
                    <div class="share-stat">
                        <div class="share-stat-value" id="shareStreak">--</div>
                        <div class="share-stat-label">ËøûÁª≠ËÆ∞ÂΩï</div>
                    </div>
                    <div class="share-stat">
                        <div class="share-stat-value" id="shareDays">--</div>
                        <div class="share-stat-label">ËÆ∞ÂΩïÂ§©Êï∞</div>
                    </div>
                </div>
                <div class="share-actions">
                    <button class="share-btn" onclick="shareToWechat()">
                        <span>üí¨</span> ÂæÆ‰ø°
                    </button>
                    <button class="share-btn" onclick="shareToWeibo()">
                        <span>üåê</span> ÂæÆÂçö
                    </button>
                    <button class="share-btn download" onclick="downloadShareCard()">
                        <span>üì•</span> ‰øùÂ≠ò
                    </button>
                    <button class="share-btn close" onclick="closeShareModal()">
                        <span>‚úï</span> ÂÖ≥Èó≠
                    </button>
                </div>
            </div>
        </div>

        <!-- Progress Photos -->
        <div class="card">
            <h2 class="card-title">
                <span class="icon">üì∏</span>
                ËøõÂ∫¶ÁÖßÁâá
            </h2>
            <div class="photos-grid" id="photosGrid">
                <div class="empty-photos">
                    <span class="emoji">üì∑</span>
                    <p>Ê∑ªÂä†ÁÖßÁâáËÆ∞ÂΩïË∫´‰ΩìÂèòÂåñ</p>
                </div>
            </div>
        </div>

        <!-- Water Tracker -->
        <div class="water-tracker" id="waterTracker">
            <div class="water-title">
                <span>üíß ‰ªäÊó•È•ÆÊ∞¥</span>
                <button class="export-btn" onclick="resetWater()">ÈáçÁΩÆ</button>
            </div>
            <div class="water-visual" id="waterVisual">
                <!-- Water glasses will be dynamically added -->
            </div>
            <div class="water-info">
                <div class="water-stat">
                    <div class="water-stat-value" id="waterCount">0</div>
                    <div class="water-stat-label">ÊùØÊï∞</div>
                </div>
                <div class="water-stat">
                    <div class="water-stat-value" id="waterML">0ml</div>
                    <div class="water-stat-label">ÊëÑÂÖ•Èáè</div>
                </div>
                <div class="water-stat">
                    <div class="water-stat-value" id="waterGoal">8</div>
                    <div class="water-stat-label">ÁõÆÊ†áÊùØÊï∞</div>
                </div>
            </div>
        </div>

        <!-- Exercise Logger -->
        <div class="exercise-logger" id="exerciseLogger">
            <div class="exercise-title">
                <span>üèÉ ËøêÂä®ËÆ∞ÂΩï</span>
                <span id="totalCalories" style="font-family: 'Caveat', cursive; font-size: 1.3rem; color: #e74c3c;">0 ÂçÉÂç°</span>
            </div>
            <div class="exercise-types" id="exerciseTypes">
                <div class="exercise-type" data-type="walking" data-calories="4">
                    <span class="exercise-icon">üö∂</span>
                    <span class="exercise-name">Ê≠•Ë°å</span>
                </div>
                <div class="exercise-type" data-type="running" data-calories="10">
                    <span class="exercise-icon">üèÉ</span>
                    <span class="exercise-name">Ë∑ëÊ≠•</span>
                </div>
                <div class="exercise-type" data-type="cycling" data-calories="8">
                    <span class="exercise-icon">üö¥</span>
                    <span class="exercise-name">È™ëË°å</span>
                </div>
                <div class="exercise-type" data-type="swimming" data-calories="9">
                    <span class="exercise-icon">üèä</span>
                    <span class="exercise-name">Ê∏∏Ê≥≥</span>
                </div>
                <div class="exercise-type" data-type="yoga" data-calories="3">
                    <span class="exercise-icon">üßò</span>
                    <span class="exercise-name">Áëú‰ºΩ</span>
                </div>
                <div class="exercise-type" data-type="weights" data-calories="6">
                    <span class="exercise-icon">üèãÔ∏è</span>
                    <span class="exercise-name">ÂäõÈáè</span>
                </div>
            </div>
            <div class="exercise-duration">
                <label>Êó∂ÈïøÔºàÂàÜÈíüÔºâÔºö</label>
                <input type="range" id="exerciseDuration" min="5" max="120" value="30" oninput="document.getElementById('durationValue').textContent = this.value + ' ÂàÜÈíü'">
                <span id="durationValue">30 ÂàÜÈíü</span>
            </div>
            <button class="btn" onclick="addExercise()" style="margin-top: 10px; width: 100%;">Ê∑ªÂä†ËøêÂä®ËÆ∞ÂΩï</button>
            <div class="exercise-list" id="exerciseList">
                <!-- Exercise items will be dynamically added -->
            </div>
        </div>

        <!-- Sleep Tracker -->
        <div class="sleep-tracker" id="sleepTracker">
            <div class="sleep-title">
                <span>üò¥ Áù°Áú†ËøΩË∏™</span>
                <button class="export-btn" onclick="openSleepModal()">+ ËÆ∞ÂΩïÁù°Áú†</button>
            </div>
            <div class="sleep-visual">
                <span class="moon">üåô</span>
                <div class="sleep-info">
                    <div class="sleep-hours" id="avgSleepHours">--</div>
                    <div class="sleep-avg">Âπ≥ÂùáÁù°Áú†Êó∂Èïø</div>
                </div>
            </div>
            <div style="margin-top: 15px; text-align: center;">
                <span style="font-size: 0.9rem; color: #555;">Êò®ÊôöÁù°Áú†Ôºö<span id="lastSleepHours" style="font-family: 'Caveat', cursive; font-size: 1.2rem;">--</span> Â∞èÊó∂</span>
            </div>
        </div>

        <!-- Health Calculators -->
        <div class="calculators-section" id="healthCalculators">
            <div class="calculator-title">üßÆ ÂÅ•Â∫∑ËÆ°ÁÆóÂô®</div>
            <div class="calculator-tabs">
                <div class="calculator-tab active" data-calc="bmr">Âü∫Á°Ä‰ª£Ë∞¢</div>
                <div class="calculator-tab" data-calc="ideal">ÁêÜÊÉ≥‰ΩìÈáç</div>
                <div class="calculator-tab" data-calc="water">ÊØèÊó•È•ÆÊ∞¥</div>
                <div class="calculator-tab" data-calc="calories">Âç°Ë∑ØÈáåÈúÄÊ±Ç</div>
            </div>
            <div class="calculator-content" id="calculatorContent">
                <!-- Calculator content will be dynamically updated -->
            </div>
        </div>

        <!-- History -->
        <div class="card">
            <h2 class="card-title">
                <span class="icon">üìñ</span>
                ÂéÜÂè≤ËÆ∞ÂΩï
            </h2>
            <div class="export-section">
                <button class="export-btn" onclick="exportData('csv')">üìÑ ÂØºÂá∫ CSV</button>
                <button class="export-btn" onclick="exportData('json')">üìã ÂØºÂá∫ JSON</button>
                <button class="export-btn" onclick="importData()">üì• ÂØºÂÖ•Êï∞ÊçÆ</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
            </div>
            <ul class="weight-list" id="weightList">
                <div class="empty-state">
                    <span class="emoji">üóíÔ∏è</span>
                    <p>ËøòÊ≤°ÊúâËÆ∞ÂΩïÂì¶ÔºåÂºÄÂßãËÆ∞ÂΩï‰Ω†ÁöÑÁ¨¨‰∏ÄÊ¨°ÂêßÔºÅ</p>
                </div>
            </ul>
        </div>

        <!-- Reminder Banner -->
        <div class="reminder-banner" id="reminderBanner" style="display: none;">
            <div class="reminder-content">
                <span class="reminder-icon">‚è∞</span>
                <div class="reminder-text">
                    <div class="reminder-title" id="reminderTitle">ËØ•ËÆ∞ÂΩï‰ΩìÈáçÂï¶ÔºÅ</div>
                    <div class="reminder-subtitle" id="reminderSubtitle">‰øùÊåÅÊØèÊó•ËÆ∞ÂΩï‰π†ÊÉØÔºåËßÅËØÅÊõ¥Â•ΩÁöÑËá™Â∑±</div>
                </div>
            </div>
            <div class="reminder-actions">
                <button class="reminder-btn" onclick="scrollToForm()">Áé∞Âú®ËÆ∞ÂΩï</button>
                <button class="reminder-close" onclick="dismissReminder()">√ó</button>
            </div>
        </div>

        <!-- Goal Calculator -->
        <div class="goal-calculator" id="goalCalculator">
            <div class="goal-calc-header">
                <span>üéØ</span>
                <span class="goal-calc-title">ÁõÆÊ†áËÆ°ÁÆóÂô®</span>
            </div>
            <div class="goal-calc-inputs">
                <div class="goal-calc-input-group">
                    <div class="goal-calc-label">ÂΩìÂâç‰ΩìÈáç (kg)</div>
                    <input type="number" class="goal-calc-input" id="calcCurrentWeight" placeholder="70" step="0.1">
                </div>
                <div class="goal-calc-input-group">
                    <div class="goal-calc-label">ÁõÆÊ†á‰ΩìÈáç (kg)</div>
                    <input type="number" class="goal-calc-input" id="calcGoalWeight" placeholder="65" step="0.1">
                </div>
                <div class="goal-calc-input-group">
                    <div class="goal-calc-label">ÊØèÂë®ÂáèÈáç (kg)</div>
                    <input type="number" class="goal-calc-input" id="calcWeeklyLoss" placeholder="0.5" step="0.1">
                </div>
                <div class="goal-calc-input-group">
                    <div class="goal-calc-label">Ë∫´È´ò (cm)</div>
                    <input type="number" class="goal-calc-input" id="calcHeight" placeholder="165" step="1">
                </div>
            </div>
            <button class="goal-calc-btn" onclick="calculateGoal()">üîÆ ËÆ°ÁÆóÁõÆÊ†á</button>
            <div class="goal-calc-results" id="goalResults">
                <div class="goal-result-row">
                    <span class="goal-result-label">üìÖ È¢ÑËÆ°Êó∂Èó¥</span>
                    <span class="goal-result-value" id="resultTime">--</span>
                </div>
                <div class="goal-result-row">
                    <span class="goal-result-label">üéØ ÁõÆÊ†áBMI</span>
                    <span class="goal-result-value" id="resultBMI">--</span>
                </div>
                <div class="goal-result-row">
                    <span class="goal-result-label">üìä ÊÄªÂáèÈáç</span>
                    <span class="goal-result-value" id="resultTotalLoss">--</span>
                </div>
                <div class="goal-result-row">
                    <span class="goal-result-label">‚úÖ ÂÅ•Â∫∑ËØÑ‰º∞</span>
                    <span class="goal-result-value" id="resultHealth">--</span>
                </div>
            </div>
        </div>

        <!-- Body Fat Calculator -->
        <div class="body-fat-calculator" id="bodyFatCalculator">
            <div class="body-fat-header">
                <span>üìê</span>
                <span class="body-fat-title">‰ΩìËÑÇÁéáËÆ°ÁÆóÂô®</span>
            </div>
            <div class="body-fat-formula">
                <button class="body-fat-formula-btn active" data-formula="bmi" onclick="setBodyFatFormula('bmi')">BMIÂÖ¨Âºè</button>
                <button class="body-fat-formula-btn" data-formula="navy" onclick="setBodyFatFormula('navy')">ÁæéÊµ∑ÂÜõÂÖ¨Âºè</button>
            </div>
            <div class="body-fat-inputs" id="bodyFatInputs">
                <!-- BMI Formula Inputs -->
                <div class="body-fat-input-group">
                    <div class="body-fat-label">Ë∫´È´ò (cm)</div>
                    <input type="number" class="body-fat-input" id="bfHeight" placeholder="165" step="1">
                </div>
                <div class="body-fat-input-group">
                    <div class="body-fat-label">‰ΩìÈáç (kg)</div>
                    <input type="number" class="body-fat-input" id="bfWeight" placeholder="65" step="0.1">
                </div>
                <div class="body-fat-input-group">
                    <div class="body-fat-label">Âπ¥ÈæÑ</div>
                    <input type="number" class="body-fat-input" id="bfAge" placeholder="25" step="1">
                </div>
                <div class="body-fat-input-group">
                    <div class="body-fat-label">ÊÄßÂà´</div>
                    <select class="body-fat-input" id="bfGender">
                        <option value="female">Â•≥</option>
                        <option value="male">Áî∑</option>
                    </select>
                </div>
            </div>
            <button class="body-fat-calculate-btn" onclick="calculateBodyFat()">üî¢ ËÆ°ÁÆó‰ΩìËÑÇÁéá</button>
            <div class="body-fat-results" id="bodyFatResults">
                <div class="body-fat-result-value" id="bodyFatValue">--%</div>
                <div class="body-fat-result-category" id="bodyFatCategory">--</div>
                <div class="body-fat-ranges" id="bodyFatRanges">
                    <!-- Ranges will be dynamically added -->
                </div>
            </div>
        </div>

        <!-- Milestone Tracker -->
        <div class="milestone-tracker" id="milestoneTracker" style="display: none;">
            <div class="milestone-header">
                <span>üèÜ</span>
                <span class="milestone-title">ÂáèÈáçÈáåÁ®ãÁ¢ë</span>
            </div>
            <div class="milestone-progress">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-family: 'Patrick Hand', cursive;">Á¥ØËÆ°ÂáèÈáç</span>
                    <span style="font-family: 'Caveat', cursive; font-size: 1.3rem;" id="totalLostDisplay">-- kg</span>
                </div>
                <div class="milestone-progress-bar">
                    <div class="milestone-progress-fill" id="milestoneProgressFill" style="width: 0%">0%</div>
                </div>
            </div>
            <div class="milestone-grid" id="milestoneGrid">
                <!-- Milestones will be dynamically added -->
            </div>
        </div>

        <!-- Progress Photo Gallery -->
        <div class="photo-gallery" id="photoGallery">
            <div class="photo-gallery-header">
                <div class="photo-gallery-title">
                    <span>üì∏</span>
                    <span>ËøõÂ∫¶ÁÖßÁâá</span>
                </div>
                <button class="photo-upload-btn" onclick="openPhotoUpload()">
                    üì∑ Ê∑ªÂä†ÁÖßÁâá
                </button>
            </div>
            <div class="photo-grid" id="photoGrid">
                <!-- Photos will be dynamically added -->
            </div>
            <div class="photo-empty" id="photoEmpty">
                <div class="photo-empty-icon">üì∑</div>
                <p>ËøòÊ≤°ÊúâËøõÂ∫¶ÁÖßÁâáÔºåËÆ∞ÂΩï‰Ω†ÁöÑÂèòÂåñÂéÜÁ®ãÂêßÔºÅ</p>
            </div>
        </div>

        <!-- Streak Rewards -->
        <div class="streak-rewards" id="streakRewards">
            <div class="streak-rewards-header">
                <span>üî•</span>
                <span class="streak-rewards-title">ËøûÁª≠ËÆ∞ÂΩïÂ•ñÂä±</span>
            </div>
            <div class="streak-counter">
                <span class="streak-label">ËøûÁª≠ËÆ∞ÂΩï</span>
                <span class="streak-fire" style="font-size: 2.5rem;">üî•</span>
                <span class="streak-number" id="streakNumber">0</span>
                <span class="streak-label">Â§©</span>
            </div>
            <div class="streak-levels" id="streakLevels">
                <!-- Streak levels will be dynamically added -->
            </div>
        </div>

        <!-- BMI Chart Section -->
        <div class="bmi-chart-section" id="bmiChartSection" style="display: none;">
            <div class="bmi-chart-header">
                <div class="bmi-chart-title">
                    <span>üìä</span>
                    <span>BMI ÂéÜÂè≤Êõ≤Á∫ø</span>
                </div>
            </div>
            <div class="bmi-chart-container">
                <canvas id="bmiChart"></canvas>
            </div>
            <div class="bmi-zones">
                <div class="bmi-zone bmi-zone-underweight">
                    <span>üíô</span>
                    <span>ÂÅèÁò¶ (&lt;18.5)</span>
                </div>
                <div class="bmi-zone bmi-zone-normal">
                    <span>üíö</span>
                    <span>Ê≠£Â∏∏ (18.5-24)</span>
                </div>
                <div class="bmi-zone bmi-zone-overweight">
                    <span>üíõ</span>
                    <span>ÂÅèËÉñ (24-28)</span>
                </div>
                <div class="bmi-zone bmi-zone-obese">
                    <span>‚ù§Ô∏è</span>
                    <span>ËÇ•ËÉñ (&gt;28)</span>
                </div>
            </div>
        </div>

        <!-- Weight Achievement Badges -->
        <div class="weight-badges" id="weightBadges" style="display: none;">
            <div class="weight-badges-header">
                <span>üéñÔ∏è</span>
                <span class="weight-badges-title">‰ΩìÈáçÊàêÂ∞±ÂæΩÁ´†</span>
            </div>
            <div class="badges-grid" id="badgesGrid">
                <!-- Badges will be dynamically added -->
            </div>
        </div>

        <!-- Before/After Comparison -->
        <div class="before-after-section" id="beforeAfterSection" style="display: none;">
            <div class="before-after-header">
                <div class="before-after-title">
                    <span>üì∏</span>
                    <span>ÂâçÂêéÂØπÊØî</span>
                </div>
                <div class="before-after-selectors">
                    <select id="beforePhotoSelect" class="before-after-btn" onchange="updateBeforeAfter()">
                        <option value="">ÈÄâÊã©ÂºÄÂßãÁÖßÁâá</option>
                    </select>
                    <select id="afterPhotoSelect" class="before-after-btn" onchange="updateBeforeAfter()">
                        <option value="">ÈÄâÊã©ÁªìÊùüÁÖßÁâá</option>
                    </select>
                </div>
            </div>
            <div class="before-after-comparison" id="beforeAfterContent">
                <div class="comparison-empty">
                    <div style="font-size: 3rem;">üì∑</div>
                    <p>ÈÄâÊã©‰∏§Âº†ÁÖßÁâáËøõË°åÂØπÊØî</p>
                </div>
            </div>
        </div>

        <!-- Weight Stability Indicator -->
        <div class="stability-indicator" id="stabilityIndicator" style="display: none;">
            <div class="stability-header">
                <span>üìä</span>
                <span class="stability-title">‰ΩìÈáçË∂ãÂäøÂàÜÊûê</span>
            </div>
            <div class="staturity-period-tabs">
                <button class="stability-tab active" onclick="setStabilityPeriod(7)" data-period="7">Ëøë7Â§©</button>
                <button class="stability-tab" onclick="setStabilityPeriod(14)" data-period="14">Ëøë14Â§©</button>
                <button class="stability-tab" onclick="setStabilityPeriod(30)" data-period="30">Ëøë30Â§©</button>
            </div>
            <div class="stability-content">
                <div class="stability-main">
                    <span class="stability-icon" id="stabilityIcon">üìà</span>
                    <div class="stability-status" id="stabilityStatus">--</div>
                    <div class="stability-description" id="stabilityDescription">--</div>
                </div>
                <div class="stability-metrics">
                    <div class="stability-metric">
                        <div class="stability-metric-label">Âπ≥Âùá‰ΩìÈáç</div>
                        <div class="stability-metric-value" id="stabilityAvg">--</div>
                    </div>
                    <div class="stability-metric">
                        <div class="stability-metric-label">‰ΩìÈáçÂèòÂåñ</div>
                        <div class="stability-metric-value" id="stabilityChange">--</div>
                    </div>
                    <div class="stability-metric">
                        <div class="stability-metric-label">Ê≥¢Âä®ËåÉÂõ¥</div>
                        <div class="stability-metric-value" id="stabilityRange">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Dashboard -->
        <div class="stats-dashboard" id="statsDashboard" style="display: none;">
            <div class="stats-dashboard-header">
                <div class="stats-dashboard-title">
                    <span>üìà</span>
                    <span>ÁªüËÆ°Ê¶ÇËßà</span>
                </div>
                <div class="stats-time-range">
                    <button class="stats-range-btn active" onclick="setStatsRange('week')" data-range="week">Âë®</button>
                    <button class="stats-range-btn" onclick="setStatsRange('month')" data-range="month">Êúà</button>
                    <button class="stats-range-btn" onclick="setStatsRange('all')" data-range="all">ÂÖ®ÈÉ®</button>
                </div>
            </div>
            <div class="stats-metrics" id="statsMetrics">
                <!-- Metrics will be dynamically added -->
            </div>
        </div>

        <!-- Period Comparison -->
        <div class="period-comparison" id="periodComparison" style="display: none;">
            <div class="comparison-header">
                <div class="comparison-title">
                    <span>üìä</span>
                    <span>Âë®ÊúüÂØπÊØî</span>
                </div>
                <div class="comparison-periods">
                    <button class="comparison-period-btn active" onclick="setComparisonPeriod('week')" data-period="week">Âë®</button>
                    <button class="comparison-period-btn" onclick="setComparisonPeriod('month')" data-period="month">Êúà</button>
                    <button class="comparison-period-btn" onclick="setComparisonPeriod('quarter')" data-period="quarter">Â≠£</button>
                </div>
            </div>
            <div class="comparison-grid" id="comparisonGrid">
                <!-- Comparison items will be dynamically added -->
            </div>
        </div>

        <!-- Data Management -->
        <div class="card">
            <h2 class="card-title">
                <span class="icon">üíæ</span>
                Êï∞ÊçÆÁÆ°ÁêÜ
            </h2>
            <div style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;">
                <button class="btn btn-sky" onclick="exportToCSV()" style="flex: 1; min-width: 150px;">
                    üì§ ÂØºÂá∫CSV
                </button>
                <button class="btn btn-lavender" onclick="triggerImport()" style="flex: 1; min-width: 150px;">
                    üì• ÂØºÂÖ•Êï∞ÊçÆ
                </button>
                <button class="btn btn-coral" onclick="exportToJSON()" style="flex: 1; min-width: 150px;">
                    üìã ÂØºÂá∫Â§á‰ªΩ
                </button>
                <input type="file" id="importFile" accept=".csv,.json" style="display: none;" onchange="importData(event)">
            </div>
            <div style="margin-top: 15px; padding: 12px; background: var(--paper); border-radius: 10px; border: 1px dashed var(--ink); font-size: 0.9rem; color: #666;">
                <strong>üí° ÊèêÁ§∫Ôºö</strong> ÂØºÂá∫CSVÂèØÂú®Excel‰∏≠Êü•ÁúãÔºåÂØºÂÖ•CSVÂèØÊâπÈáèÊ∑ªÂä†ËÆ∞ÂΩï„ÄÇÂØºÂá∫Â§á‰ªΩÂåÖÂê´ÊâÄÊúâÊï∞ÊçÆÔºåÂèØÁî®‰∫éÊï∞ÊçÆÊÅ¢Â§ç„ÄÇ
            </div>
        </div>

        <!-- Footer -->
        <footer style="margin-top: 40px; padding: 30px 20px; text-align: center; position: relative;">
            <svg class="svg-doodle" viewBox="0 0 200 20" style="position: absolute; top: -10px; left: 0; right: 0; width: 100%;">
                <path d="M0,10 Q25,0 50,10 T100,10 T150,10 T200,10" fill="none" stroke="#a8e6cf" stroke-width="3" stroke-linecap="round"/>
            </svg>
            <div style="font-family: 'Caveat', cursive; font-size: 1.3rem; color: var(--ink); margin-bottom: 10px;">
                ËÆ∞ÂΩïÊØè‰∏ÄÂ§©ÁöÑÂèòÂåñÔºåÈÅáËßÅÊõ¥Â•ΩÁöÑËá™Â∑± ‚ú®
            </div>
            <div style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 15px;">
                ÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºåÂä†Ê≤πÔºÅüí™
            </div>
            <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                <span style="font-size: 1.5rem;">üå±</span>
                <span style="font-size: 1.5rem;">üíö</span>
                <span style="font-size: 1.5rem;">üåø</span>
                <span style="font-size: 1.5rem;">üçÉ</span>
                <span style="font-size: 1.5rem;">üå∏</span>
            </div>
            <div style="margin-top: 20px; font-size: 0.8rem; color: #95a5a6;">
                Made with üíú for your health journey ¬∑ <span id="recordCount">0</span> records and counting!
            </div>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSettings()">√ó</button>
            <h2 style="font-family: 'Caveat', cursive; font-size: 2rem; margin-bottom: 20px;">‚öôÔ∏è ‰∏™‰∫∫ËÆæÁΩÆ</h2>

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label for="height">üìè Ë∫´È´ò (cm)</label>
                <input type="number" id="height" min="100" max="250" placeholder="‰æãÂ¶Ç: 170">
            </div>

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label for="goalWeight">üéØ ÁõÆÊ†á‰ΩìÈáç (kg)</label>
                <input type="number" id="goalWeight" step="0.1" min="30" max="200" placeholder="‰æãÂ¶Ç: 60">
            </div>

            <button class="btn" onclick="saveSettings()">‰øùÂ≠òËÆæÁΩÆ üíæ</button>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeEditModal()">√ó</button>
            <h2 style="font-family: 'Caveat', cursive; font-size: 2rem; margin-bottom: 20px;">‚úèÔ∏è ÁºñËæëËÆ∞ÂΩï</h2>

            <input type="hidden" id="editIndex">

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label for="editDate">üìÖ Êó•Êúü</label>
                <input type="date" id="editDate">
            </div>

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label for="editWeight">‚öñÔ∏è ‰ΩìÈáç (kg)</label>
                <input type="number" id="editWeight" step="0.1" min="0" max="500">
            </div>

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label for="editNote">üí≠ Â§áÊ≥®</label>
                <textarea id="editNote" rows="2"></textarea>
            </div>

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label>üòä ÂøÉÊÉÖ</label>
                <div class="mood-selector" id="editMoodSelector">
                    <div class="mood-option" data-mood="great" title="ÂæàÊ£í">üòÑ</div>
                    <div class="mood-option" data-mood="good" title="‰∏çÈîô">üôÇ</div>
                    <div class="mood-option" data-mood="okay" title="‰∏ÄËà¨">üòê</div>
                    <div class="mood-option" data-mood="bad" title="‰∏çÂ•Ω">üòî</div>
                    <div class="mood-option" data-mood="awful" title="Á≥üÁ≥ï">üò´</div>
                </div>
                <input type="hidden" id="editMood" value="">
            </div>

            <button class="btn" onclick="saveEdit()">‰øùÂ≠ò‰øÆÊîπ üíæ</button>
        </div>
    </div>

    <!-- Measurements Modal -->
    <div class="modal" id="measurementsModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeMeasurementsModal()">√ó</button>
            <h2 style="font-family: 'Caveat', cursive; font-size: 2rem; margin-bottom: 20px;">üìè Ê∑ªÂä†Âõ¥Â∫¶ËÆ∞ÂΩï</h2>

            <div class="measurements-inputs">
                <div class="input-wrapper">
                    <label for="chest">üìê ËÉ∏Âõ¥ (cm)</label>
                    <input type="number" id="chest" step="0.1" min="50" max="150" placeholder="‰æãÂ¶Ç: 90">
                </div>
                <div class="input-wrapper">
                    <label for="waist">üìê ËÖ∞Âõ¥ (cm)</label>
                    <input type="number" id="waist" step="0.1" min="40" max="150" placeholder="‰æãÂ¶Ç: 70">
                </div>
                <div class="input-wrapper">
                    <label for="hips">üìê ËáÄÂõ¥ (cm)</label>
                    <input type="number" id="hips" step="0.1" min="50" max="160" placeholder="‰æãÂ¶Ç: 95">
                </div>
                <div class="input-wrapper">
                    <label for="thigh">üìê Â§ßËÖø (cm)</label>
                    <input type="number" id="thigh" step="0.1" min="30" max="100" placeholder="‰æãÂ¶Ç: 55">
                </div>
                <div class="input-wrapper">
                    <label for="arm">üìê ÊâãËáÇ (cm)</label>
                    <input type="number" id="arm" step="0.1" min="15" max="50" placeholder="‰æãÂ¶Ç: 28">
                </div>
                <div class="input-wrapper">
                    <label for="neck">üìê È¢àÂõ¥ (cm)</label>
                    <input type="number" id="neck" step="0.1" min="20" max="50" placeholder="‰æãÂ¶Ç: 35">
                </div>
            </div>

            <div class="input-wrapper" style="margin-top: 15px;">
                <label for="measurementDate">üìÖ Êó•Êúü</label>
                <input type="date" id="measurementDate">
            </div>

            <button class="btn" onclick="saveMeasurements()" style="margin-top: 15px;">‰øùÂ≠òËÆ∞ÂΩï üíæ</button>
        </div>
    </div>

    <!-- Sleep Modal -->
    <div class="modal" id="sleepModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSleepModal()">√ó</button>
            <h2 style="font-family: 'Caveat', cursive; font-size: 2rem; margin-bottom: 20px;">üò¥ ËÆ∞ÂΩïÁù°Áú†</h2>

            <div class="sleep-input">
                <div class="input-wrapper">
                    <label for="sleepDate">üìÖ Êó•Êúü</label>
                    <input type="date" id="sleepDate">
                </div>
                <div class="input-wrapper">
                    <label for="sleepHours">‚è∞ Áù°Áú†Êó∂ÈïøÔºàÂ∞èÊó∂Ôºâ</label>
                    <input type="number" id="sleepHours" step="0.5" min="0" max="24" placeholder="‰æãÂ¶Ç: 7.5">
                </div>
            </div>

            <div class="input-wrapper">
                <label>‚≠ê Áù°Áú†Ë¥®Èáè</label>
                <div class="sleep-quality" id="sleepQuality">
                    <div class="quality-option" data-quality="1">üò´</div>
                    <div class="quality-option" data-quality="2">üòî</div>
                    <div class="quality-option" data-quality="3">üòê</div>
                    <div class="quality-option" data-quality="4">üôÇ</div>
                    <div class="quality-option" data-quality="5">üòÑ</div>
                </div>
                <input type="hidden" id="sleepQualityValue" value="">
            </div>

            <div class="input-wrapper" style="margin-top: 15px;">
                <label for="sleepNote">üí≠ Â§áÊ≥®ÔºàÂèØÈÄâÔºâ</label>
                <textarea id="sleepNote" placeholder="Áù°ÂæóÊÄé‰πàÊ†∑Ôºü..." rows="2"></textarea>
            </div>

            <button class="btn" onclick="saveSleep()" style="margin-top: 15px;">‰øùÂ≠òÁù°Áú†ËÆ∞ÂΩï üíæ</button>
        </div>
    </div>

    <!-- Photo Upload Modal -->
    <div class="modal" id="photoModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closePhotoModal()">√ó</button>
            <h2 style="font-family: 'Caveat', cursive; font-size: 2rem; margin-bottom: 20px;">üì∏ Ê∑ªÂä†ËøõÂ∫¶ÁÖßÁâá</h2>

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label for="photoDate">üìÖ Êó•Êúü</label>
                <input type="date" id="photoDate">
            </div>

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label for="photoWeight">‚öñÔ∏è ÂΩìÊó∂‰ΩìÈáç (kg, ÂèØÈÄâ)</label>
                <input type="number" id="photoWeight" step="0.1" min="30" max="200" placeholder="‰æãÂ¶Ç: 65">
            </div>

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label for="photoNote">üí≠ Â§áÊ≥® (ÂèØÈÄâ)</label>
                <textarea id="photoNote" placeholder="ËøôÂº†ÁÖßÁâáÁöÑÊÑüÊÉ≥..." rows="2"></textarea>
            </div>

            <div class="input-wrapper" style="margin-bottom: 20px;">
                <label for="photoFile">üì∑ ÈÄâÊã©ÁÖßÁâá</label>
                <input type="file" id="photoFile" accept="image/*" style="border: 2px dashed var(--ink); padding: 20px; border-radius: 10px; width: 100%; cursor: pointer;">
            </div>

            <div id="photoPreview" style="display: none; margin-bottom: 20px; text-align: center;">
                <img id="photoPreviewImg" style="max-width: 100%; max-height: 300px; border-radius: 10px; border: 2px solid var(--ink);">
            </div>

            <button class="btn" onclick="savePhoto()" style="margin-top: 15px;">‰øùÂ≠òÁÖßÁâá üíæ</button>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="share-modal" id="shareModal">
        <div class="share-modal-content">
            <h2 class="share-modal-title">üì§ ÂàÜ‰∫´‰Ω†ÁöÑËøõÊ≠•</h2>
            <div class="share-preview">
                <div class="share-preview-icon" id="sharePreviewIcon">üèÜ</div>
                <div class="share-preview-text" id="sharePreviewText">ÈáåÁ®ãÁ¢ëËææÊàê</div>
                <div class="share-preview-stats" id="sharePreviewStats">ÂáèÈáç 5kg</div>
            </div>
            <div class="share-options">
                <div class="share-option" onclick="shareToClipboard()">
                    <span class="share-option-icon">üìã</span>
                    <span>Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</span>
                </div>
                <div class="share-option" onclick="shareToWeChat()">
                    <span class="share-option-icon">üí¨</span>
                    <span>ÂàÜ‰∫´Âà∞ÂæÆ‰ø°</span>
                </div>
                <div class="share-option" onclick="shareToWeibo()">
                    <span class="share-option-icon">üåê</span>
                    <span>ÂàÜ‰∫´Âà∞ÂæÆÂçö</span>
                </div>
                <div class="share-option" onclick="closeShareModal()">
                    <span class="share-option-icon">‚úñÔ∏è</span>
                    <span>ÂèñÊ∂à</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab" onclick="openQuickAdd()">
        <span class="fab-icon">‚öñÔ∏è</span>
        <div class="fab-tooltip">Âø´ÈÄüËÆ∞ÂΩï‰ΩìÈáç</div>
    </div>

    <!-- Quick Add Modal -->
    <div class="quick-add-modal" id="quickAddModal">
        <div class="quick-add-content">
            <h2 class="quick-add-title">‚öñÔ∏è ËÆ∞ÂΩï‰ΩìÈáç</h2>
            <input type="number" class="quick-add-input" id="quickAddWeight" placeholder="65.5" step="0.1" min="30" max="300" autofocus>
            <div class="quick-add-buttons">
                <button class="quick-add-btn quick-add-btn-secondary" onclick="closeQuickAdd()">ÂèñÊ∂à</button>
                <button class="quick-add-btn quick-add-btn-primary" onclick="submitQuickAdd()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
        // Confetti
        const confettiCanvas = document.getElementById('confettiCanvas');
        const ctxConfetti = confettiCanvas.getContext('2d');
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;

        let confetti = [];
        const confettiColors = ['#a8e6cf', '#ffd3b6', '#d4a5db', '#b8d8e0', '#ffaaa5', '#fff5ba'];

        function createConfettiPiece(x, y) {
            return {
                x: x || Math.random() * confettiCanvas.width,
                y: y || -10,
                size: Math.random() * 10 + 5,
                color: confettiColors[Math.floor(Math.random() * confettiColors.length)],
                speedX: Math.random() * 4 - 2,
                speedY: Math.random() * 3 + 2,
                rotation: Math.random() * 360,
                rotationSpeed: Math.random() * 10 - 5
            };
        }

        function launchConfetti(count = 50) {
            for (let i = 0; i < count; i++) {
                confetti.push(createConfettiPiece(confettiCanvas.width / 2 + (Math.random() - 0.5) * 100));
            }
            if (!confettiAnimating) {
                confettiAnimating = true;
                animateConfetti();
            }
        }

        let confettiAnimating = false;

        function animateConfetti() {
            ctxConfetti.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);

            confetti = confetti.filter(c => c.y < confettiCanvas.height + 20);

            confetti.forEach(c => {
                c.x += c.speedX;
                c.y += c.speedY;
                c.rotation += c.rotationSpeed;

                ctxConfetti.save();
                ctxConfetti.translate(c.x, c.y);
                ctxConfetti.rotate(c.rotation * Math.PI / 180);
                ctxConfetti.fillStyle = c.color;
                ctxConfetti.fillRect(-c.size / 2, -c.size / 2, c.size, c.size);
                ctxConfetti.restore();
            });

            if (confetti.length > 0) {
                requestAnimationFrame(animateConfetti);
            } else {
                confettiAnimating = false;
            }
        }

        window.addEventListener('resize', () => {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
        });

        // Data management
        const STORAGE_KEY = 'weightTrackerData';
        const SETTINGS_KEY = 'weightTrackerSettings';
        const MEASUREMENTS_KEY = 'bodyMeasurements';
        const ACHIEVEMENTS_KEY = 'achievements';
        const PHOTOS_KEY = 'progressPhotos';
        const UNLOCKED_KEY = 'unlockedAchievements';
        const WATER_KEY = 'waterIntake';
        const EXERCISE_KEY = 'exerciseLog';
        const SLEEP_KEY = 'sleepLog';
        const PROFILE_KEY = 'userProfile';
        const CHALLENGES_KEY = 'dailyChallenges';

        let weightData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY)) || {
            height: null,
            goalWeight: null,
            gender: 'female'
        };
        let measurements = JSON.parse(localStorage.getItem(MEASUREMENTS_KEY)) || [];
        let progressPhotos = JSON.parse(localStorage.getItem(PHOTOS_KEY)) || [];
        let unlockedAchievements = JSON.parse(localStorage.getItem(UNLOCKED_KEY)) || [];
        let goalAchieved = false;
        let waterData = JSON.parse(localStorage.getItem(WATER_KEY)) || { glasses: 0, date: null };
        let exerciseLog = JSON.parse(localStorage.getItem(EXERCISE_KEY)) || [];
        let sleepLog = JSON.parse(localStorage.getItem(SLEEP_KEY)) || [];
        let userProfile = JSON.parse(localStorage.getItem(PROFILE_KEY)) || {
            avatar: 'üßë',
            name: 'ÂÅ•Â∫∑Ëææ‰∫∫',
            xp: 0,
            level: 1
        };
        let dailyChallenges = JSON.parse(localStorage.getItem(CHALLENGES_KEY)) || {
            date: null,
            completed: []
        };

        // Date range filter for chart
        let dateRangeFilter = {
            type: 'all', // 'all', 'week', 'month', 'quarter', 'year', 'custom'
            startDate: null,
            endDate: null
        };

        // Get filtered weight data based on date range
        function getFilteredWeightData() {
            if (dateRangeFilter.type === 'all' || !weightData.length) {
                return weightData;
            }

            const now = new Date();
            let startDate;

            switch (dateRangeFilter.type) {
                case 'week':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - 7);
                    break;
                case 'month':
                    startDate = new Date(now);
                    startDate.setMonth(now.getMonth() - 1);
                    break;
                case 'quarter':
                    startDate = new Date(now);
                    startDate.setMonth(now.getMonth() - 3);
                    break;
                case 'year':
                    startDate = new Date(now);
                    startDate.setFullYear(now.getFullYear() - 1);
                    break;
                case 'custom':
                    startDate = new Date(dateRangeFilter.startDate);
                    break;
            }

            const endDate = dateRangeFilter.type === 'custom' ?
                new Date(dateRangeFilter.endDate) : now;

            return weightData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= startDate && itemDate <= endDate;
            });
        }

        // Set date range preset
        function setDateRange(range) {
            dateRangeFilter.type = range;
            dateRangeFilter.startDate = null;
            dateRangeFilter.endDate = null;

            // Update active button
            document.querySelectorAll('.date-range-preset').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.range === range) {
                    btn.classList.add('active');
                }
            });

            // Clear custom date inputs
            document.getElementById('dateRangeStart').value = '';
            document.getElementById('dateRangeEnd').value = '';

            updateChart();
        }

        // Set custom date range
        function setCustomDateRange() {
            const startDate = document.getElementById('dateRangeStart').value;
            const endDate = document.getElementById('dateRangeEnd').value;

            if (!startDate || !endDate) {
                showWarningNotification('ËØ∑ÈÄâÊã©ÂºÄÂßãÂíåÁªìÊùüÊó•Êúü');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                showWarningNotification('ÂºÄÂßãÊó•Êúü‰∏çËÉΩÊôö‰∫éÁªìÊùüÊó•Êúü');
                return;
            }

            dateRangeFilter.type = 'custom';
            dateRangeFilter.startDate = startDate;
            dateRangeFilter.endDate = endDate;

            // Remove active class from preset buttons
            document.querySelectorAll('.date-range-preset').forEach(btn => {
                btn.classList.remove('active');
            });

            updateChart();
            showSuccessNotification('Â∑≤Â∫îÁî®Ëá™ÂÆö‰πâÊó•ÊúüËåÉÂõ¥');
        }

        // Level system
        const levels = [
            { level: 1, xp: 0, title: 'ÂàùÁ∫ßËÆ∞ÂΩïËÄÖ' },
            { level: 2, xp: 100, title: 'ÂÅ•Â∫∑Êñ∞Êâã' },
            { level: 3, xp: 300, title: 'ÂùöÊåÅËÄÖ' },
            { level: 4, xp: 600, title: 'ÂÅ•Â∫∑Ëææ‰∫∫' },
            { level: 5, xp: 1000, title: '‰ΩìÈáçÁÆ°ÁêÜÂ∏à' },
            { level: 6, xp: 1500, title: 'ÂÅ•Ë∫´Ëææ‰∫∫' },
            { level: 7, xp: 2100, title: 'ÂÅ•Â∫∑‰∏ìÂÆ∂' },
            { level: 8, xp: 2800, title: 'Ë∂ÖÁ∫ßËææ‰∫∫' },
            { level: 9, xp: 3600, title: '‰º†Â•áËÆ∞ÂΩïËÄÖ' },
            { level: 10, xp: 4500, title: 'ÂÅ•Â∫∑Â§ßÂ∏à' }
        ];

        const avatars = ['üßë', 'üë©', 'üßí', 'üë¥', 'üëµ', 'ü¶∏', 'ü¶∏‚Äç‚ôÄÔ∏è', 'üßô', 'üßô‚Äç‚ôÄÔ∏è', 'üßö', 'üßö‚Äç‚ôÄÔ∏è', 'ü¶ä', 'üê±', 'üê∂', 'üêº', 'üê®'];

        // Daily challenge definitions
        const challengeDefinitions = [
            { id: 'record_weight', icon: '‚öñÔ∏è', title: 'ËÆ∞ÂΩï‰ΩìÈáç', reward: 20, check: () => weightData.some(d => new Date(d.date).toDateString() === new Date().toDateString()) },
            { id: 'drink_water', icon: 'üíß', title: 'È•ÆÊ∞¥8ÊùØ', reward: 15, check: () => waterData.glasses >= 8 },
            { id: 'exercise', icon: 'üèÉ', title: 'ËøêÂä®30ÂàÜÈíü', reward: 25, check: () => {
                const today = new Date().toDateString();
                const todayExercises = exerciseLog.filter(e => new Date(e.date).toDateString() === today);
                return todayExercises.reduce((sum, e) => sum + e.duration, 0) >= 30;
            }},
            { id: 'sleep_8h', icon: 'üò¥', title: 'Áù°Áú†8Â∞èÊó∂', reward: 15, check: () => {
                const today = new Date().toDateString();
                const lastSleep = sleepLog.find(s => new Date(s.date).toDateString() === today);
                return lastSleep && lastSleep.hours >= 8;
            }},
            { id: 'streak_3', icon: 'üî•', title: 'ËøûÁª≠3Â§©', reward: 30, check: () => calculateStreak() >= 3 },
            { id: 'mood_positive', icon: 'üòä', title: 'Â•ΩÂøÉÊÉÖ', reward: 10, check: () => {
                const today = new Date().toDateString();
                const todayEntry = weightData.find(d => new Date(d.date).toDateString() === today);
                return todayEntry && ['great', 'good'].includes(todayEntry.mood);
            }}
        ];

        // Achievement definitions
        const achievementDefinitions = [
            { id: 'first', icon: 'üéâ', name: 'Á¨¨‰∏ÄÊ¨°', description: 'ËÆ∞ÂΩïÁ¨¨‰∏ÄÊ¨°‰ΩìÈáç' },
            { id: 'week', icon: '7Ô∏è‚É£', name: '‰∏ÄÂë®ÂùöÊåÅ', description: 'ËøûÁª≠ËÆ∞ÂΩï7Â§©' },
            { id: 'month', icon: 'üìÖ', name: '‰∏ÄÊúàÂùöÊåÅ', description: 'ËøûÁª≠ËÆ∞ÂΩï30Â§©' },
            { id: 'ten_records', icon: 'üîü', name: 'ÂçÅÊ¨°ËÆ∞ÂΩï', description: 'Á¥ØËÆ°ËÆ∞ÂΩï10Ê¨°' },
            { id: 'fifty_records', icon: 'üìä', name: '‰∫îÂçÅÊ¨°ËÆ∞ÂΩï', description: 'Á¥ØËÆ°ËÆ∞ÂΩï50Ê¨°' },
            { id: 'goal_reached', icon: 'üéØ', name: 'ËææÊàêÁõÆÊ†á', description: 'ËææÂà∞ÁõÆÊ†á‰ΩìÈáç' },
            { id: 'five_lost', icon: '‚¨áÔ∏è', name: 'ÂáèÈáç5kg', description: 'Á¥ØËÆ°ÂáèÈáç5ÂÖ¨Êñ§' },
            { id: 'ten_lost', icon: '‚¨áÔ∏è', name: 'ÂáèÈáç10kg', description: 'Á¥ØËÆ°ÂáèÈáç10ÂÖ¨Êñ§' },
            { id: 'streak_7', icon: 'üî•', name: 'ÁÅ´ÁÑ∞Âë®', description: 'ËøûÁª≠ËÆ∞ÂΩï7Â§©' },
            { id: 'mood_tracker', icon: 'üòä', name: 'ÂøÉÊÉÖËÆ∞ÂΩï', description: 'ËÆ∞ÂΩïÂøÉÊÉÖ10Ê¨°' },
            { id: 'early_bird', icon: 'üåÖ', name: 'Êó©Ëµ∑È∏ü', description: 'Êó©‰∏ä6-9ÁÇπËÆ∞ÂΩï' },
            { id: 'night_owl', icon: 'ü¶â', name: 'Â§úÁå´Â≠ê', description: 'Êôö‰∏ä9-12ÁÇπËÆ∞ÂΩï' },
            { id: 'consistent', icon: 'üìà', name: '‰øùÊåÅÁ®≥ÂÆö', description: '‰ΩìÈáçÊ≥¢Âä®Â∞è‰∫é1kg' },
            { id: 'measurement_pro', icon: 'üìè', name: 'Âõ¥Â∫¶Ëææ‰∫∫', description: 'ËÆ∞ÂΩïÂõ¥Â∫¶5Ê¨°' },
            { id: 'photo_taker', icon: 'üì∏', name: 'ÊãçÁÖßËææ‰∫∫', description: '‰∏ä‰º†3Âº†ËøõÂ∫¶ÁÖßÁâá' },
            { id: 'data_exporter', icon: 'üíæ', name: 'Êï∞ÊçÆËææ‰∫∫', description: 'ÂØºÂá∫Êï∞ÊçÆ' }
        ];

        const motivations = [
            "ÊØè‰∏Ä‰∏™Â∞èËøõÊ≠•ÈÉΩÂÄºÂæóÂ∫ÜÁ•ùÔºÅüí™",
            "ÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºåÂä†Ê≤πÔºÅüåü",
            "‰Ω†ÁöÑÂä™ÂäõÁªàÂ∞ÜÈó™ËÄÄÔºÅ‚ú®",
            "Áõ∏‰ø°Ëá™Â∑±Ôºå‰Ω†ÂèØ‰ª•ÂÅöÂà∞ÔºÅüí´",
            "‰ªäÂ§©‰πüË¶ÅÂÖÉÊ∞îÊª°Êª°ÔºÅüåà",
            "ÂÅ•Â∫∑ÁöÑË∫´‰ΩìÊòØÊúÄÁæéÁöÑÔºÅüå∏",
            "‰∏ÄÊ≠•‰∏Ä‰∏™ËÑöÂç∞ÔºåÁ®≥Á®≥ÂêëÂâçÔºÅüë£",
            "‰Ω†ÊØîËá™Â∑±ÊÉ≥Ë±°ÁöÑÊõ¥Âº∫Â§ßÔºÅüíñ",
            "‰øùÊåÅËÆ∞ÂΩïÔºåËßÅËØÅÊîπÂèòÔºÅüìù",
            "ÊØè‰∏ÄÂ§©ÈÉΩÊòØÊñ∞ÁöÑÂºÄÂßãÔºÅüåÖ",
            "‰Ω†ÂÅöÂæóÂ§™Ê£í‰∫ÜÔºÅÁªßÁª≠Âä†Ê≤πÔºÅüéâ",
            "Â∞èÁõÆÊ†áÊàêÂ∞±Â§ßÊ¢¶ÊÉ≥ÔºÅüåü"
        ];

        document.getElementById('motivation').textContent = motivations[Math.floor(Math.random() * motivations.length)];
        document.getElementById('date').valueAsDate = new Date();

        // Daily tips
        const dailyTips = [
            "‰øùÊåÅËßÑÂæã‰ΩúÊÅØÔºåÂùáË°°È•ÆÈ£üÔºåÈÄÇÈáèËøêÂä®ÊòØÂÅ•Â∫∑ÁîüÊ¥ªÁöÑ‰∏âÂ§ßÂü∫Áü≥„ÄÇ",
            "ÊØèÂ§©ÂñùË∂≥Â§üÁöÑÊ∞¥ÂèØ‰ª•‰øÉËøõÊñ∞Èôà‰ª£Ë∞¢ÔºåÂ∏ÆÂä©Áª¥ÊåÅÂÅ•Â∫∑‰ΩìÈáç„ÄÇ",
            "Êó©È§êË¶ÅÂêÉÂ•ΩÔºåÂçàÈ§êË¶ÅÂêÉÈ•±ÔºåÊôöÈ§êË¶ÅÂêÉÂ∞ëÔºåÂÅ•Â∫∑È•ÆÈ£ü‰ªé‰∏âÈ§êÂºÄÂßã„ÄÇ",
            "ÊØèÂë®Ëá≥Â∞ë150ÂàÜÈíüÁöÑ‰∏≠Á≠âÂº∫Â∫¶ÊúâÊ∞ßËøêÂä®ÔºåÊúâÂä©‰∫éÁª¥ÊåÅÂÅ•Â∫∑‰ΩìÈáç„ÄÇ",
            "ÂÖÖË∂≥ÁöÑÁù°Áú†Ôºà7-9Â∞èÊó∂ÔºâÊúâÂä©‰∫éÊéßÂà∂È£üÊ¨≤ÊøÄÁ¥†ÔºåÂáèÂ∞ë‰ΩìÈáçÊ≥¢Âä®„ÄÇ",
            "ÊÖ¢ÊÖ¢ËøõÈ£üÔºåËÆ©Â§ßËÑëÊúâÊó∂Èó¥Êé•Êî∂È•±ËÖπ‰ø°Âè∑ÔºåÈÅøÂÖçËøáÈáèËøõÈ£ü„ÄÇ",
            "Áî®Â∞èÁõòÂ≠êÁõõÈ§êÂèØ‰ª•Ëá™ÁÑ∂ÊéßÂà∂È£üÈáèÔºåÂáèÂ∞ëÁÉ≠ÈáèÊëÑÂÖ•„ÄÇ",
            "È•≠ÂâçÂñù‰∏ÄÊùØÊ∞¥ÂèØ‰ª•Â¢ûÂä†È•±ËÖπÊÑüÔºåÂáèÂ∞ëËøõÈ£üÈáè„ÄÇ",
            "‰πÖÂùêÂêéËµ∑Êù•Ê¥ªÂä®5ÂàÜÈíüÔºåÊúâÂä©‰∫éÊèêÈ´òÊñ∞Èôà‰ª£Ë∞¢„ÄÇ",
            "ËÆ∞ÂΩï‰ΩìÈáçÂèØ‰ª•Â∏ÆÂä©‰Ω†‰∫ÜËß£Ëá™Â∑±ÁöÑË∫´‰ΩìÔºåÂÅöÂá∫Êõ¥Â•ΩÁöÑÂÅ•Â∫∑ÈÄâÊã©„ÄÇ"
        ];
        const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
        document.getElementById('dailyTip').textContent = dailyTips[dayOfYear % dailyTips.length];

        // Seasonal theme detection
        function applySeasonalTheme() {
            const month = new Date().getMonth() + 1;
            const seasonalElements = {
                spring: { emoji: 'üå∏', color: '#ffb7c5', name: 'Êò•' },      // March-May
                summer: { emoji: '‚òÄÔ∏è', color: '#fff4b5', name: 'Â§è' },      // June-August
                autumn: { emoji: 'üçÇ', color: '#ffd89b', name: 'Áßã' },      // September-November
                winter: { emoji: '‚ùÑÔ∏è', color: '#b8d8e0', name: 'ÂÜ¨' }       // December-February
            };

            let season;
            if (month >= 3 && month <= 5) season = seasonalElements.spring;
            else if (month >= 6 && month <= 8) season = seasonalElements.summer;
            else if (month >= 9 && month <= 11) season = seasonalElements.autumn;
            else season = seasonalElements.winter;

            // Add seasonal decoration to header if not exists
            if (!document.getElementById('seasonalDecoration')) {
                const header = document.querySelector('header');
                const seasonalBadge = document.createElement('div');
                seasonalBadge.id = 'seasonalDecoration';
                seasonalBadge.style.cssText = 'position: absolute; top: 10px; right: 20px; font-size: 1.5rem; animation: float 4s ease-in-out infinite;';
                seasonalBadge.textContent = season.emoji;
                seasonalBadge.title = `${season.name}Â≠£`;
                header.style.position = 'relative';
                header.appendChild(seasonalBadge);
            }
        }

        applySeasonalTheme();

        // Dark mode
        let isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            document.body.classList.add('dark-mode');
            document.querySelector('.dark-mode-toggle').textContent = '‚òÄÔ∏è';
        }

        function toggleDarkMode() {
            setTheme('dark');
        }

        // Theme System
        let currentTheme = localStorage.getItem('theme') || 'default';

        function setTheme(themeName) {
            // Remove all theme classes
            document.body.classList.remove('dark-mode', 'theme-ocean', 'theme-forest', 'theme-sunset', 'theme-berry', 'theme-midnight', 'theme-lavender');

            // Add new theme class
            if (themeName !== 'default') {
                document.body.classList.add(themeName === 'dark' ? 'dark-mode' : `theme-${themeName}`);
            }

            // Save and update current
            currentTheme = themeName;
            localStorage.setItem('theme', themeName);

            // Update active state in theme panel
            document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
            const activeOption = document.querySelector(`.theme-option[onclick="setTheme('${themeName}')"]`);
            if (activeOption) activeOption.classList.add('active');

            // Update chart colors
            updateChart();

            // Close panel
            document.getElementById('themePanel').classList.remove('active');
        }

        function toggleThemePanel() {
            document.getElementById('themePanel').classList.toggle('active');
        }

        // Notification System
        let notificationId = 0;

        function showNotification(title, message, type = 'info', icon = 'üìå', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const id = ++notificationId;

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.id = `notification-${id}`;
            notification.innerHTML = `
                <span class="notification-icon">${icon}</span>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="removeNotification(${id})">√ó</button>
            `;

            container.appendChild(notification);

            // Auto-remove after duration
            setTimeout(() => removeNotification(id), duration);

            return id;
        }

        function removeNotification(id) {
            const notification = document.getElementById(`notification-${id}`);
            if (notification) {
                notification.classList.add('removing');
                setTimeout(() => notification.remove(), 300);
            }
        }

        function showSuccessNotification(message) {
            return showNotification('ÊàêÂäü', message, 'success', '‚úÖ');
        }

        function showErrorNotification(message) {
            return showNotification('Âá∫Èîô‰∫Ü', message, 'error', '‚ùå');
        }

        function showWarningNotification(message) {
            return showNotification('Ê≥®ÊÑè', message, 'warning', '‚ö†Ô∏è');
        }

        function showAchievementNotification(title, message) {
            return showNotification(title, message, 'achievement', 'üèÜ', 7000);
        }

        // Quick Stats Widget
        let quickStatsExpanded = false;

        function updateQuickStats() {
            if (weightData.length === 0) {
                document.getElementById('quickStatsWeight').textContent = '--';
                document.getElementById('quickStatsTrend').textContent = '--';
                document.getElementById('quickStatsTrend').className = 'quick-stats-trend neutral';
                return;
            }

            const current = weightData[weightData.length - 1].weight;
            document.getElementById('quickStatsWeight').textContent = current.toFixed(1) + ' kg';

            if (weightData.length >= 2) {
                const prev = weightData[weightData.length - 2].weight;
                const change = current - prev;
                const trendEl = document.getElementById('quickStatsTrend');

                if (change < 0) {
                    trendEl.textContent = `‚Üì ${Math.abs(change).toFixed(1)}`;
                    trendEl.className = 'quick-stats-trend up';
                } else if (change > 0) {
                    trendEl.textContent = `‚Üë +${change.toFixed(1)}`;
                    trendEl.className = 'quick-stats-trend down';
                } else {
                    trendEl.textContent = '‚Üí 0';
                    trendEl.className = 'quick-stats-trend neutral';
                }
            } else {
                document.getElementById('quickStatsTrend').textContent = 'Êñ∞ËÆ∞ÂΩï';
                document.getElementById('quickStatsTrend').className = 'quick-stats-trend neutral';
            }
        }

        function toggleQuickStats() {
            const widget = document.getElementById('quickStatsWidget');
            quickStatsExpanded = !quickStatsExpanded;

            if (quickStatsExpanded) {
                // Expand to show more stats
                widget.classList.add('expanded');
                const streak = calculateStreak();
                const records = weightData.length;
                const achievements = unlockedAchievements.length;

                widget.innerHTML = `
                    <span class="quick-stats-icon">üìä</span>
                    <div class="quick-stats-info">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                            <div>
                                <span class="quick-stats-label">‰ΩìÈáç</span>
                                <span class="quick-stats-value" style="font-size: 1.2rem;">${weightData.length > 0 ? weightData[weightData.length - 1].weight.toFixed(1) : '--'}</span>
                            </div>
                            <div>
                                <span class="quick-stats-label">ËøûÁª≠</span>
                                <span class="quick-stats-value" style="font-size: 1.2rem;">${streak}Â§©</span>
                            </div>
                            <div>
                                <span class="quick-stats-label">ËÆ∞ÂΩï</span>
                                <span class="quick-stats-value" style="font-size: 1.2rem;">${records}</span>
                            </div>
                            <div>
                                <span class="quick-stats-label">ÊàêÂ∞±</span>
                                <span class="quick-stats-value" style="font-size: 1.2rem;">${achievements}/16</span>
                            </div>
                            <div>
                                <span class="quick-stats-label">Á≠âÁ∫ß</span>
                                <span class="quick-stats-value" style="font-size: 1.2rem;">Lv.${userProfile.level}</span>
                            </div>
                            <div>
                                <span class="quick-stats-label">ÁªèÈ™å</span>
                                <span class="quick-stats-value" style="font-size: 1.2rem;">${userProfile.xp}XP</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Collapse back to simple view
                widget.classList.remove('expanded');
                widget.innerHTML = `
                    <span class="quick-stats-icon">‚öñÔ∏è</span>
                    <div class="quick-stats-info">
                        <span class="quick-stats-label">ÂΩìÂâç‰ΩìÈáç</span>
                        <span class="quick-stats-value" id="quickStatsWeight">--</span>
                        <span class="quick-stats-trend" id="quickStatsTrend">--</span>
                    </div>
                `;
                updateQuickStats();
            }
        }

        // Period Comparison
        let currentComparisonPeriod = 'week';

        function setComparisonPeriod(period) {
            currentComparisonPeriod = period;

            // Update active button
            document.querySelectorAll('.comparison-period-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.period === period);
            });

            updatePeriodComparison();
        }

        function updatePeriodComparison() {
            const section = document.getElementById('periodComparison');
            const grid = document.getElementById('comparisonGrid');

            if (weightData.length < 4) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            const now = new Date();
            let periodDays, prevPeriodDays;

            switch (currentComparisonPeriod) {
                case 'week':
                    periodDays = 7;
                    prevPeriodDays = 7;
                    break;
                case 'month':
                    periodDays = 30;
                    prevPeriodDays = 30;
                    break;
                case 'quarter':
                    periodDays = 90;
                    prevPeriodDays = 90;
                    break;
            }

            const periodStart = new Date(now);
            periodStart.setDate(now.getDate() - periodDays);

            const prevPeriodStart = new Date(periodStart);
            prevPeriodStart.setDate(periodStart.getDate() - prevPeriodDays);

            // Current period data
            const currentPeriodData = weightData.filter(d => {
                const date = new Date(d.date);
                return date >= periodStart && date <= now;
            });

            // Previous period data
            const prevPeriodData = weightData.filter(d => {
                const date = new Date(d.date);
                return date >= prevPeriodStart && date < periodStart;
            });

            // Calculate comparisons
            const comparisons = [];

            // Average weight
            if (currentPeriodData.length > 0 && prevPeriodData.length > 0) {
                const currentAvg = currentPeriodData.reduce((sum, d) => sum + d.weight, 0) / currentPeriodData.length;
                const prevAvg = prevPeriodData.reduce((sum, d) => sum + d.weight, 0) / prevPeriodData.length;
                const change = currentAvg - prevAvg;

                comparisons.push({
                    label: 'Âπ≥Âùá‰ΩìÈáç',
                    value: currentAvg.toFixed(1) + ' kg',
                    change: change.toFixed(1) + ' kg',
                    changeType: change < 0 ? 'positive' : change > 0 ? 'negative' : 'neutral',
                    icon: change < 0 ? 'üìâ' : change > 0 ? 'üìà' : '‚û°Ô∏è'
                });
            }

            // Record count
            const currentRecords = currentPeriodData.length;
            const prevRecords = prevPeriodData.length;
            const recordChange = currentRecords - prevRecords;

            comparisons.push({
                label: 'ËÆ∞ÂΩïÊ¨°Êï∞',
                value: currentRecords.toString(),
                change: (recordChange >= 0 ? '+' : '') + recordChange.toString(),
                changeType: recordChange > 0 ? 'positive' : recordChange < 0 ? 'negative' : 'neutral',
                icon: recordChange > 0 ? 'üìà' : 'üìä'
            });

            // Min/Max weight
            if (currentPeriodData.length > 0) {
                const weights = currentPeriodData.map(d => d.weight);
                const min = Math.min(...weights);
                const max = Math.max(...weights);

                comparisons.push({
                    label: '‰ΩìÈáçËåÉÂõ¥',
                    value: `${min.toFixed(1)} - ${max.toFixed(1)}`,
                    change: ((max - min) / 2).toFixed(1) + ' kg Ê≥¢Âä®',
                    changeType: 'neutral',
                    icon: '‚ÜîÔ∏è'
                });
            }

            // Render grid
            grid.innerHTML = comparisons.map(comp => `
                <div class="comparison-item">
                    <div class="comparison-item-label">${comp.icon} ${comp.label}</div>
                    <div class="comparison-item-value">${comp.value}</div>
                    <div class="comparison-item-change ${comp.changeType}">
                        ${comp.change}
                    </div>
                </div>
            `).join('');
        }

        // Goal Calculator
        function calculateGoal() {
            const current = parseFloat(document.getElementById('calcCurrentWeight').value);
            const goal = parseFloat(document.getElementById('calcGoalWeight').value);
            const weeklyLoss = parseFloat(document.getElementById('calcWeeklyLoss').value);
            const height = parseFloat(document.getElementById('calcHeight').value);

            if (!current || !goal || !weeklyLoss || !height) {
                showWarningNotification('ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑËÆ°ÁÆó‰ø°ÊÅØ');
                return;
            }

            if (current <= goal) {
                showWarningNotification('ÁõÆÊ†á‰ΩìÈáçÂ∫î‰Ωé‰∫éÂΩìÂâç‰ΩìÈáç');
                return;
            }

            // Calculate results
            const totalLoss = current - goal;
            const weeksNeeded = Math.ceil(totalLoss / weeklyLoss);
            const daysNeeded = weeksNeeded * 7;

            // Calculate BMI
            const heightInM = height / 100;
            const currentBMI = (current / (heightInM * heightInM)).toFixed(1);
            const goalBMI = (goal / (heightInM * heightInM)).toFixed(1);

            // Health assessment
            let health = 'ËâØÂ•Ω';
            if (weeklyLoss > 1) {
                health = 'ËæÉÊøÄËøõ';
            } else if (weeklyLoss < 0.3) {
                health = 'ËæÉ‰øùÂÆà';
            }
            if (goalBMI < 18.5) {
                health += ' (ÁõÆÊ†áÂÅèËΩª)';
            } else if (goalBMI > 24) {
                health += ' (ÁõÆÊ†áÂÅèÈáç)';
            }

            // Display results
            document.getElementById('resultTime').textContent =
                weeksNeeded <= 4 ? `${weeksNeeded} Âë®` :
                weeksNeeded <= 16 ? `${Math.ceil(weeksNeeded / 4)} ‰∏™Êúà` :
                `${Math.ceil(weeksNeeded / 52)} Âπ¥`;

            document.getElementById('resultBMI').textContent = `${currentBMI} ‚Üí ${goalBMI}`;
            document.getElementById('resultTotalLoss').textContent = `${totalLoss.toFixed(1)} kg`;
            document.getElementById('resultHealth').textContent = health;

            document.getElementById('goalResults').classList.add('show');

            // Auto-fill settings
            settings.goalWeight = goal;
            settings.height = height;
            saveSettingsData();
            updateUI();

            showSuccessNotification('ÁõÆÊ†áËÆ°ÁÆóÂÆåÊàêÔºÅÂ∑≤Ëá™Âä®Êõ¥Êñ∞ËÆæÁΩÆ');
            addXP(15, '‰ΩøÁî®ÁõÆÊ†áËÆ°ÁÆóÂô®');
        }

        // Body Fat Calculator
        let currentBodyFatFormula = 'bmi';

        function setBodyFatFormula(formula) {
            currentBodyFatFormula = formula;

            // Update active button
            document.querySelectorAll('.body-fat-formula-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.formula === formula);
            });

            // Update inputs based on formula
            const inputsContainer = document.getElementById('bodyFatInputs');
            if (formula === 'bmi') {
                inputsContainer.innerHTML = `
                    <div class="body-fat-input-group">
                        <div class="body-fat-label">Ë∫´È´ò (cm)</div>
                        <input type="number" class="body-fat-input" id="bfHeight" placeholder="165" step="1">
                    </div>
                    <div class="body-fat-input-group">
                        <div class="body-fat-label">‰ΩìÈáç (kg)</div>
                        <input type="number" class="body-fat-input" id="bfWeight" placeholder="65" step="0.1">
                    </div>
                    <div class="body-fat-input-group">
                        <div class="body-fat-label">Âπ¥ÈæÑ</div>
                        <input type="number" class="body-fat-input" id="bfAge" placeholder="25" step="1">
                    </div>
                    <div class="body-fat-input-group">
                        <div class="body-fat-label">ÊÄßÂà´</div>
                        <select class="body-fat-input" id="bfGender">
                            <option value="female">Â•≥</option>
                            <option value="male">Áî∑</option>
                        </select>
                    </div>
                `;
            } else if (formula === 'navy') {
                inputsContainer.innerHTML = `
                    <div class="body-fat-input-group">
                        <div class="body-fat-label">Ë∫´È´ò (cm)</div>
                        <input type="number" class="body-fat-input" id="bfHeight" placeholder="165" step="1">
                    </div>
                    <div class="body-fat-input-group">
                        <div class="body-fat-label">È¢àÂõ¥ (cm)</div>
                        <input type="number" class="body-fat-input" id="bfNeck" placeholder="32" step="0.1">
                    </div>
                    <div class="body-fat-input-group">
                        <div class="body-fat-label">ËÖ∞Âõ¥ (cm)</div>
                        <input type="number" class="body-fat-input" id="bfWaist" placeholder="70" step="0.1">
                    </div>
                    <div class="body-fat-input-group">
                        <div class="body-fat-label">ËáÄÂõ¥ (cmÔºå‰ªÖÂ•≥ÊÄß)</div>
                        <input type="number" class="body-fat-input" id="bfHip" placeholder="95" step="0.1">
                    </div>
                    <div class="body-fat-input-group">
                        <div class="body-fat-label">ÊÄßÂà´</div>
                        <select class="body-fat-input" id="bfGender">
                            <option value="female">Â•≥</option>
                            <option value="male">Áî∑</option>
                        </select>
                    </div>
                `;
            }

            // Hide results
            document.getElementById('bodyFatResults').classList.remove('show');
        }

        function calculateBodyFat() {
            let bodyFat;

            if (currentBodyFatFormula === 'bmi') {
                const height = parseFloat(document.getElementById('bfHeight').value);
                const weight = parseFloat(document.getElementById('bfWeight').value);
                const age = parseFloat(document.getElementById('bfAge').value);
                const gender = document.getElementById('bfGender').value;

                if (!height || !weight || !age) {
                    showWarningNotification('ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑËÆ°ÁÆó‰ø°ÊÅØ');
                    return;
                }

                // BMI-based body fat formula (Deurenberg et al.)
                const bmi = weight / ((height / 100) ** 2);
                const childFactor = age < 18 ? (1.51 * bmi) - (0.70 * age) - 3.6 : 0;

                if (gender === 'male') {
                    bodyFat = (1.20 * bmi) + (0.23 * age) - 16.2;
                } else {
                    bodyFat = (1.20 * bmi) + (0.23 * age) - 5.4;
                }
            } else if (currentBodyFatFormula === 'navy') {
                const height = parseFloat(document.getElementById('bfHeight').value);
                const neck = parseFloat(document.getElementById('bfNeck').value);
                const waist = parseFloat(document.getElementById('bfWaist').value);
                const hip = parseFloat(document.getElementById('bfHip').value);
                const gender = document.getElementById('bfGender').value;

                if (!height || !neck || !waist) {
                    showWarningNotification('ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑËÆ°ÁÆó‰ø°ÊÅØ');
                    return;
                }

                if (gender === 'female' && !hip) {
                    showWarningNotification('Â•≥ÊÄßÈúÄË¶ÅÂ°´ÂÜôËáÄÂõ¥');
                    return;
                }

                // US Navy body fat formula
                if (gender === 'male') {
                    bodyFat = 495 / (1.0324 - 0.19077 * Math.log10(waist - neck) + 0.15456 * Math.log10(height)) - 450;
                } else {
                    bodyFat = 495 / (1.29579 - 0.35004 * Math.log10(waist + hip - neck) + 0.22100 * Math.log10(height)) - 450;
                }
            }

            bodyFat = Math.max(0, Math.min(100, bodyFat)); // Clamp between 0-100

            const gender = document.getElementById('bfGender').value;
            const category = getBodyFatCategory(bodyFat, gender);
            const ranges = getBodyFatRanges(gender);

            document.getElementById('bodyFatValue').textContent = `${bodyFat.toFixed(1)}%`;
            document.getElementById('bodyFatCategory').textContent = category;

            // Display ranges
            const rangesContainer = document.getElementById('bodyFatRanges');
            rangesContainer.innerHTML = ranges.map(range => `
                <div class="body-fat-range ${bodyFat >= range.min && bodyFat <= range.max ? 'current' : ''}">
                    <span>${range.label}</span>
                    <span>${range.min}% - ${range.max}%</span>
                </div>
            `).join('');

            document.getElementById('bodyFatResults').classList.add('show');
            showSuccessNotification('‰ΩìËÑÇÁéáËÆ°ÁÆóÂÆåÊàêÔºÅ');
            addXP(10, 'ËÆ°ÁÆó‰ΩìËÑÇÁéá');
        }

        function getBodyFatCategory(bodyFat, gender) {
            if (gender === 'male') {
                if (bodyFat < 6) return 'ÂøÖÈúÄËÑÇËÇ™';
                if (bodyFat < 14) return 'ËøêÂä®Âëò';
                if (bodyFat < 18) return 'ÂÅ•Ë∫´';
                if (bodyFat < 25) return 'ÂèØÊé•Âèó';
                return 'ÂÅèÈ´ò';
            } else {
                if (bodyFat < 14) return 'ÂøÖÈúÄËÑÇËÇ™';
                if (bodyFat < 21) return 'ËøêÂä®Âëò';
                if (bodyFat < 25) return 'ÂÅ•Ë∫´';
                if (bodyFat < 32) return 'ÂèØÊé•Âèó';
                return 'ÂÅèÈ´ò';
            }
        }

        function getBodyFatRanges(gender) {
            if (gender === 'male') {
                return [
                    { label: 'ÂøÖÈúÄËÑÇËÇ™', min: 2, max: 5 },
                    { label: 'ËøêÂä®Âëò', min: 6, max: 13 },
                    { label: 'ÂÅ•Ë∫´', min: 14, max: 17 },
                    { label: 'ÂèØÊé•Âèó', min: 18, max: 24 },
                    { label: 'ÂÅèÈ´ò', min: 25, max: 40 }
                ];
            } else {
                return [
                    { label: 'ÂøÖÈúÄËÑÇËÇ™', min: 10, max: 13 },
                    { label: 'ËøêÂä®Âëò', min: 14, max: 20 },
                    { label: 'ÂÅ•Ë∫´', min: 21, max: 24 },
                    { label: 'ÂèØÊé•Âèó', min: 25, max: 31 },
                    { label: 'ÂÅèÈ´ò', min: 32, max: 45 }
                ];
            }
        }

        // Statistics Dashboard
        let currentStatsRange = 'week';

        function setStatsRange(range) {
            currentStatsRange = range;

            // Update active button
            document.querySelectorAll('.stats-range-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.range === range);
            });

            updateStatsDashboard();
        }

        function updateStatsDashboard() {
            const section = document.getElementById('statsDashboard');
            const metricsContainer = document.getElementById('statsMetrics');

            if (weightData.length < 2) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            const now = new Date();
            let startDate;

            switch (currentStatsRange) {
                case 'week':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - 7);
                    break;
                case 'month':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - 30);
                    break;
                case 'all':
                    startDate = new Date(weightData[0].date);
                    break;
            }

            const periodData = weightData.filter(d => new Date(d.date) >= startDate && d.date <= now.toISOString().split('T')[0]);

            if (periodData.length === 0) {
                metricsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #666;">ÊâÄÈÄâÊó∂Èó¥ÊÆµÊ≤°ÊúâËÆ∞ÂΩï</p>';
                return;
            }

            const weights = periodData.map(d => d.weight);
            const min = Math.min(...weights);
            const max = Math.max(...weights);
            const avg = weights.reduce((sum, w) => sum + w, 0) / weights.length;
            const current = weights[weights.length - 1];
            const first = weights[0];
            const change = current - first;

            // Calculate daily average
            const daysInPeriod = Math.max(1, (new Date(periodData[periodData.length - 1].date) - new Date(periodData[0].date)) / (1000 * 60 * 60 * 24)) + 1;
            const recordsPerDay = (periodData.length / daysInPeriod).toFixed(1);

            // Calculate BMI if height is set
            let currentBMI = '--';
            if (settings.height) {
                currentBMI = (current / ((settings.height / 100) ** 2)).toFixed(1);
            }

            // Streak in this period
            const periodStreak = calculatePeriodStreak(startDate);

            const metrics = [
                {
                    icon: '‚öñÔ∏è',
                    label: 'Âπ≥Âùá‰ΩìÈáç',
                    value: avg.toFixed(1) + ' kg'
                },
                {
                    icon: 'üìä',
                    label: '‰ΩìÈáçËåÉÂõ¥',
                    value: `${min.toFixed(1)} - ${max.toFixed(1)}`
                },
                {
                    icon: 'üìà',
                    label: 'ÊÄªÂèòÂåñ',
                    value: (change >= 0 ? '+' : '') + change.toFixed(1) + ' kg',
                    change: change < 0 ? '‚Üì' : change > 0 ? '‚Üë' : '‚Üí',
                    changeType: change < 0 ? 'positive' : change > 0 ? 'negative' : 'neutral'
                },
                {
                    icon: 'üìù',
                    label: 'ËÆ∞ÂΩïÊ¨°Êï∞',
                    value: periodData.length.toString()
                },
                {
                    icon: 'üìÖ',
                    label: 'Êó•ÂùáËÆ∞ÂΩï',
                    value: recordsPerDay + ' Ê¨°'
                },
                {
                    icon: 'üî•',
                    label: 'ËøûÁª≠Â§©Êï∞',
                    value: periodStreak + ' Â§©'
                }
            ];

            metricsContainer.innerHTML = metrics.map(m => `
                <div class="stat-metric">
                    <div class="stat-metric-icon">${m.icon}</div>
                    <div class="stat-metric-label">${m.label}</div>
                    <div class="stat-metric-value">${m.value}</div>
                    ${m.change ? `<div class="stat-metric-change ${m.changeType}">${m.change}</div>` : ''}
                </div>
            `).join('');
        }

        function calculatePeriodStreak(startDate) {
            let streak = 0;
            const checkDate = new Date();

            while (true) {
                const dateStr = checkDate.toISOString().split('T')[0];
                const hasEntry = weightData.some(d => d.date === dateStr);

                if (hasEntry && new Date(checkDate) >= startDate) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }

            return streak;
        }

        // Reminder System
        function checkReminder() {
            const banner = document.getElementById('reminderBanner');
            const lastReminderDate = localStorage.getItem('lastReminderDate');
            const today = new Date().toDateString();

            // Show reminder if:
            // 1. Haven't shown today
            // 2. No weight record today
            // 3. Has existing data (not first time user)
            const todayRecord = weightData.some(d => d.date === today);

            if (lastReminderDate !== today && !todayRecord && weightData.length > 0) {
                const lastRecord = weightData[weightData.length - 1];
                const lastDate = new Date(lastRecord.date);
                const daysSince = Math.floor((new Date() - lastDate) / (1000 * 60 * 60 * 24));

                if (daysSince >= 1) {
                    // Show reminder
                    const messages = [
                        { title: 'ËØ•ËÆ∞ÂΩï‰ΩìÈáçÂï¶ÔºÅ', subtitle: 'Â∑≤Áªè ' + daysSince + ' Â§©Ê≤°ËÆ∞ÂΩï‰∫ÜÂì¶' },
                        { title: '‰øùÊåÅËÆ∞ÂΩï‰π†ÊÉØÔºÅ', subtitle: 'ÊØèÊó•ËÆ∞ÂΩïÊòØÂÅ•Â∫∑ÁÆ°ÁêÜÁöÑÁ¨¨‰∏ÄÊ≠•' },
                        { title: '‰ªäÂ§©ËøòÊ≤°ËÆ∞ÂΩï~', subtitle: 'ËÆ∞ÂΩï‰ªäÂ§©ÁöÑ‰ΩìÈáçÔºåËßÅËØÅË∫´‰ΩìÂèòÂåñ' }
                    ];

                    const msg = messages[Math.floor(Math.random() * messages.length)];
                    document.getElementById('reminderTitle').textContent = msg.title;
                    document.getElementById('reminderSubtitle').textContent = msg.subtitle;

                    banner.style.display = 'flex';
                    localStorage.setItem('lastReminderDate', today);
                }
            }
        }

        function dismissReminder() {
            const banner = document.getElementById('reminderBanner');
            banner.style.display = 'none';
        }

        // Check reminder periodically
        setInterval(checkReminder, 60000); // Check every minute

        // Also check on page load
        window.addEventListener('load', checkReminder);

        // Close theme panel when clicking outside
        document.addEventListener('click', function(e) {
            const switcher = document.getElementById('themeSwitcher');
            if (!switcher.contains(e.target)) {
                document.getElementById('themePanel').classList.remove('active');
            }
        });

        // Initialize theme on load
        window.addEventListener('DOMContentLoaded', function() {
            setTheme(currentTheme);
        });

        // FAB menu
        let fabMenuOpen = false;

        function toggleFabMenu() {
            fabMenuOpen = !fabMenuOpen;
            const items = document.querySelectorAll('.fab-menu-item');
            items.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.toggle('visible', fabMenuOpen);
                }, index * 50);
            });
        }

        function scrollToForm() {
            document.querySelector('.card').scrollIntoView({ behavior: 'smooth' });
            toggleFabMenu();
        }

        // Ambient Shower Effect
        const showerEmojis = ['‚ú®', '‚≠ê', 'üí´', 'üåü', '‚ú¶', '‚úß', '‚ùÑÔ∏è', 'üéÄ'];
        const showerContainer = document.getElementById('ambientShower');

        function createShowerParticle() {
            const particle = document.createElement('div');
            particle.className = 'shower-particle';
            particle.textContent = showerEmojis[Math.floor(Math.random() * showerEmojis.length)];
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDuration = (Math.random() * 5 + 8) + 's';
            particle.style.fontSize = (Math.random() * 0.5 + 0.6) + 'rem';
            particle.style.animationDelay = Math.random() * 2 + 's';

            showerContainer.appendChild(particle);

            // Remove particle after animation
            setTimeout(() => {
                particle.remove();
            }, 15000);
        }

        // Create particles periodically
        setInterval(createShowerParticle, 2000);

        // Initial batch of particles
        for (let i = 0; i < 5; i++) {
            setTimeout(createShowerParticle, i * 400);
        }

        // Extended Inspirational Quotes System
        const inspirationalQuotes = [
            { quote: "ÂçÉÈáå‰πãË°åÔºåÂßã‰∫éË∂≥‰∏ã„ÄÇ", author: "ËÄÅÂ≠ê", category: "journey" },
            { quote: "‰∏çÁßØË∑¨Ê≠•ÔºåÊó†‰ª•Ëá≥ÂçÉÈáå„ÄÇ", author: "ËçÄÂ≠ê", category: "persistence" },
            { quote: "Èî≤ËÄåËàç‰πãÔºåÊúΩÊú®‰∏çÊäòÔºõÈî≤ËÄå‰∏çËàçÔºåÈáëÁü≥ÂèØÈïÇ„ÄÇ", author: "ËçÄÂ≠ê", category: "persistence" },
            { quote: "Â§©Ë°åÂÅ•ÔºåÂêõÂ≠ê‰ª•Ëá™Âº∫‰∏çÊÅØ„ÄÇ", author: "„ÄäÊòìÁªè„Äã", category: "strength" },
            { quote: "ÂÆùÂâëÈîã‰ªéÁ£®Á†∫Âá∫ÔºåÊ¢ÖËä±È¶ôËá™Ëã¶ÂØíÊù•„ÄÇ", author: "Âè§ËØó", category: "hardship" },
            { quote: "ÈïøÈ£éÁ†¥Êµ™‰ºöÊúâÊó∂ÔºåÁõ¥ÊåÇ‰∫ëÂ∏ÜÊµéÊ≤ßÊµ∑„ÄÇ", author: "ÊùéÁôΩ", category: "hope" },
            { quote: "Ë∑ØÊº´Êº´ÂÖ∂‰øÆËøúÂÖÆÔºåÂêæÂ∞Ü‰∏ä‰∏ãËÄåÊ±ÇÁ¥¢„ÄÇ", author: "Â±àÂéü", category: "journey" },
            { quote: "‰ºöÂΩìÂáåÁªùÈ°∂Ôºå‰∏ÄËßà‰ºóÂ±±Â∞è„ÄÇ", author: "ÊùúÁî´", category: "achievement" },
            { quote: "ÂçÉÊ∑ò‰∏áÊºâËôΩËæõËã¶ÔºåÂêπÂ∞ΩÁãÇÊ≤ôÂßãÂà∞Èáë„ÄÇ", author: "ÂàòÁ¶πÈî°", category: "persistence" },
            { quote: "‰∏ñ‰∏äÊó†Èöæ‰∫ãÔºåÂè™ÊÄïÊúâÂøÉ‰∫∫„ÄÇ", author: "Ë∞öËØ≠", category: "determination" },
            { quote: "Where there is a will, there is a way.", author: "Pauline Kael", category: "determination" },
            { quote: "The journey of a thousand miles begins with one step.", author: "Lao Tzu", category: "journey" },
            { quote: "Success is not final, failure is not fatal.", author: "Winston Churchill", category: "perseverance" },
            { quote: "Believe you can and you're halfway there.", author: "Theodore Roosevelt", category: "belief" },
            { quote: "It does not matter how slowly you go as long as you do not stop.", author: "Confucius", category: "persistence" }
        ];

        function getRandomQuote() {
            return inspirationalQuotes[Math.floor(Math.random() * inspirationalQuotes.length)];
        }

        function getQuoteByCategory(category) {
            const filtered = inspirationalQuotes.filter(q => q.category === category);
            return filtered.length > 0
                ? filtered[Math.floor(Math.random() * filtered.length)]
                : getRandomQuote();
        }

        function displayMotivationalQuote() {
            const quote = getRandomQuote();
            const quoteContainer = document.getElementById('dailyTip');
            if (quoteContainer) {
                quoteContainer.textContent = `"${quote.quote}" ‚Äî ${quote.author}`;
            }
        }

        // Update quote daily or on specific events
        const lastQuoteDate = localStorage.getItem('lastQuoteDate');
        const today = new Date().toDateString();

        if (lastQuoteDate !== today) {
            displayMotivationalQuote();
            localStorage.setItem('lastQuoteDate', today);
        }

        // Weight-based motivational messages
        function getWeightBasedMessage(weightChange) {
            if (weightChange < -0.5) {
                return {
                    emoji: "üéâ",
                    message: "Â§™Ê£í‰∫ÜÔºÅ‰ΩìÈáç‰∏ãÈôçÂæóÂæàÂ•ΩÔºÅ"
                };
            } else if (weightChange < 0) {
                return {
                    emoji: "üëç",
                    message: "ËøõÊ≠•ËôΩÂ∞èÔºå‰ΩÜ‰πüÊòØËøõÊ≠•ÔºÅÁªßÁª≠Âä†Ê≤πÔºÅ"
                };
            } else if (weightChange < 0.5) {
                return {
                    emoji: "üòä",
                    message: "‰ΩìÈáç‰øùÊåÅÁ®≥ÂÆöÔºåÁªßÁª≠‰øùÊåÅÔºÅ"
                };
            } else {
                return {
                    emoji: "üí™",
                    message: "Âà´ÁÅ∞ÂøÉÔºåÊòéÂ§©ÈáçÊñ∞ÂºÄÂßãÔºÅ"
                };
            }
        }

        // Celebration sound effects (visual feedback)
        function triggerCelebrationEffect(type) {
            const effects = {
                small: { particles: 20, duration: 1000 },
                medium: { particles: 40, duration: 1500 },
                large: { particles: 80, duration: 2000 },
                mega: { particles: 150, duration: 3000 }
            };

            const effect = effects[type] || effects.medium;
            launchConfetti(effect.particles);

            // Add visual shake effect
            document.body.style.animation = 'none';
            setTimeout(() => {
                document.body.style.animation = '';
            }, 100);
        }

        // Update celebrations to use new effect system
        const originalLaunchConfetti = launchConfetti;
        launchConfetti = function(count) {
            originalLaunchConfetti(count);

            // Determine effect size based on particle count
            let effectType = 'small';
            if (count >= 150) effectType = 'mega';
            else if (count >= 80) effectType = 'large';
            else if (count >= 40) effectType = 'medium';

            // Trigger additional visual effects
            const showerContainer = document.getElementById('ambientShower');
            for (let i = 0; i < Math.min(count / 5, 10); i++) {
                setTimeout(createShowerParticle, i * 100);
            }
        };

        function scrollToStats() {
            document.querySelectorAll('.card')[1].scrollIntoView({ behavior: 'smooth' });
            toggleFabMenu();
        }

        function scrollToChart() {
            document.querySelectorAll('.card')[2].scrollIntoView({ behavior: 'smooth' });
            toggleFabMenu();
        }

        // Mood selector
        const moodOptions = document.querySelectorAll('.mood-option');
        let selectedMood = null;

        moodOptions.forEach(option => {
            option.addEventListener('click', function() {
                moodOptions.forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                selectedMood = this.dataset.mood;
                document.getElementById('mood').value = selectedMood;
            });
        });

        // Reset mood selector
        function resetMoodSelector() {
            moodOptions.forEach(o => o.classList.remove('selected'));
            selectedMood = null;
            document.getElementById('mood').value = '';
        }

        // Mood emoji mapping
        const moodEmojis = {
            'great': 'üòÑ',
            'good': 'üôÇ',
            'okay': 'üòê',
            'bad': 'üòî',
            'awful': 'üò´'
        };

        // Calendar heatmap
        function updateCalendarHeatmap() {
            if (weightData.length === 0) {
                document.getElementById('calendarHeatmap').style.display = 'none';
                return;
            }

            document.getElementById('calendarHeatmap').style.display = 'block';

            const grid = document.getElementById('heatmapGrid');
            const today = new Date();
            const startDate = new Date(today);
            startDate.setDate(startDate.getDate() - 34); // Show 35 days (5 weeks)

            // Get weight frequency for each day
            const weightFrequency = {};
            weightData.forEach(item => {
                if (!weightFrequency[item.date]) {
                    weightFrequency[item.date] = 0;
                }
                weightFrequency[item.date]++;
            });

            // Find max frequency for scaling
            const maxFreq = Math.max(...Object.values(weightFrequency), 1);

            // Generate grid
            grid.innerHTML = '';
            const todayStr = today.toISOString().split('T')[0];

            for (let i = 0; i < 35; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const freq = weightFrequency[dateStr] || 0;

                const day = document.createElement('div');
                day.className = 'heatmap-day';

                if (freq === 0) {
                    day.classList.add('empty');
                } else {
                    const level = Math.ceil((freq / maxFreq) * 5);
                    day.classList.add(`level-${level}`);
                    day.title = `${dateStr}: ${freq} Êù°ËÆ∞ÂΩï`;
                }

                if (dateStr === todayStr) {
                    day.classList.add('today');
                }

                grid.appendChild(day);
            }

            // Update stats summary
            document.getElementById('totalDays').textContent = weightData.length;
            document.getElementById('bestStreak').textContent = calculateBestStreak();
            document.getElementById('avgMood').textContent = calculateAverageMood();
        }

        function calculateBestStreak() {
            if (weightData.length < 2) return weightData.length;

            const dates = weightData.map(item => new Date(item.date).toDateString());
            const uniqueDates = [...new Set(dates)];

            let maxStreak = 1;
            let currentStreak = 1;

            for (let i = 1; i < uniqueDates.length; i++) {
                const prev = new Date(uniqueDates[i - 1]);
                const curr = new Date(uniqueDates[i]);
                const diffDays = (curr - prev) / (1000 * 60 * 60 * 24);

                if (diffDays === 1) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 1;
                }
            }

            return maxStreak;
        }

        function calculateAverageMood() {
            const moodValues = {
                'great': 5,
                'good': 4,
                'okay': 3,
                'bad': 2,
                'awful': 1
            };

            const moodEntries = weightData.filter(item => item.mood);
            if (moodEntries.length === 0) return '--';

            const sum = moodEntries.reduce((total, item) => total + (moodValues[item.mood] || 3), 0);
            const avg = sum / moodEntries.length;

            const moodEmojis = ['üò´', 'üòî', 'üòê', 'üôÇ', 'üòÑ'];
            const emojiIndex = Math.round(avg) - 1;
            return moodEmojis[Math.max(0, Math.min(4, emojiIndex))];
        }

        // Health insights
        function updateHealthInsights() {
            if (weightData.length < 3) {
                document.getElementById('healthInsights').style.display = 'none';
                return;
            }

            document.getElementById('healthInsights').style.display = 'block';

            const tips = generateHealthTips();
            const tipsContainer = document.getElementById('insightTips');
            tipsContainer.innerHTML = tips.map(tip => `
                <div class="insight-tip">
                    <span class="tip-icon">${tip.icon}</span>
                    <div class="tip-content">
                        <div class="tip-title">${tip.title}</div>
                        <div class="tip-text">${tip.text}</div>
                    </div>
                </div>
            `).join('');
        }

        function generateHealthTips() {
            const tips = [];
            const current = weightData[weightData.length - 1].weight;
            const previous = weightData[weightData.length - 2]?.weight;
            const first = weightData[0].weight;
            const trend7 = calculateTrend(7);
            const bmi = calculateBMI(current, settings.height);

            // Weight change tip
            if (previous) {
                const recentChange = current - previous;
                if (recentChange > 1) {
                    tips.push({
                        icon: 'üìà',
                        title: '‰ΩìÈáç‰∏äÂçá',
                        text: 'ÊúÄËøë‰ΩìÈáçÊúâÊâÄ‰∏äÂçáÔºåÊ≥®ÊÑèÈ•ÆÈ£üÂíåÈÄÇÈáèËøêÂä®Âì¶„ÄÇ‰øùÊåÅËÆ∞ÂΩïÊòØÁ¨¨‰∏ÄÊ≠•ÔºÅ'
                    });
                } else if (recentChange < -1) {
                    tips.push({
                        icon: 'üìâ',
                        title: '‰ΩìÈáç‰∏ãÈôç',
                        text: '‰ΩìÈáç‰∏ãÈôç‰∏çÈîôÔºÅ‰ΩÜË¶ÅÊ≥®ÊÑè‰øùÊåÅÂÅ•Â∫∑ÁöÑÈÄüÂ∫¶ÔºåÊØèÂë®0.5-1kgÊòØÁêÜÊÉ≥ÁöÑ„ÄÇ'
                    });
                }
            }

            // BMI tip
            if (bmi) {
                const status = getBMIStatus(bmi);
                if (status.text === 'ÂÅèËÉñ' || status.text === 'ËÇ•ËÉñ') {
                    tips.push({
                        icon: 'üí™',
                        title: 'BMIÂª∫ËÆÆ',
                        text: `ÂΩìÂâçBMI‰∏∫${bmi.toFixed(1)}ÔºåÂª∫ËÆÆÂ¢ûÂä†ÊúâÊ∞ßËøêÂä®ÔºåÊéßÂà∂È•ÆÈ£üÁÉ≠Èáè„ÄÇ`
                    });
                } else if (status.text === 'ÂÅèÁò¶') {
                    tips.push({
                        icon: 'üçé',
                        title: 'BMIÂª∫ËÆÆ',
                        text: `ÂΩìÂâçBMI‰∏∫${bmi.toFixed(1)}ÔºåÂª∫ËÆÆÈÄÇÂΩìÂ¢ûÂä†Ëê•ÂÖªÊëÑÂÖ•ÔºåÈÖçÂêàÂäõÈáèËÆ≠ÁªÉ„ÄÇ`
                    });
                } else {
                    tips.push({
                        icon: '‚úÖ',
                        title: 'BMIÊ≠£Â∏∏',
                        text: 'BMIÂú®Ê≠£Â∏∏ËåÉÂõ¥ÂÜÖÔºåÁªßÁª≠‰øùÊåÅÂÅ•Â∫∑ÁöÑÁîüÊ¥ªÊñπÂºèÔºÅ'
                    });
                }
            }

            // Streak tip
            const streak = calculateStreak();
            if (streak >= 7) {
                tips.push({
                    icon: 'üî•',
                    title: 'ÂùöÊåÅËÆ∞ÂΩï',
                    text: `Â∑≤ËøûÁª≠ËÆ∞ÂΩï${streak}Â§©ÔºåËøô‰∏™‰π†ÊÉØÂ§™Ê£í‰∫ÜÔºÅÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºÅ`
                });
            } else if (streak >= 3) {
                tips.push({
                    icon: '‚≠ê',
                    title: 'ËÆ∞ÂΩï‰∏çÈîô',
                    text: `Â∑≤ËøûÁª≠ËÆ∞ÂΩï${streak}Â§©ÔºåÁªßÁª≠‰øùÊåÅÔºÅ`
                });
            }

            // Goal progress tip
            if (settings.goalWeight) {
                const goalDiff = current - settings.goalWeight;
                if (goalDiff > 0) {
                    const progress = ((first - current) / (first - settings.goalWeight)) * 100;
                    tips.push({
                        icon: 'üéØ',
                        title: 'ÁõÆÊ†áËøõÂ∫¶',
                        text: `Ë∑ùÁ¶ªÁõÆÊ†áËøòÊúâ${goalDiff.toFixed(1)}kgÔºåÂ∑≤ÂÆåÊàê${progress.toFixed(0)}%ÔºÅ`
                    });
                }
            }

            // Mood analysis tip
            const recentMoods = weightData.slice(-7).filter(item => item.mood);
            if (recentMoods.length >= 3) {
                const moodValues = { 'great': 5, 'good': 4, 'okay': 3, 'bad': 2, 'awful': 1 };
                const avgMood = recentMoods.reduce((sum, item) => sum + (moodValues[item.mood] || 3), 0) / recentMoods.length;
                if (avgMood <= 2.5) {
                    tips.push({
                        icon: 'üíô',
                        title: 'ÂøÉÊÉÖÂÖ≥Ê≥®',
                        text: 'ÊúÄËøëÂøÉÊÉÖ‰ºº‰πé‰∏çÂ§™Áæé‰∏ΩÔºåËÆ∞ÂæóÁªôËá™Â∑±Êîæ‰∏™ÂÅáÔºå‰øùÊåÅÂ•ΩÂøÉÊÉÖ‰πüÂæàÈáçË¶ÅÂì¶ÔºÅ'
                    });
                }
            }

            return tips.length > 0 ? tips : [{
                icon: 'üí°',
                title: '‰øùÊåÅËÆ∞ÂΩï',
                text: 'ÊåÅÁª≠ËÆ∞ÂΩï‰ΩìÈáçÊòØÂÅ•Â∫∑ÁÆ°ÁêÜÁöÑÁ¨¨‰∏ÄÊ≠•ÔºåÁªßÁª≠Âä†Ê≤πÔºÅ'
            }];
        }

        // Smart Insights
        function updateSmartInsights() {
            const section = document.getElementById('smartInsights');
            const cardsContainer = document.getElementById('insightCards');

            if (weightData.length < 5) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            const insights = generateSmartInsights();
            cardsContainer.innerHTML = insights.map(insight => `
                <div class="insight-card" onclick="showInsightDetail('${insight.type}')">
                    <div class="insight-card-icon">${insight.icon}</div>
                    <div class="insight-card-title">${insight.title}</div>
                    <div class="insight-card-value">${insight.value}</div>
                    <div class="insight-card-trend ${insight.trendClass}">
                        ${insight.trendIcon} ${insight.trendText}
                    </div>
                </div>
            `).join('');
        }

        function generateSmartInsights() {
            const insights = [];
            const current = weightData[weightData.length - 1].weight;
            const previous = weightData[Math.max(0, weightData.length - 8)]?.weight || current;
            const first = weightData[0].weight;
            const trend7 = calculateTrend(7);

            // Weekly trend
            const weeklyChange = current - previous;
            insights.push({
                type: 'weekly',
                icon: 'üìä',
                title: 'Âë®Ë∂ãÂäø',
                value: (weeklyChange >= 0 ? '+' : '') + weeklyChange.toFixed(1) + ' kg',
                trendIcon: weeklyChange < 0 ? 'üìâ' : weeklyChange > 0 ? 'üìà' : '‚û°Ô∏è',
                trendText: weeklyChange < 0 ? '‰∏ãÈôç' : weeklyChange > 0 ? '‰∏äÂçá' : 'Á®≥ÂÆö',
                trendClass: weeklyChange < 0 ? 'trend-up' : weeklyChange > 0 ? 'trend-down' : 'trend-stable'
            });

            // Total progress
            const totalProgress = first - current;
            insights.push({
                type: 'total',
                icon: 'üéØ',
                title: 'ÊÄªËøõÂ∫¶',
                value: (totalProgress >= 0 ? '' : '+') + totalProgress.toFixed(1) + ' kg',
                trendIcon: totalProgress > 0 ? '‚úÖ' : totalProgress < 0 ? '‚ö†Ô∏è' : '‚û°Ô∏è',
                trendText: totalProgress > 0 ? 'ËøõÊ≠•‰∏≠' : totalProgress < 0 ? 'ÈúÄÊ≥®ÊÑè' : '‰øùÊåÅ',
                trendClass: totalProgress >= 0 ? 'trend-up' : 'trend-down'
            });

            // Average weight
            const avgWeight = weightData.reduce((sum, d) => sum + d.weight, 0) / weightData.length;
            insights.push({
                type: 'average',
                icon: 'üìà',
                title: 'Âπ≥Âùá‰ΩìÈáç',
                value: avgWeight.toFixed(1) + ' kg',
                trendIcon: current < avgWeight ? 'üëá' : current > avgWeight ? 'üëÜ' : '‚û°Ô∏è',
                trendText: current < avgWeight ? '‰Ωé‰∫éÂπ≥Âùá' : current > avgWeight ? 'È´ò‰∫éÂπ≥Âùá' : 'Êé•ËøëÂπ≥Âùá',
                trendClass: current <= avgWeight ? 'trend-up' : 'trend-stable'
            });

            // Consistency score
            const consistency = calculateConsistency();
            insights.push({
                type: 'consistency',
                icon: 'üî•',
                title: 'ËÆ∞ÂΩïÁ®≥ÂÆöÂ∫¶',
                value: consistency + '%',
                trendIcon: consistency >= 80 ? 'üåü' : consistency >= 50 ? 'üëç' : 'üí™',
                trendText: consistency >= 80 ? '‰ºòÁßÄ' : consistency >= 50 ? 'ËâØÂ•Ω' : 'ÁªßÁª≠Âä™Âäõ',
                trendClass: consistency >= 50 ? 'trend-up' : 'trend-stable'
            });

            return insights;
        }

        function calculateConsistency() {
            if (weightData.length < 2) return 0;

            const now = new Date();
            const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);

            const recentEntries = weightData.filter(d => new Date(d.date) >= thirtyDaysAgo);
            const idealEntries = 30; // One per day for 30 days

            return Math.min(100, Math.round((recentEntries.length / idealEntries) * 100));
        }

        // Predictions
        function updatePredictions() {
            const section = document.getElementById('predictionSection');
            const cardsContainer = document.getElementById('predictionCards');

            if (weightData.length < 5 || !settings.goalWeight) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            const current = weightData[weightData.length - 1].weight;
            const trend7 = calculateTrend(7);
            const goalDiff = current - settings.goalWeight;

            const predictions = [];

            // Days to goal (based on 7-day trend)
            if (trend7 < 0 && goalDiff > 0) {
                const daysToGoal = Math.ceil(goalDiff / Math.abs(trend7));
                const weeksToGoal = Math.ceil(daysToGoal / 7);
                predictions.push({
                    emoji: 'üìÖ',
                    label: 'È¢ÑËÆ°ËææÊàêÊó∂Èó¥',
                    value: weeksToGoal <= 4 ? `${weeksToGoal} Âë®` : `${Math.ceil(daysToGoal / 30)} ‰∏™Êúà`,
                    color: weeksToGoal <= 4 ? '#27ae60' : '#f1c40f'
                });
            }

            // Weight at goal pace
            if (trend7 !== 0) {
                const oneWeekPrediction = current + (trend7 * 1);
                const oneMonthPrediction = current + (trend7 * 4);

                predictions.push({
                    emoji: 'üîÆ',
                    label: '‰∏ÄÂë®ÂêéÈ¢ÑÊµã',
                    value: oneWeekPrediction.toFixed(1) + ' kg',
                    color: oneWeekPrediction < current ? '#27ae60' : '#e74c3c'
                });

                predictions.push({
                    emoji: 'üéØ',
                    label: '‰∏ÄÊúàÂêéÈ¢ÑÊµã',
                    value: oneMonthPrediction.toFixed(1) + ' kg',
                    color: oneMonthPrediction < current ? '#27ae60' : '#e74c3c'
                });
            }

            // Motivation level
            const motivationLevel = getMotivationLevel();
            predictions.push({
                emoji: motivationLevel.emoji,
                label: 'ÂΩìÂâçÁä∂ÊÄÅ',
                value: motivationLevel.text,
                color: motivationLevel.color
            });

            cardsContainer.innerHTML = predictions.map(pred => `
                <div class="prediction-card">
                    <div class="prediction-card-emoji">${pred.emoji}</div>
                    <div class="prediction-card-label">${pred.label}</div>
                    <div class="prediction-card-value" style="color: ${pred.color}">${pred.value}</div>
                </div>
            `).join('');
        }

        function getMotivationLevel() {
            const current = weightData[weightData.length - 1].weight;
            const first = weightData[0].weight;
            const progress = first - current;
            const streak = calculateStreak();

            if (progress > 0 && streak >= 7) {
                return { emoji: 'üî•', text: 'Áä∂ÊÄÅÁÅ´ÁÉ≠', color: '#e74c3c' };
            } else if (progress > 0) {
                return { emoji: 'üí™', text: 'ÊåÅÁª≠ËøõÊ≠•', color: '#27ae60' };
            } else if (streak >= 7) {
                return { emoji: 'üëè', text: 'ÂùöÊåÅ‰∏çÊáà', color: '#3498db' };
            } else {
                return { emoji: 'üå±', text: 'Êñ∞ÁöÑÂºÄÂßã', color: '#95a5a6' };
            }
        }

        // Weekly Report
        function updateWeeklyReport() {
            const section = document.getElementById('weeklyReport');
            const gridContainer = document.getElementById('reportGrid');
            const periodLabel = document.getElementById('reportPeriod');

            if (weightData.length < 2) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            // Calculate week range
            const now = new Date();
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            weekStart.setHours(0, 0, 0, 0);

            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);

            periodLabel.textContent = `${formatDate(weekStart.toISOString().split('T')[0])} - ${formatDate(weekEnd.toISOString().split('T')[0])}`;

            // Get this week's data
            const thisWeekData = weightData.filter(d => {
                const date = new Date(d.date);
                return date >= weekStart && date <= weekEnd;
            });

            // Get last week's data for comparison
            const lastWeekStart = new Date(weekStart);
            lastWeekStart.setDate(weekStart.getDate() - 7);
            const lastWeekEnd = new Date(weekStart);
            lastWeekEnd.setDate(weekStart.getDate() - 1);

            const lastWeekData = weightData.filter(d => {
                const date = new Date(d.date);
                return date >= lastWeekStart && date <= lastWeekEnd;
            });

            const reportItems = [];

            // Weight change
            if (thisWeekData.length >= 2) {
                const weekStartWeight = thisWeekData[0].weight;
                const weekEndWeight = thisWeekData[thisWeekData.length - 1].weight;
                const weekChange = weekEndWeight - weekStartWeight;

                reportItems.push({
                    icon: '‚öñÔ∏è',
                    label: 'Âë®ÂèòÂåñ',
                    value: (weekChange >= 0 ? '+' : '') + weekChange.toFixed(1) + ' kg'
                });
            }

            // Records this week
            reportItems.push({
                icon: 'üìù',
                label: 'ËÆ∞ÂΩïÊ¨°Êï∞',
                value: thisWeekData.length + ' Ê¨°'
            });

            // Average weight this week
            if (thisWeekData.length > 0) {
                const avgWeight = thisWeekData.reduce((sum, d) => sum + d.weight, 0) / thisWeekData.length;
                reportItems.push({
                    icon: 'üìä',
                    label: 'Âë®Âπ≥Âùá',
                    value: avgWeight.toFixed(1) + ' kg'
                });
            }

            // Water intake
            const waterGoal = waterData.glasses >= 8;
            reportItems.push({
                icon: waterGoal ? 'üíß' : 'üö∞',
                label: '‰ªäÊó•È•ÆÊ∞¥',
                value: waterData.glasses + '/8 ÊùØ'
            });

            // Exercise calories
            const today = new Date().toDateString();
            const todayExercises = exerciseLog.filter(e => new Date(e.date).toDateString() === today);
            const todayCalories = todayExercises.reduce((sum, e) => sum + e.calories, 0);
            reportItems.push({
                icon: 'üî•',
                label: '‰ªäÊó•Ê∂àËÄó',
                value: todayCalories + ' ÂçÉÂç°'
            });

            gridContainer.innerHTML = reportItems.map(item => `
                <div class="report-item">
                    <span class="report-item-icon">${item.icon}</span>
                    <div class="report-item-content">
                        <div class="report-item-label">${item.label}</div>
                        <div class="report-item-value">${item.value}</div>
                    </div>
                </div>
            `).join('');
        }

        // Celebration Card
        function showCelebrationCard(emoji, title, message, stats = []) {
            document.getElementById('milestoneEmoji').textContent = emoji;
            document.getElementById('milestoneTitle').textContent = title;
            document.getElementById('milestoneMessage').textContent = message;

            const statsContainer = document.getElementById('milestoneStats');
            if (stats.length > 0) {
                statsContainer.innerHTML = stats.map(stat => `
                    <div class="milestone-stat">
                        <div class="milestone-stat-value">${stat.value}</div>
                        <div class="milestone-stat-label">${stat.label}</div>
                    </div>
                `).join('');
                statsContainer.style.display = 'flex';
            } else {
                statsContainer.style.display = 'none';
            }

            document.getElementById('celebrationOverlay').classList.add('active');
            launchConfetti(50);
        }

        function closeMilestoneCard() {
            document.getElementById('celebrationOverlay').classList.remove('active');
        }

        // Close celebration on overlay click
        document.getElementById('celebrationOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMilestoneCard();
            }
        });

        // Profile System Functions
        function updateProfileCard() {
            // Update avatar and name
            document.getElementById('avatarEmoji').textContent = userProfile.avatar;
            document.getElementById('profileName').textContent = userProfile.name;

            // Calculate level and title
            const currentLevel = levels.find(l => l.level === userProfile.level) || levels[0];
            const nextLevel = levels.find(l => l.level === userProfile.level + 1);
            document.getElementById('avatarLevel').textContent = userProfile.level;
            document.getElementById('profileTitle').textContent = currentLevel.title;

            // Update XP progress
            document.getElementById('profileXP').textContent = userProfile.xp;
            if (nextLevel) {
                document.getElementById('profileXPNext').textContent = nextLevel.xp;
                const progress = ((userProfile.xp - currentLevel.xp) / (nextLevel.xp - currentLevel.xp)) * 100;
                document.getElementById('profileProgressFill').style.width = Math.min(100, Math.max(0, progress)) + '%';
            } else {
                document.getElementById('profileXPNext').textContent = 'MAX';
                document.getElementById('profileProgressFill').style.width = '100%';
            }

            // Update stats
            document.getElementById('profileStreak').textContent = calculateStreak();
            document.getElementById('profileRecords').textContent = weightData.length;
            document.getElementById('profileAchievements').textContent = unlockedAchievements.length;

            // Weight change
            if (weightData.length >= 2) {
                const first = weightData[0].weight;
                const current = weightData[weightData.length - 1].weight;
                const change = current - first;
                document.getElementById('profileWeightChange').textContent = (change >= 0 ? '+' : '') + change.toFixed(1);
            }
        }

        function addXP(amount, reason = '') {
            userProfile.xp += amount;

            // Check for level up
            const nextLevel = levels.find(l => l.level === userProfile.level + 1);
            if (nextLevel && userProfile.xp >= nextLevel.xp) {
                userProfile.level = nextLevel.level;
                launchConfetti(40);
                showCelebrationCard(
                    'üéâ',
                    'ÂçáÁ∫ßÂï¶ÔºÅ',
                    `ÊÅ≠ÂñúËææÂà∞ ${nextLevel.level} Á∫ßÔºö${nextLevel.title}`,
                    [
                        { value: nextLevel.level, label: 'ÂΩìÂâçÁ≠âÁ∫ß' },
                        { value: userProfile.xp, label: 'ÊÄªÁªèÈ™åÂÄº' }
                    ]
                );
            }

            localStorage.setItem(PROFILE_KEY, JSON.stringify(userProfile));
            updateProfileCard();
        }

        function openAvatarModal() {
            const avatarIndex = avatars.indexOf(userProfile.avatar);
            const nextIndex = (avatarIndex + 1) % avatars.length;
            userProfile.avatar = avatars[nextIndex];
            localStorage.setItem(PROFILE_KEY, JSON.stringify(userProfile));
            updateProfileCard();
            launchConfetti(10);
        }

        function openProfileSettings() {
            const newName = prompt('ËæìÂÖ•‰Ω†ÁöÑÊòµÁß∞Ôºö', userProfile.name);
            if (newName && newName.trim()) {
                userProfile.name = newName.trim();
                localStorage.setItem(PROFILE_KEY, JSON.stringify(userProfile));
                updateProfileCard();
            }
        }

        // Daily Challenges Functions
        function updateDailyChallenges() {
            const section = document.getElementById('challengesSection');
            const grid = document.getElementById('challengesGrid');
            const dateLabel = document.getElementById('challengesDate');

            // Check if challenges need to be reset
            const today = new Date().toDateString();
            if (dailyChallenges.date !== today) {
                dailyChallenges = {
                    date: today,
                    completed: []
                };
                localStorage.setItem(CHALLENGES_KEY, JSON.stringify(dailyChallenges));
            }

            // Update date label
            const now = new Date();
            const options = { month: 'short', day: 'numeric', weekday: 'short' };
            dateLabel.textContent = now.toLocaleDateString('zh-CN', options);

            // Generate challenge items
            const challenges = challengeDefinitions.filter(ch => {
                // Only show challenges that are either not completed or can be attempted today
                return true;
            });

            grid.innerHTML = challenges.map(challenge => {
                const isCompleted = dailyChallenges.completed.includes(challenge.id);
                const canComplete = challenge.check();

                return `
                    <div class="challenge-item ${isCompleted ? 'completed' : ''}" onclick="tryCompleteChallenge('${challenge.id}')">
                        ${isCompleted ? '<span class="challenge-check">‚úì</span>' : ''}
                        <span class="challenge-icon">${challenge.icon}</span>
                        <div class="challenge-title">${challenge.title}</div>
                        <div class="challenge-reward">+${challenge.reward} XP</div>
                    </div>
                `;
            }).join('');

            section.style.display = 'block';
        }

        function tryCompleteChallenge(challengeId) {
            if (dailyChallenges.completed.includes(challengeId)) return;

            const challenge = challengeDefinitions.find(c => c.id === challengeId);
            if (!challenge) return;

            if (challenge.check()) {
                dailyChallenges.completed.push(challengeId);
                localStorage.setItem(CHALLENGES_KEY, JSON.stringify(dailyChallenges));
                addXP(challenge.reward, `ÂÆåÊàêÊåëÊàòÔºö${challenge.title}`);
                updateDailyChallenges();
                launchConfetti(20);
            } else {
                alert(`üí™ ËøòÊ≤°ÂÆåÊàêÂì¶Ôºö${challenge.title}\nÁªßÁª≠Âä†Ê≤πÔºÅ`);
            }
        }

        document.getElementById('weightForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> ËÆ∞ÂΩï‰∏≠...';

            setTimeout(() => {
                const date = document.getElementById('date').value;
                const weight = parseFloat(document.getElementById('weight').value);
                const note = document.getElementById('note').value.trim();
                const mood = document.getElementById('mood').value || null;

                const existingIndex = weightData.findIndex(item => item.date === date);
                const isNewEntry = existingIndex === -1;
                if (existingIndex !== -1) {
                    weightData[existingIndex].weight = weight;
                    weightData[existingIndex].note = note;
                    weightData[existingIndex].mood = mood;
                } else {
                    weightData.push({ date, weight, note, mood });
                    // Award XP for new entry
                    addXP(10, 'ËÆ∞ÂΩï‰ΩìÈáç');
                }

                weightData.sort((a, b) => new Date(a.date) - new Date(b.date));

                saveData();
                updateUI();
                checkGoalAchievement(weight);
                checkWeightLossMilestones(weight);

                document.getElementById('weight').value = '';
                document.getElementById('note').value = '';
                resetMoodSelector();
                document.getElementById('motivation').textContent = motivations[Math.floor(Math.random() * motivations.length)];

                btn.disabled = false;
                btn.innerHTML = 'ËÆ∞ÂΩï‰ΩìÈáç ‚úèÔ∏è';

                // Add shake animation to card
                document.querySelector('.card').classList.add('shake');
                setTimeout(() => document.querySelector('.card').classList.remove('shake'), 500);
            }, 300);
        });

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(weightData));
        }

        function saveSettingsData() {
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
        }

        // Export/Import Functions
        function exportToCSV() {
            if (weightData.length === 0) {
                alert('ÊöÇÊó†Êï∞ÊçÆÂèØÂØºÂá∫');
                return;
            }

            // Create CSV header
            let csv = 'Êó•Êúü,‰ΩìÈáç,Â§áÊ≥®,ÂøÉÊÉÖ\n';

            // Add data rows
            weightData.forEach(item => {
                const date = item.date;
                const weight = item.weight.toFixed(1);
                const note = item.note ? `"${item.note.replace(/"/g, '""')}"` : '';
                const mood = item.mood || '';
                csv += `${date},${weight},${note},${mood}\n`;
            });

            // Create download link
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `‰ΩìÈáçËÆ∞ÂΩï_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            URL.revokeObjectURL(link.href);

            // Award XP
            addXP(5, 'ÂØºÂá∫Êï∞ÊçÆ');
            launchConfetti(15);
        }

        function exportToJSON() {
            const data = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                data: {
                    weightData,
                    settings,
                    measurements,
                    progressPhotos,
                    unlockedAchievements,
                    userProfile,
                    exerciseLog,
                    sleepLog
                }
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `‰ΩìÈáçÂ∞èÊú¨Êú¨Â§á‰ªΩ_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(link.href);

            // Award XP
            addXP(10, 'ÂØºÂá∫Â§á‰ªΩ');
            launchConfetti(15);
        }

        function triggerImport() {
            document.getElementById('importFile').click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const ext = file.name.split('.').pop().toLowerCase();

                    if (ext === 'csv') {
                        importCSV(content);
                    } else if (ext === 'json') {
                        importJSON(content);
                    }
                } catch (error) {
                    alert('ÂØºÂÖ•Â§±Ë¥•Ôºö' + error.message);
                }
                // Reset file input
                event.target.value = '';
            };

            reader.readAsText(file);
        }

        function importCSV(content) {
            const lines = content.split('\n');
            const headers = lines[0].split(',');

            // Validate headers
            if (!headers.includes('Êó•Êúü') || !headers.includes('‰ΩìÈáç')) {
                alert('CSVÊ†ºÂºè‰∏çÊ≠£Á°ÆÔºåÂøÖÈ°ªÂåÖÂê´"Êó•Êúü"Âíå"‰ΩìÈáç"Âàó');
                return;
            }

            let importedCount = 0;

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Parse CSV line (handle quoted fields)
                const matches = line.match(/(".*?"|[^,]+)/g);
                if (!matches) continue;

                const date = matches[headers.indexOf('Êó•Êúü')].replace(/"/g, '').trim();
                const weight = parseFloat(matches[headers.indexOf('‰ΩìÈáç')].replace(/"/g, '').trim());
                const note = headers.includes('Â§áÊ≥®') ? matches[headers.indexOf('Â§áÊ≥®')].replace(/^"|"$/g, '').replace(/""/g, '"') : '';
                const mood = headers.includes('ÂøÉÊÉÖ') ? matches[headers.indexOf('ÂøÉÊÉÖ')].replace(/"/g, '').trim() : '';

                if (!date || isNaN(weight)) continue;

                // Check if entry already exists
                const existingIndex = weightData.findIndex(item => item.date === date);
                if (existingIndex !== -1) {
                    weightData[existingIndex] = { date, weight, note, mood: mood || null };
                } else {
                    weightData.push({ date, weight, note, mood: mood || null });
                }

                importedCount++;
            }

            weightData.sort((a, b) => new Date(a.date) - new Date(b.date));
            saveData();
            updateUI();

            alert(`‚úÖ ÊàêÂäüÂØºÂÖ• ${importedCount} Êù°ËÆ∞ÂΩïÔºÅ`);
            launchConfetti(30);
            addXP(20, 'ÂØºÂÖ•Êï∞ÊçÆ');
        }

        function importJSON(content) {
            const data = JSON.parse(content);

            // Validate version
            if (data.version !== '1.0') {
                alert('Â§á‰ªΩÊñá‰ª∂ÁâàÊú¨‰∏çÂÖºÂÆπ');
                return;
            }

            // Import data
            if (data.data.weightData) {
                weightData = data.data.weightData;
                saveData();
            }
            if (data.data.settings) {
                settings = data.data.settings;
                saveSettingsData();
            }
            if (data.data.measurements) {
                measurements = data.data.measurements;
                localStorage.setItem(MEASUREMENTS_KEY, JSON.stringify(measurements));
            }
            if (data.data.progressPhotos) {
                progressPhotos = data.data.progressPhotos;
                localStorage.setItem(PHOTOS_KEY, JSON.stringify(progressPhotos));
            }
            if (data.data.unlockedAchievements) {
                unlockedAchievements = data.data.unlockedAchievements;
                localStorage.setItem(UNLOCKED_KEY, JSON.stringify(unlockedAchievements));
            }
            if (data.data.userProfile) {
                userProfile = data.data.userProfile;
                localStorage.setItem(PROFILE_KEY, JSON.stringify(userProfile));
            }
            if (data.data.exerciseLog) {
                exerciseLog = data.data.exerciseLog;
                localStorage.setItem(EXERCISE_KEY, JSON.stringify(exerciseLog));
            }
            if (data.data.sleepLog) {
                sleepLog = data.data.sleepLog;
                localStorage.setItem(SLEEP_KEY, JSON.stringify(sleepLog));
            }

            updateUI();

            alert('‚úÖ ÊàêÂäüÊÅ¢Â§çÊâÄÊúâÊï∞ÊçÆÔºÅ');
            launchConfetti(50);
            addXP(30, 'ÊÅ¢Â§çÊï∞ÊçÆ');
        }

        function checkGoalAchievement(currentWeight) {
            if (!settings.goalWeight) return;

            const goalDiff = currentWeight - settings.goalWeight;
            if (goalDiff <= 0 && !goalAchieved) {
                goalAchieved = true;
                launchConfetti(100);
                setTimeout(() => launchConfetti(50), 300);
                document.getElementById('motivation').textContent = 'üéâ ÊÅ≠Âñú‰Ω†ËææÊàêÁõÆÊ†áÔºÅÂ§™Ê£í‰∫ÜÔºÅ';

                // Add celebration card
                showCelebrationCard('üéØ', 'ÁõÆÊ†áËææÊàêÔºÅ', `‰Ω†ÊàêÂäüËææÂà∞‰∫Ü ${settings.goalWeight}kg ÁöÑÁõÆÊ†á‰ΩìÈáçÔºÅ`);
            } else if (goalDiff > 0) {
                goalAchieved = false;
            }
        }

        // Check for weight loss milestones (every kg)
        function checkWeightLossMilestones(currentWeight) {
            if (weightData.length < 2) return;

            const firstWeight = weightData[0].weight;
            const totalLost = firstWeight - currentWeight;
            const milestoneKey = 'weightLossMilestones';

            let milestones = JSON.parse(localStorage.getItem(milestoneKey)) || [];

            for (let kg = 1; kg <= totalLost; kg++) {
                const milestoneKey = `lost_${kg}kg`;
                if (!milestones.includes(milestoneKey)) {
                    milestones.push(milestoneKey);
                    localStorage.setItem(milestoneKey, JSON.stringify(milestones));

                    // Celebrate milestone
                    launchConfetti(40);
                    const messages = [
                        `üéâ Â§™Ê£í‰∫ÜÔºÅ‰Ω†Â∑≤ÁªèÂáèÊéâ‰∫Ü ${kg} ÂÖ¨Êñ§ÔºÅ`,
                        `üí™ ÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºÅÂáèÊéâ ${kg} ÂÖ¨Êñ§ËææÊàêÔºÅ`,
                        `‚≠ê ÈáåÁ®ãÁ¢ëÁ™ÅÁ†¥ÔºÅÊàêÂäüÂáèÈáç ${kg} ÂÖ¨Êñ§ÔºÅ`
                    ];
                    document.getElementById('motivation').textContent = messages[Math.floor(Math.random() * messages.length)];

                    showCelebrationCard('‚≠ê', `${kg}ÂÖ¨Êñ§ÈáåÁ®ãÁ¢ë`, `‰Ω†Â∑≤ÁªèÁ¥ØËÆ°ÂáèÊéâ‰∫Ü ${kg} ÂÖ¨Êñ§ÔºÅÁªßÁª≠‰øùÊåÅÔºÅ`);
                }
            }
        }

        function showCelebrationCard(emoji, title, message) {
            // Create celebration overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.5); z-index: 1000;
                display: flex; align-items: center; justify-content: center;
                animation: fadeIn 0.3s ease;
            `;

            const card = document.createElement('div');
            card.style.cssText = `
                background: linear-gradient(135deg, var(--mint) 0%, var(--sky) 100%);
                padding: 30px; border-radius: 20px;
                border: 3px solid var(--ink);
                text-align: center;
                animation: popIn 0.5s ease;
                max-width: 90%; width: 350px;
            `;

            card.innerHTML = `
                <div style="font-size: 3rem;">${emoji}</div>
                <h2 style="font-family: 'Caveat', cursive; font-size: 2rem; margin: 10px 0;">${title}</h2>
                <p style="font-size: 1rem; color: #555;">${message}</p>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                    <button onclick="openShareModal('${emoji}', '${title}', '${message}')"
                        style="padding: 10px 20px;
                        background: var(--sky); border: 2px solid var(--ink);
                        border-radius: 10px; cursor: pointer;
                        font-family: 'Patrick Hand', cursive; font-size: 1rem;">
                        üì§ ÂàÜ‰∫´
                    </button>
                    <button onclick="this.parentElement.parentElement.parentElement.remove()"
                        style="padding: 10px 20px;
                        background: var(--yellow); border: 2px solid var(--ink);
                        border-radius: 10px; cursor: pointer;
                        font-family: 'Patrick Hand', cursive; font-size: 1rem;">
                        Â§™Ê£í‰∫ÜÔºÅ
                    </button>
                </div>
            `;

            overlay.appendChild(card);
            document.body.appendChild(overlay);

            // Auto dismiss after 8 seconds
            setTimeout(() => overlay.remove(), 8000);
        }

        // Update Milestone Tracker
        function updateMilestoneTracker() {
            const section = document.getElementById('milestoneTracker');
            const grid = document.getElementById('milestoneGrid');
            const totalLostDisplay = document.getElementById('totalLostDisplay');
            const progressFill = document.getElementById('milestoneProgressFill');

            if (weightData.length < 2) {
                section.style.display = 'none';
                return;
            }

            const firstWeight = weightData[0].weight;
            const currentWeight = weightData[weightData.length - 1].weight;
            const totalLost = firstWeight - currentWeight;

            if (totalLost <= 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            // Get achieved milestones
            const milestoneKey = 'weightLossMilestones';
            let milestones = JSON.parse(localStorage.getItem(milestoneKey)) || [];

            // Display up to 20 kg milestones
            const maxMilestone = Math.max(20, Math.ceil(totalLost) + 5);
            const milestoneData = [];

            for (let kg = 1; kg <= maxMilestone; kg++) {
                const isAchieved = kg <= totalLost || milestones.includes(`lost_${kg}kg`);
                milestoneData.push({
                    kg: kg,
                    achieved: isAchieved,
                    icon: getMilestoneIcon(kg)
                });
            }

            // Update display
            totalLostDisplay.textContent = `${totalLost.toFixed(1)} kg`;

            // Calculate progress toward next milestone
            const nextMilestone = Math.ceil(totalLost) + 1;
            const progress = ((totalLost % 1) * 100).toFixed(0);
            progressFill.style.width = `${progress}%`;
            progressFill.textContent = `${progress}%`;

            // Render milestone grid
            grid.innerHTML = milestoneData.map(m => `
                <div class="milestone-item ${m.achieved ? 'achieved' : 'locked'}">
                    <div class="milestone-icon">${m.icon}</div>
                    <div class="milestone-label">${m.kg}kg</div>
                </div>
            `).join('');
        }

        function getMilestoneIcon(kg) {
            const icons = {
                1: 'üåü',
                2: '‚≠ê',
                3: 'üí´',
                5: 'üèÖ',
                10: 'üèÜ',
                15: 'üëë',
                20: 'üíé'
            };
            return icons[kg] || 'üéØ';
        }

        function deleteEntry(index) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) {
                weightData.splice(index, 1);
                saveData();
                updateUI();
            }
        }

        function editEntry(index) {
            const item = weightData[index];
            document.getElementById('editIndex').value = index;
            document.getElementById('editDate').value = item.date;
            document.getElementById('editWeight').value = item.weight;
            document.getElementById('editNote').value = item.note || '';
            document.getElementById('editMood').value = item.mood || '';

            // Set mood selection in edit modal
            const editMoodOptions = document.querySelectorAll('#editMoodSelector .mood-option');
            editMoodOptions.forEach(o => o.classList.remove('selected'));
            if (item.mood) {
                editMoodOptions.forEach(o => {
                    if (o.dataset.mood === item.mood) {
                        o.classList.add('selected');
                    }
                });
            }

            document.getElementById('editModal').classList.add('active');
        }

        function saveEdit() {
            const index = parseInt(document.getElementById('editIndex').value);
            const date = document.getElementById('editDate').value;
            const weight = parseFloat(document.getElementById('editWeight').value);
            const note = document.getElementById('editNote').value.trim();
            const mood = document.getElementById('editMood').value || null;

            if (date && weight) {
                weightData[index] = { date, weight, note, mood };
                weightData.sort((a, b) => new Date(a.date) - new Date(b.date));
                saveData();
                updateUI();
                closeEditModal();
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return `${date.getMonth() + 1}Êúà${date.getDate()}Êó•`;
        }

        function calculateStreak() {
            if (weightData.length < 2) return 0;

            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const todayStr = today.toISOString().split('T')[0];
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];

            const hasToday = weightData.some(item => item.date === todayStr);
            const hasYesterday = weightData.some(item => item.date === yesterdayStr);

            if (!hasToday && !hasYesterday) return 0;

            let checkDate = hasToday ? today : yesterday;
            streak = hasToday ? 1 : 0;

            while (true) {
                checkDate.setDate(checkDate.getDate() - 1);
                const dateStr = checkDate.toISOString().split('T')[0];
                if (weightData.some(item => item.date === dateStr)) {
                    streak++;
                } else {
                    break;
                }
            }

            return streak;
        }

        function calculateTrend(days) {
            if (weightData.length < 2) return null;

            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - days);

            const recentData = weightData.filter(item => new Date(item.date) >= cutoffDate);

            if (recentData.length < 2) return null;

            return recentData[recentData.length - 1].weight - recentData[0].weight;
        }

        function calculateWeeklyAverage() {
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

            const weekData = weightData.filter(item => new Date(item.date) >= oneWeekAgo);
            if (weekData.length === 0) return null;

            return weekData.reduce((sum, item) => sum + item.weight, 0) / weekData.length;
        }

        function calculateMonthlyAverage() {
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);

            const monthData = weightData.filter(item => new Date(item.date) >= oneMonthAgo);
            if (monthData.length === 0) return null;

            return monthData.reduce((sum, item) => sum + item.weight, 0) / monthData.length;
        }

        function predictWeight() {
            if (weightData.length < 7) return null;

            const recentData = weightData.slice(-7);
            const changes = [];
            for (let i = 1; i < recentData.length; i++) {
                changes.push(recentData[i].weight - recentData[i-1].weight);
            }

            const avgChange = changes.reduce((sum, c) => sum + c, 0) / changes.length;
            const currentWeight = weightData[weightData.length - 1].weight;

            // Predict weight in 7 days
            return currentWeight + (avgChange * 7);
        }

        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            document.getElementById('height').value = settings.height || '';
            document.getElementById('goalWeight').value = settings.goalWeight || '';
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function saveSettings() {
            settings.height = parseFloat(document.getElementById('height').value) || null;
            settings.goalWeight = parseFloat(document.getElementById('goalWeight').value) || null;
            goalAchieved = false; // Reset goal achievement status when goal changes
            saveSettingsData();
            closeSettings();
            updateUI();
        }

        function calculateBMI(weight, heightCm) {
            if (!weight || !heightCm) return null;
            const heightM = heightCm / 100;
            return weight / (heightM * heightM);
        }

        function getBMIStatus(bmi) {
            if (bmi < 18.5) return { text: 'ÂÅèÁò¶', color: '#3498db' };
            if (bmi < 24) return { text: 'Ê≠£Â∏∏', color: '#27ae60' };
            if (bmi < 28) return { text: 'ÂÅèËÉñ', color: '#f1c40f' };
            return { text: 'ËÇ•ËÉñ', color: '#e74c3c' };
        }

        function updateUI() {
            updateStats();
            updateStreak();
            updateList();
            updateChart();
            updateCalendarHeatmap();
            updateHealthInsights();
            updateMeasurements();
            updateAchievements();
            updateMoodChart();
            checkAndUnlockAchievements();
            updateWaterTracker();
            updateExerciseList();
            updateSleepTracker();
            updateHealthCalculators();
            updateDashboard();
            updateWidgetBar();
            updateTimeline();
            updateSmartInsights();
            updatePredictions();
            updateWeeklyReport();
            updateProfileCard();
            updateDailyChallenges();
            updateQuickStats();
            updatePeriodComparison();
            updateStatsDashboard();
            updateMilestoneTracker();
            updatePhotoGallery();
            updateBMIChart();
            updateWeightBadges();
            updateStabilityIndicator();
            updateFooter();
        }

        function updateFooter() {
            document.getElementById('recordCount').textContent = weightData.length;
        }

        // Dashboard Functions
        let dashboardExpanded = false;

        function toggleDashboardView() {
            dashboardExpanded = !dashboardExpanded;
            const grid = document.getElementById('dashboardGrid');
            const toggle = document.getElementById('dashboardToggle');

            if (dashboardExpanded) {
                grid.style.display = 'grid';
                toggle.textContent = 'Êî∂Ëµ∑';
            } else {
                grid.style.display = 'none';
                toggle.textContent = 'Â±ïÂºÄ';
            }
        }

        function updateDashboard() {
            // Weight
            if (weightData.length > 0) {
                const current = weightData[weightData.length - 1].weight;
                document.getElementById('dashWeight').textContent = current.toFixed(1);

                // Change from previous
                if (weightData.length > 1) {
                    const prev = weightData[weightData.length - 2].weight;
                    const change = current - prev;
                    const changeEl = document.getElementById('dashChange');
                    if (change > 0) {
                        changeEl.textContent = '+' + change.toFixed(1);
                        changeEl.style.color = '#e74c3c';
                    } else if (change < 0) {
                        changeEl.textContent = change.toFixed(1);
                        changeEl.style.color = '#27ae60';
                    } else {
                        changeEl.textContent = '0';
                        changeEl.style.color = '#7f8c8d';
                    }
                }
            }

            // Water
            document.getElementById('dashWater').textContent = waterData.glasses + '/8';

            // Streak
            document.getElementById('dashStreak').textContent = calculateStreak();

            // Calories burned today
            const today = new Date().toDateString();
            const todayExercises = exerciseLog.filter(e => new Date(e.date).toDateString() === today);
            const totalCalories = todayExercises.reduce((sum, e) => sum + e.calories, 0);
            document.getElementById('dashCalories').textContent = totalCalories;

            // Sleep
            if (sleepLog.length > 0) {
                const lastSleep = sleepLog[sleepLog.length - 1];
                document.getElementById('dashSleep').textContent = lastSleep.hours.toFixed(1);
            }
        }

        function updateWidgetBar() {
            // Weight
            if (weightData.length > 0) {
                const current = weightData[weightData.length - 1].weight;
                document.getElementById('widgetWeight').textContent = current.toFixed(1);

                // Change from previous
                if (weightData.length > 1) {
                    const prev = weightData[weightData.length - 2].weight;
                    const change = current - prev;
                    const changeEl = document.getElementById('widgetChange');
                    if (change > 0) {
                        changeEl.textContent = '+' + change.toFixed(1);
                        changeEl.style.color = '#e74c3c';
                    } else if (change < 0) {
                        changeEl.textContent = change.toFixed(1);
                        changeEl.style.color = '#27ae60';
                    } else {
                        changeEl.textContent = '0';
                        changeEl.style.color = '#7f8c8d';
                    }
                }
            }

            // Water
            document.getElementById('widgetWaterBar').textContent = waterData.glasses + '/8';

            // Streak
            document.getElementById('widgetStreakBar').textContent = calculateStreak();

            // Calories burned today
            const today = new Date().toDateString();
            const todayExercises = exerciseLog.filter(e => new Date(e.date).toDateString() === today);
            const totalCalories = todayExercises.reduce((sum, e) => sum + e.calories, 0);
            document.getElementById('widgetCaloriesBar').textContent = totalCalories;
        }

        // Water Tracker Functions
        function initWaterTracker() {
            const today = new Date().toDateString();
            if (waterData.date !== today) {
                waterData = { glasses: 0, date: today };
                localStorage.setItem(WATER_KEY, JSON.stringify(waterData));
            }
            updateWaterVisual();
        }

        function updateWaterVisual() {
            const visual = document.getElementById('waterVisual');
            const goal = 8;
            visual.innerHTML = '';

            for (let i = 0; i < goal; i++) {
                const glass = document.createElement('div');
                glass.className = 'water-glass' + (i < waterData.glasses ? ' filled' : ' empty');
                glass.onclick = () => toggleWaterGlass(i);
                visual.appendChild(glass);
            }

            document.getElementById('waterCount').textContent = waterData.glasses;
            document.getElementById('waterML').textContent = (waterData.glasses * 250) + 'ml';
        }

        function toggleWaterGlass(index) {
            if (index >= waterData.glasses) {
                waterData.glasses = index + 1;
            } else {
                waterData.glasses = index;
            }
            localStorage.setItem(WATER_KEY, JSON.stringify(waterData));
            updateWaterVisual();

            // Check if goal reached
            if (waterData.glasses === 8) {
                launchConfetti(20);
                document.getElementById('motivation').textContent = 'üéâ Â§™Ê£í‰∫ÜÔºÅ‰ªäÊó•È•ÆÊ∞¥ÁõÆÊ†áËææÊàêÔºÅ';
            }
        }

        function resetWater() {
            waterData.glasses = 0;
            localStorage.setItem(WATER_KEY, JSON.stringify(waterData));
            updateWaterVisual();
        }

        function updateWaterTracker() {
            const today = new Date().toDateString();
            if (waterData.date !== today) {
                waterData = { glasses: 0, date: today };
                localStorage.setItem(WATER_KEY, JSON.stringify(waterData));
            }
            updateWaterVisual();
        }

        // Exercise Logger Functions
        let selectedExerciseType = null;

        function initExerciseLogger() {
            const exerciseTypes = document.querySelectorAll('.exercise-type');
            exerciseTypes.forEach(type => {
                type.addEventListener('click', function() {
                    exerciseTypes.forEach(t => t.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedExerciseType = {
                        type: this.dataset.type,
                        calories: parseInt(this.dataset.calories),
                        name: this.querySelector('.exercise-name').textContent,
                        icon: this.querySelector('.exercise-icon').textContent
                    };
                });
            });
        }

        function addExercise() {
            if (!selectedExerciseType) {
                alert('ËØ∑ÂÖàÈÄâÊã©ËøêÂä®Á±ªÂûã');
                return;
            }

            const duration = parseInt(document.getElementById('exerciseDuration').value);
            const calories = selectedExerciseType.calories * duration;

            const exercise = {
                id: Date.now(),
                type: selectedExerciseType.type,
                name: selectedExerciseType.name,
                icon: selectedExerciseType.icon,
                duration: duration,
                calories: calories,
                date: new Date().toISOString()
            };

            exerciseLog.push(exercise);
            localStorage.setItem(EXERCISE_KEY, JSON.stringify(exerciseLog));

            // Reset selection
            selectedExerciseType = null;
            document.querySelectorAll('.exercise-type').forEach(t => t.classList.remove('selected'));

            updateExerciseList();
            launchConfetti(15);
        }

        function updateExerciseList() {
            const list = document.getElementById('exerciseList');
            const totalEl = document.getElementById('totalCalories');

            if (exerciseLog.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 20px;">ËøòÊ≤°ÊúâËøêÂä®ËÆ∞ÂΩïÔºåÂºÄÂßãËøêÂä®ÂêßÔºÅ</p>';
                totalEl.textContent = '0 ÂçÉÂç°';
                return;
            }

            // Calculate total calories from today's exercises
            const today = new Date().toDateString();
            const todayExercises = exerciseLog.filter(e => new Date(e.date).toDateString() === today);
            const totalCalories = todayExercises.reduce((sum, e) => sum + e.calories, 0);
            totalEl.textContent = totalCalories + ' ÂçÉÂç°';

            // Show recent exercises
            const recent = exerciseLog.slice(-10).reverse();
            list.innerHTML = recent.map(exercise => `
                <div class="exercise-item">
                    <div class="exercise-item-info">
                        <span style="font-size: 1.5rem;">${exercise.icon}</span>
                        <div>
                            <div style="font-weight: 600;">${exercise.name}</div>
                            <div style="font-size: 0.8rem; color: #7f8c8d;">${exercise.duration} ÂàÜÈíü</div>
                        </div>
                    </div>
                    <div class="exercise-calories">-${exercise.calories} ÂçÉÂç°</div>
                </div>
            `).join('');
        }

        // Sleep Tracker Functions
        let selectedSleepQuality = null;

        function openSleepModal() {
            document.getElementById('sleepDate').valueAsDate = new Date();
            document.getElementById('sleepHours').value = '';
            document.getElementById('sleepNote').value = '';
            document.querySelectorAll('#sleepQuality .quality-option').forEach(o => o.classList.remove('selected'));
            selectedSleepQuality = null;
            document.getElementById('sleepModal').classList.add('active');
        }

        function closeSleepModal() {
            document.getElementById('sleepModal').classList.remove('active');
        }

        function saveSleep() {
            const date = document.getElementById('sleepDate').value;
            const hours = parseFloat(document.getElementById('sleepHours').value);
            const note = document.getElementById('sleepNote').value.trim();

            if (!date || !hours) {
                alert('ËØ∑Â°´ÂÜôÊó•ÊúüÂíåÁù°Áú†Êó∂Èïø');
                return;
            }

            const sleepEntry = {
                date: date,
                hours: hours,
                quality: selectedSleepQuality,
                note: note
            };

            // Check if sleep for this date exists
            const existingIndex = sleepLog.findIndex(s => s.date === date);
            if (existingIndex !== -1) {
                sleepLog[existingIndex] = sleepEntry;
            } else {
                sleepLog.push(sleepEntry);
            }

            sleepLog.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem(SLEEP_KEY, JSON.stringify(sleepLog));

            closeSleepModal();
            updateSleepTracker();
        }

        function updateSleepTracker() {
            const avgEl = document.getElementById('avgSleepHours');
            const lastEl = document.getElementById('lastSleepHours');

            if (sleepLog.length === 0) {
                avgEl.textContent = '--';
                lastEl.textContent = '--';
                return;
            }

            // Calculate average
            const avg = sleepLog.reduce((sum, s) => sum + s.hours, 0) / sleepLog.length;
            avgEl.textContent = avg.toFixed(1);

            // Last night's sleep
            const last = sleepLog[sleepLog.length - 1];
            lastEl.textContent = last.hours.toFixed(1);
        }

        // Photo Gallery Functions
        let photoTempData = null;

        function openPhotoUpload() {
            document.getElementById('photoDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('photoWeight').value = '';
            document.getElementById('photoNote').value = '';
            document.getElementById('photoFile').value = '';
            document.getElementById('photoPreview').style.display = 'none';
            photoTempData = null;
            document.getElementById('photoModal').classList.add('active');
        }

        function closePhotoModal() {
            document.getElementById('photoModal').classList.remove('active');
        }

        // Handle file input change
        document.addEventListener('DOMContentLoaded', function() {
            const photoFileInput = document.getElementById('photoFile');
            if (photoFileInput) {
                photoFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            photoTempData = event.target.result;
                            document.getElementById('photoPreviewImg').src = photoTempData;
                            document.getElementById('photoPreview').style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        });

        function savePhoto() {
            const date = document.getElementById('photoDate').value;
            const weight = parseFloat(document.getElementById('photoWeight').value) || null;
            const note = document.getElementById('photoNote').value.trim();

            if (!date) {
                showWarningNotification('ËØ∑ÈÄâÊã©Êó•Êúü');
                return;
            }

            if (!photoTempData) {
                showWarningNotification('ËØ∑ÈÄâÊã©ÁÖßÁâá');
                return;
            }

            const photo = {
                id: Date.now(),
                date: date,
                weight: weight,
                note: note,
                image: photoTempData
            };

            progressPhotos.push(photo);
            progressPhotos.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Limit to 50 photos to prevent localStorage overflow
            if (progressPhotos.length > 50) {
                progressPhotos = progressPhotos.slice(-50);
            }

            localStorage.setItem(PHOTOS_KEY, JSON.stringify(progressPhotos));

            closePhotoModal();
            updatePhotoGallery();
            showSuccessNotification('ÁÖßÁâáÂ∑≤‰øùÂ≠òÔºÅ');
            addXP(20, 'Ê∑ªÂä†ËøõÂ∫¶ÁÖßÁâá');
        }

        function deletePhoto(id) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÂº†ÁÖßÁâáÂêóÔºü')) {
                progressPhotos = progressPhotos.filter(p => p.id !== id);
                localStorage.setItem(PHOTOS_KEY, JSON.stringify(progressPhotos));
                updatePhotoGallery();
                showSuccessNotification('ÁÖßÁâáÂ∑≤Âà†Èô§');
            }
        }

        function updatePhotoGallery() {
            const grid = document.getElementById('photoGrid');
            const empty = document.getElementById('photoEmpty');

            if (progressPhotos.length === 0) {
                grid.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            empty.style.display = 'none';

            grid.innerHTML = progressPhotos.map(photo => `
                <div class="photo-item">
                    <img src="${photo.image}" alt="Progress photo">
                    <div class="photo-item-overlay">
                        <div>
                            <div class="photo-date">${formatDate(photo.date)}</div>
                            ${photo.weight ? `<div class="photo-weight">${photo.weight.toFixed(1)} kg</div>` : ''}
                        </div>
                        <button class="photo-delete" onclick="deletePhoto(${photo.id})" title="Âà†Èô§">√ó</button>
                    </div>
                </div>
            `).reverse().join('');

            // Update before/after photo selectors
            updateBeforeAfterSelectors();
        }

        // Before/After Comparison Functions
        function updateBeforeAfterSelectors() {
            const section = document.getElementById('beforeAfterSection');
            const beforeSelect = document.getElementById('beforePhotoSelect');
            const afterSelect = document.getElementById('afterPhotoSelect');

            if (progressPhotos.length < 2) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            // Populate select options
            const options = progressPhotos.map((photo, index) =>
                `<option value="${index}">${formatDate(photo.date)} ${photo.weight ? '(' + photo.weight.toFixed(1) + 'kg)' : ''}</option>`
            ).join('');

            beforeSelect.innerHTML = '<option value="">ÈÄâÊã©ÂºÄÂßãÁÖßÁâá</option>' + options;
            afterSelect.innerHTML = '<option value="">ÈÄâÊã©ÁªìÊùüÁÖßÁâá</option>' + options;
        }

        function updateBeforeAfter() {
            const beforeIndex = document.getElementById('beforePhotoSelect').value;
            const afterIndex = document.getElementById('afterPhotoSelect').value;
            const content = document.getElementById('beforeAfterContent');

            if (beforeIndex === '' || afterIndex === '') {
                content.innerHTML = `
                    <div class="comparison-empty">
                        <div style="font-size: 3rem;">üì∑</div>
                        <p>ÈÄâÊã©‰∏§Âº†ÁÖßÁâáËøõË°åÂØπÊØî</p>
                    </div>
                `;
                return;
            }

            const beforePhoto = progressPhotos[beforeIndex];
            const afterPhoto = progressPhotos[afterIndex];

            const beforeWeight = beforePhoto.weight || findWeightForDate(beforePhoto.date);
            const afterWeight = afterPhoto.weight || findWeightForDate(afterPhoto.date);
            const weightDiff = afterWeight && beforeWeight ? (afterWeight - beforeWeight).toFixed(1) : null;

            const weightDiffHtml = weightDiff !== null ? `
                <div class="comparison-diff">
                    <div class="comparison-diff-value">
                        ‰ΩìÈáçÂèòÂåñ: ${weightDiff >= 0 ? '+' : ''}${weightDiff} kg
                        ${weightDiff < 0 ? 'üëè' : weightDiff > 0 ? '‚ö†Ô∏è' : '‚û°Ô∏è'}
                    </div>
                </div>
            ` : '';

            content.innerHTML = `
                <div class="comparison-side">
                    <div class="comparison-label">üìÖ ÂºÄÂßã</div>
                    <img src="${beforePhoto.image}" alt="Before" class="comparison-image">
                    <div class="comparison-info">
                        <div class="comparison-date">${formatDate(beforePhoto.date)}</div>
                        ${beforeWeight ? `<div class="comparison-weight">${beforeWeight.toFixed(1)} kg</div>` : ''}
                    </div>
                </div>
                <div class="comparison-side">
                    <div class="comparison-label">üéØ Áé∞Âú®</div>
                    <img src="${afterPhoto.image}" alt="After" class="comparison-image">
                    <div class="comparison-info">
                        <div class="comparison-date">${formatDate(afterPhoto.date)}</div>
                        ${afterWeight ? `<div class="comparison-weight">${afterWeight.toFixed(1)} kg</div>` : ''}
                    </div>
                </div>
                ${weightDiffHtml}
            `;
        }

        function findWeightForDate(date) {
            const entry = weightData.find(d => d.date === date);
            return entry ? entry.weight : null;
        }

        // Share Functions
        let shareData = {
            icon: 'üèÜ',
            text: '',
            stats: ''
        };

        function openShareModal(icon, text, stats) {
            shareData = { icon, text, stats };
            document.getElementById('sharePreviewIcon').textContent = icon;
            document.getElementById('sharePreviewText').textContent = text;
            document.getElementById('sharePreviewStats').textContent = stats;
            document.getElementById('shareModal').classList.add('active');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        function shareToClipboard() {
            const text = `${shareData.icon} ${shareData.text}\n${shareData.stats}\n\n‰ΩøÁî®„Äå‰ΩìÈáçÂ∞èÊú¨Êú¨„ÄçËÆ∞ÂΩïÊàëÁöÑÂÅ•Â∫∑‰πãÊóÖ ‚ú®`;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showSuccessNotification('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                    closeShareModal();
                }).catch(() => {
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showSuccessNotification('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                closeShareModal();
            } catch (err) {
                showWarningNotification('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
            }
            document.body.removeChild(textarea);
        }

        function shareToWeChat() {
            const text = `${shareData.icon} ${shareData.text}\n${shareData.stats}\n\n‰ΩøÁî®„Äå‰ΩìÈáçÂ∞èÊú¨Êú¨„ÄçËÆ∞ÂΩïÊàëÁöÑÂÅ•Â∫∑‰πãÊóÖ ‚ú®`;
            fallbackCopyToClipboard(text);
            showSuccessNotification('Â∑≤Â§çÂà∂ÔºÅËØ∑Âú®ÂæÆ‰ø°‰∏≠Á≤òË¥¥ÂàÜ‰∫´');
            closeShareModal();
        }

        function shareToWeibo() {
            const text = encodeURIComponent(`${shareData.icon} ${shareData.text} ${shareData.stats} ‰ΩøÁî®„Äå‰ΩìÈáçÂ∞èÊú¨Êú¨„ÄçËÆ∞ÂΩïÂÅ•Â∫∑‰πãÊóÖ`);
            const url = encodeURIComponent('https://github.com/yourusername/weight-tracker');
            window.open(`https://service.weibo.com/share/share.php?url=${url}&title=${text}`, '_blank');
            closeShareModal();
        }

        function shareAchievement(achievement) {
            openShareModal(
                'üèÜ',
                'Ëß£ÈîÅÊñ∞ÊàêÂ∞±ÔºÅ',
                achievement.title
            );
        }

        function shareMilestone(kg) {
            openShareModal(
                '‚≠ê',
                'ÈáåÁ®ãÁ¢ëËææÊàêÔºÅ',
                `Â∑≤Á¥ØËÆ°ÂáèÈáç ${kg} ÂÖ¨Êñ§`
            );
        }

        // Quick Add Functions
        function openQuickAdd() {
            document.getElementById('quickAddModal').classList.add('active');
            // Pre-fill with last weight if available
            if (weightData.length > 0) {
                const lastWeight = weightData[weightData.length - 1].weight;
                document.getElementById('quickAddWeight').placeholder = lastWeight.toFixed(1);
            }
            // Focus input after a short delay
            setTimeout(() => {
                document.getElementById('quickAddWeight').focus();
            }, 100);
        }

        function closeQuickAdd() {
            document.getElementById('quickAddModal').classList.remove('active');
            document.getElementById('quickAddWeight').value = '';
        }

        function submitQuickAdd() {
            const weight = parseFloat(document.getElementById('quickAddWeight').value);

            if (!weight || weight < 30 || weight > 300) {
                showWarningNotification('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑ‰ΩìÈáç (30-300kg)');
                return;
            }

            const today = new Date().toISOString().split('T')[0];

            // Check if entry for today already exists
            const existingIndex = weightData.findIndex(d => d.date === today);

            if (existingIndex !== -1) {
                // Update existing entry
                weightData[existingIndex].weight = weight;
                showSuccessNotification('‰ªäÊó•‰ΩìÈáçÂ∑≤Êõ¥Êñ∞ÔºÅ');
            } else {
                // Add new entry
                weightData.push({
                    date: today,
                    weight: weight
                });
                showSuccessNotification('‰ΩìÈáçËÆ∞ÂΩïÊàêÂäüÔºÅ');
                addXP(5, 'ËÆ∞ÂΩï‰ΩìÈáç');
            }

            saveData();
            closeQuickAdd();
            updateUI();
        }

        // Handle Enter key in quick add input
        document.addEventListener('DOMContentLoaded', function() {
            const quickAddInput = document.getElementById('quickAddWeight');
            if (quickAddInput) {
                quickAddInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        submitQuickAdd();
                    }
                });
            }

            // Handle Escape key to close modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeQuickAdd();
                }
            });
        });

        // Health Calculators Functions
        let currentCalculator = 'bmr';

        function initHealthCalculators() {
            const tabs = document.querySelectorAll('.calculator-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentCalculator = this.dataset.calc;
                    updateHealthCalculators();
                });
            });
        }

        function updateHealthCalculators() {
            const content = document.getElementById('calculatorContent');
            const height = settings.height;
            const weight = weightData.length > 0 ? weightData[weightData.length - 1].weight : null;
            const gender = settings.gender || 'female';

            let html = '';

            switch (currentCalculator) {
                case 'bmr':
                    html = `
                        <div style="text-align: center; padding: 20px;">
                            <p style="margin-bottom: 15px; color: #555;">Âü∫Á°Ä‰ª£Ë∞¢Áéá (BMR) ÊòØ‰Ω†Ë∫´‰ΩìÂú®‰ºëÊÅØÊó∂Ê∂àËÄóÁöÑÊúÄ‰ΩéÁÉ≠Èáè„ÄÇ</p>
                            ${height && weight ? `
                                <div class="calculator-result">
                                    <div class="result-value">${calculateBMR(weight, height, gender).toFixed(0)} ÂçÉÂç°/Â§©</div>
                                    <div class="result-description">
                                        ${gender === 'male' ? 'Áî∑ÊÄß' : 'Â•≥ÊÄß'} ¬∑ ${weight}kg ¬∑ ${height}cm
                                    </div>
                                </div>
                            ` : '<p style="color: #e74c3c;">ËØ∑ÂÖàÂú®ËÆæÁΩÆ‰∏≠Â°´ÂÜôË∫´È´òÂíå‰ΩìÈáç</p>'}
                            <p style="margin-top: 15px; font-size: 0.9rem; color: #7f8c8d;">
                                ÊèêÁ§∫ÔºöËøôÊòØÂü∫Á°Ä‰ª£Ë∞¢ÔºåÊó•Â∏∏Ê¥ªÂä®‰ºöÊ∂àËÄóÊõ¥Â§öÁÉ≠Èáè„ÄÇ
                            </p>
                        </div>
                    `;
                    break;

                case 'ideal':
                    html = `
                        <div style="text-align: center; padding: 20px;">
                            <p style="margin-bottom: 15px; color: #555;">Ê†πÊçÆË∫´È´òËÆ°ÁÆóÁöÑÁêÜÊÉ≥‰ΩìÈáçËåÉÂõ¥</p>
                            ${height ? `
                                <div class="calculator-result">
                                    <div class="result-value">${calculateIdealWeight(height).min} - ${calculateIdealWeight(height).max} kg</div>
                                    <div class="result-description">
                                        Ë∫´È´ò ${height}cm ÁöÑÂÅ•Â∫∑‰ΩìÈáçËåÉÂõ¥
                                    </div>
                                </div>
                                <div style="margin-top: 15px; display: flex; justify-content: center; gap: 20px;">
                                    <div>
                                        <div style="font-size: 0.8rem; color: #7f8c8d;">BMI 18.5</div>
                                        <div style="font-family: 'Caveat', cursive; font-size: 1.3rem;">${calculateIdealWeight(height).min}kg</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 0.8rem; color: #7f8c8d;">BMI 24</div>
                                        <div style="font-family: 'Caveat', cursive; font-size: 1.3rem;">${calculateIdealWeight(height).max}kg</div>
                                    </div>
                                </div>
                            ` : '<p style="color: #e74c3c;">ËØ∑ÂÖàÂú®ËÆæÁΩÆ‰∏≠Â°´ÂÜôË∫´È´ò</p>'}
                        </div>
                    `;
                    break;

                case 'water':
                    html = `
                        <div style="text-align: center; padding: 20px;">
                            <p style="margin-bottom: 15px; color: #555;">Ê†πÊçÆ‰ΩìÈáçËÆ°ÁÆóÁöÑÊØèÊó•Âª∫ËÆÆÈ•ÆÊ∞¥Èáè</p>
                            ${weight ? `
                                <div class="calculator-result">
                                    <div class="result-value">${Math.round(weight * 35)} ml</div>
                                    <div class="result-description">
                                        Á∫¶‰∏∫ ${Math.round(weight * 35 / 250)} ÊùØÊ∞¥ (250ml/ÊùØ)
                                    </div>
                                </div>
                                <p style="margin-top: 15px; font-size: 0.9rem; color: #7f8c8d;">
                                    üí° ËøêÂä®ÊàñÂá∫Ê±óÂ§öÊó∂ÈúÄË¶ÅÂ¢ûÂä†È•ÆÊ∞¥Èáè
                                </p>
                            ` : '<p style="color: #e74c3c;">ËØ∑ÂÖàËÆ∞ÂΩï‰ΩìÈáç</p>'}
                        </div>
                    `;
                    break;

                case 'calories':
                    html = `
                        <div style="text-align: center; padding: 20px;">
                            <p style="margin-bottom: 15px; color: #555;">ÊØèÊó•ÁÉ≠ÈáèÈúÄÊ±ÇÔºàÂü∫‰∫éÊ¥ªÂä®Ê∞¥Âπ≥Ôºâ</p>
                            ${height && weight ? `
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;">
                                    <div style="padding: 10px; background: rgba(255,255,255,0.8); border-radius: 10px; border: 1px dashed var(--ink);">
                                        <div style="font-size: 0.8rem; color: #7f8c8d;">‰πÖÂùêÂ∞ëÂä®</div>
                                        <div style="font-family: 'Caveat', cursive; font-size: 1.3rem;">${Math.round(calculateBMR(weight, height, gender) * 1.2)} ÂçÉÂç°</div>
                                    </div>
                                    <div style="padding: 10px; background: rgba(255,255,255,0.8); border-radius: 10px; border: 1px dashed var(--ink);">
                                        <div style="font-size: 0.8rem; color: #7f8c8d;">ËΩªÂ∫¶Ê¥ªÂä®</div>
                                        <div style="font-family: 'Caveat', cursive; font-size: 1.3rem;">${Math.round(calculateBMR(weight, height, gender) * 1.375)} ÂçÉÂç°</div>
                                    </div>
                                    <div style="padding: 10px; background: rgba(255,255,255,0.8); border-radius: 10px; border: 1px dashed var(--ink);">
                                        <div style="font-size: 0.8rem; color: #7f8c8d;">‰∏≠Â∫¶Ê¥ªÂä®</div>
                                        <div style="font-family: 'Caveat', cursive; font-size: 1.3rem;">${Math.round(calculateBMR(weight, height, gender) * 1.55)} ÂçÉÂç°</div>
                                    </div>
                                    <div style="padding: 10px; background: rgba(255,255,255,0.8); border-radius: 10px; border: 1px dashed var(--ink);">
                                        <div style="font-size: 0.8rem; color: #7f8c8d;">ÈáçÂ∫¶Ê¥ªÂä®</div>
                                        <div style="font-family: 'Caveat', cursive; font-size: 1.3rem;">${Math.round(calculateBMR(weight, height, gender) * 1.725)} ÂçÉÂç°</div>
                                    </div>
                                </div>
                                <p style="margin-top: 15px; font-size: 0.8rem; color: #7f8c8d;">
                                    Âü∫Á°Ä‰ª£Ë∞¢: ${Math.round(calculateBMR(weight, height, gender))} ÂçÉÂç°
                                </p>
                            ` : '<p style="color: #e74c3c;">ËØ∑ÂÖàÂú®ËÆæÁΩÆ‰∏≠Â°´ÂÜôË∫´È´òÂíåËÆ∞ÂΩï‰ΩìÈáç</p>'}
                        </div>
                    `;
                    break;
            }

            content.innerHTML = html;
        }

        function calculateBMR(weight, height, gender) {
            // Mifflin-St Jeor Equation
            if (gender === 'male') {
                return 10 * weight + 6.25 * height - 5 * 30 + 5;
            } else {
                return 10 * weight + 6.25 * height - 5 * 30 - 161;
            }
        }

        function calculateIdealWeight(height) {
            const minBMI = 18.5;
            const maxBMI = 24;
            const heightM = height / 100;
            return {
                min: Math.round(minBMI * heightM * heightM),
                max: Math.round(maxBMI * heightM * heightM)
            };
        }

        // Measurements functions
        function openMeasurementsModal() {
            document.getElementById('measurementDate').valueAsDate = new Date();
            document.getElementById('measurementsModal').classList.add('active');
        }

        function closeMeasurementsModal() {
            document.getElementById('measurementsModal').classList.remove('active');
            // Clear inputs
            ['chest', 'waist', 'hips', 'thigh', 'arm', 'neck'].forEach(id => {
                document.getElementById(id).value = '';
            });
        }

        function saveMeasurements() {
            const date = document.getElementById('measurementDate').value;
            const chest = parseFloat(document.getElementById('chest').value) || null;
            const waist = parseFloat(document.getElementById('waist').value) || null;
            const hips = parseFloat(document.getElementById('hips').value) || null;
            const thigh = parseFloat(document.getElementById('thigh').value) || null;
            const arm = parseFloat(document.getElementById('arm').value) || null;
            const neck = parseFloat(document.getElementById('neck').value) || null;

            if (!date) {
                alert('ËØ∑ÈÄâÊã©Êó•Êúü');
                return;
            }

            const measurementData = { date, chest, waist, hips, thigh, arm, neck };

            // Check if measurement for this date exists
            const existingIndex = measurements.findIndex(m => m.date === date);
            if (existingIndex !== -1) {
                measurements[existingIndex] = { ...measurements[existingIndex], ...measurementData };
            } else {
                measurements.push(measurementData);
            }

            measurements.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem(MEASUREMENTS_KEY, JSON.stringify(measurements));

            closeMeasurementsModal();
            updateMeasurements();
            checkAndUnlockAchievements();
        }

        function updateMeasurements() {
            const grid = document.getElementById('measurementsGrid');
            const empty = document.getElementById('measurementsEmpty');

            if (measurements.length === 0) {
                grid.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            empty.style.display = 'none';

            const latest = measurements[measurements.length - 1];
            const previous = measurements.length > 1 ? measurements[measurements.length - 2] : null;

            const measurementTypes = [
                { key: 'chest', label: 'ËÉ∏Âõ¥' },
                { key: 'waist', label: 'ËÖ∞Âõ¥' },
                { key: 'hips', label: 'ËáÄÂõ¥' },
                { key: 'thigh', label: 'Â§ßËÖø' },
                { key: 'arm', label: 'ÊâãËáÇ' },
                { key: 'neck', label: 'È¢àÂõ¥' }
            ];

            grid.innerHTML = measurementTypes.map(type => {
                const value = latest[type.key];
                if (!value) return '';

                let changeHtml = '';
                if (previous && previous[type.key]) {
                    const change = value - previous[type.key];
                    const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : '';
                    const changeText = change > 0 ? '+' : '';
                    changeHtml = `<div class="measurement-change ${changeClass}">${changeText}${change.toFixed(1)}cm</div>`;
                }

                return `
                    <div class="measurement-item">
                        <div class="measurement-label">${type.label}</div>
                        <div class="measurement-value">${value}</div>
                        ${changeHtml}
                    </div>
                `;
            }).join('');
        }

        // Achievements functions
        function checkAndUnlockAchievements() {
            const newlyUnlocked = [];

            // Check each achievement
            achievementDefinitions.forEach(achievement => {
                if (unlockedAchievements.includes(achievement.id)) return;

                let unlocked = false;

                switch (achievement.id) {
                    case 'first':
                        unlocked = weightData.length >= 1;
                        break;
                    case 'week':
                    case 'streak_7':
                        unlocked = calculateStreak() >= 7;
                        break;
                    case 'month':
                        unlocked = calculateStreak() >= 30;
                        break;
                    case 'ten_records':
                        unlocked = weightData.length >= 10;
                        break;
                    case 'fifty_records':
                        unlocked = weightData.length >= 50;
                        break;
                    case 'goal_reached':
                        if (settings.goalWeight && weightData.length > 0) {
                            unlocked = weightData[weightData.length - 1].weight <= settings.goalWeight;
                        }
                        break;
                    case 'five_lost':
                    case 'ten_lost':
                        if (weightData.length >= 2) {
                            const totalLost = weightData[0].weight - weightData[weightData.length - 1].weight;
                            const threshold = achievement.id === 'five_lost' ? 5 : 10;
                            unlocked = totalLost >= threshold;
                        }
                        break;
                    case 'mood_tracker':
                        const moodCount = weightData.filter(item => item.mood).length;
                        unlocked = moodCount >= 10;
                        break;
                    case 'early_bird':
                    case 'night_owl':
                        const hour = new Date().getHours();
                        unlocked = (achievement.id === 'early_bird' && hour >= 6 && hour < 9) ||
                                   (achievement.id === 'night_owl' && hour >= 21 && hour < 24);
                        break;
                    case 'consistent':
                        if (weightData.length >= 7) {
                            const recent = weightData.slice(-7);
                            const weights = recent.map(d => d.weight);
                            const max = Math.max(...weights);
                            const min = Math.min(...weights);
                            unlocked = (max - min) < 1;
                        }
                        break;
                    case 'measurement_pro':
                        unlocked = measurements.length >= 5;
                        break;
                    case 'photo_taker':
                        unlocked = progressPhotos.length >= 3;
                        break;
                    case 'data_exporter':
                        // This is unlocked when exportData is called
                        break;
                }

                if (unlocked) {
                    unlockedAchievements.push(achievement.id);
                    newlyUnlocked.push(achievement);
                }
            });

            if (newlyUnlocked.length > 0) {
                localStorage.setItem(UNLOCKED_KEY, JSON.stringify(unlockedAchievements));
                newlyUnlocked.forEach(a => {
                    launchConfetti(30);
                    // Award XP for achievement
                    addXP(50, `Ëß£ÈîÅÊàêÂ∞±Ôºö${a.name}`);
                    // Show notification
                    showAchievementNotification(a.name, a.description);
                    setTimeout(() => {
                        document.getElementById('motivation').textContent = `üèÜ Ëß£ÈîÅÊàêÂ∞±Ôºö${a.icon} ${a.name}`;
                    }, 500);
                });
            }

            updateAchievements();
        }

        function updateAchievements() {
            const section = document.getElementById('achievementsSection');
            const grid = document.getElementById('achievementsGrid');

            if (achievementDefinitions.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            grid.innerHTML = achievementDefinitions.map(achievement => {
                const unlocked = unlockedAchievements.includes(achievement.id);
                const newBadge = unlocked && !achievement.shown;
                if (unlocked) achievement.shown = true;

                return `
                    <div class="achievement-badge ${unlocked ? 'unlocked' : ''} ${newBadge ? 'new' : ''}" title="${achievement.description}" style="position: relative;">
                        ${unlocked ? `<button class="achievement-share-btn" onclick="openShareModal('${achievement.id}')" title="ÂàÜ‰∫´">üì§</button>` : ''}
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-name">${achievement.name}</div>
                    </div>
                `;
            }).join('');
        }

        // Share Achievement Functions
        function openShareModal(achievementId) {
            const achievement = achievementDefinitions.find(a => a.id === achievementId);
            if (!achievement) return;

            // Update modal content
            document.getElementById('shareBadge').textContent = achievement.icon;
            document.getElementById('shareTitle').textContent = achievement.name;

            // Update stats
            const currentWeight = weightData.length > 0 ? weightData[weightData.length - 1].weight.toFixed(1) : '--';
            const streak = calculateStreak();
            const days = weightData.length;

            document.getElementById('shareWeight').textContent = currentWeight;
            document.getElementById('shareStreak').textContent = streak;
            document.getElementById('shareDays').textContent = days;

            // Show modal
            document.getElementById('shareModal').classList.add('active');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        function shareToWechat() {
            // WeChat sharing requires WeChat JS-SDK
            // For now, show a message
            alert('üì± ËØ∑Êà™ÂõæÂàÜ‰∫´Âà∞ÂæÆ‰ø°ÊúãÂèãÂúà\nÊàñ‰ΩøÁî®‰øùÂ≠òÊåâÈíÆ‰∏ãËΩΩÂõæÁâáÂêéÂàÜ‰∫´');
        }

        function shareToWeibo() {
            const text = encodeURIComponent(`ÊàëÂú®‰ΩìÈáçÂ∞èÊú¨Êú¨‰∏≠Ëß£ÈîÅ‰∫ÜÊàêÂ∞±ÔºÅ${document.getElementById('shareTitle').textContent} üèÜ #‰ΩìÈáçÂ∞èÊú¨Êú¨ #ÂÅ•Â∫∑ÁîüÊ¥ª`);
            const url = encodeURIComponent(window.location.href);
            window.open(`https://service.weibo.com/share/share.php?title=${text}&url=${url}`, '_blank');
        }

        function downloadShareCard() {
            const card = document.getElementById('shareCard');

            // Create canvas from the card
            html2canvas(card, {
                backgroundColor: '#ffffff',
                scale: 2
            }).then(canvas => {
                // Download the canvas as image
                const link = document.createElement('a');
                link.download = `‰ΩìÈáçÂ∞èÊú¨Êú¨-ÊàêÂ∞±-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(err => {
                console.error('Error generating image:', err);
                alert('üí° ÊèêÁ§∫ÔºöËØ∑‰ΩøÁî®Êà™ÂõæÂäüËÉΩ‰øùÂ≠òÊàêÂ∞±Âç°Áâá');
            });
        }

        // Close modal on background click
        document.getElementById('shareModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeShareModal();
            }
        });

        // Mood distribution chart
        function updateMoodChart() {
            const container = document.getElementById('moodChartContainer');
            const chart = document.getElementById('moodChart');
            const legend = document.getElementById('moodLegend');

            const moodEntries = weightData.filter(item => item.mood);
            if (moodEntries.length < 3) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';

            // Count moods
            const moodCounts = { great: 0, good: 0, okay: 0, bad: 0, awful: 0 };
            moodEntries.forEach(item => {
                if (item.mood) moodCounts[item.mood]++;
            });

            const total = moodEntries.length;
            const moodColors = {
                great: '#a8e6cf',
                good: '#b8d8e0',
                okay: '#fff5ba',
                bad: '#ffd3b6',
                awful: '#ffaaa5'
            };
            const moodEmojisArr = ['üòÑ', 'üôÇ', 'üòê', 'üòî', 'üò´'];

            // Create chart segments
            let html = '';
            let offset = 0;
            Object.entries(moodCounts).forEach(([mood, count]) => {
                if (count > 0) {
                    const percentage = (count / total) * 100;
                    html += `
                        <div class="mood-segment" style="width: ${percentage}%; background: ${moodColors[mood]};"
                             title="${count}Ê¨° (${percentage.toFixed(1)}%)">
                            ${percentage >= 15 ? moodEmojisArr[Object.keys(moodCounts).indexOf(mood)] : ''}
                        </div>
                    `;
                }
            });
            chart.innerHTML = html;

            // Create legend
            legend.innerHTML = Object.entries(moodCounts).map(([mood, count]) => {
                if (count === 0) return '';
                const percentage = ((count / total) * 100).toFixed(1);
                return `
                    <div class="mood-legend-item">
                        <div class="mood-legend-color" style="background: ${moodColors[mood]}"></div>
                        <span>${moodEmojisArr[Object.keys(moodCounts).indexOf(mood)]} ${percentage}%</span>
                    </div>
                `;
            }).join('');
        }

        function updateStreak() {
            const streak = calculateStreak();
            const streakBadge = document.getElementById('streakBadge');
            if (streak >= 2) {
                streakBadge.style.display = 'inline-flex';
                document.getElementById('streakCount').textContent = streak;
            } else {
                streakBadge.style.display = 'none';
            }

            // Update streak rewards section
            updateStreakRewards(streak);
        }

        function updateStreakRewards(streak) {
            const streakNumber = document.getElementById('streakNumber');
            const streakLevels = document.getElementById('streakLevels');

            streakNumber.textContent = streak;

            const levels = [
                { days: 3, icon: 'üåü', label: '3Â§©Ëµ∑Ê≠•', reward: '+10 XP' },
                { days: 7, icon: '‚≠ê', label: '‰∏ÄÂë®ÂùöÊåÅ', reward: '+25 XP' },
                { days: 14, icon: 'üí´', label: '‰∏§Âë®Ëææ‰∫∫', reward: '+50 XP' },
                { days: 30, icon: 'üèÖ', label: 'ÊúàÂ∫¶ÂÜ†ÂÜõ', reward: '+100 XP' },
                { days: 60, icon: 'üèÜ', label: 'ÂèåÊúàÁéãËÄÖ', reward: '+200 XP' },
                { days: 100, icon: 'üëë', label: 'ÁôæÊó•‰º†Â•á', reward: '+500 XP' }
            ];

            streakLevels.innerHTML = levels.map(level => {
                const achieved = streak >= level.days;
                const current = streak >= level.days && (streak < level.days + 3 || level.days === 100);
                return `
                    <div class="streak-level ${achieved ? 'achieved' : ''} ${current ? 'current' : ''}">
                        <div class="streak-level-icon">${level.icon}</div>
                        <div class="streak-level-label">${level.label}</div>
                        <div class="streak-level-reward">${level.reward}</div>
                    </div>
                `;
            }).join('');
        }

        function updateWeightBadges() {
            const section = document.getElementById('weightBadges');
            const grid = document.getElementById('badgesGrid');

            if (weightData.length < 2) {
                section.style.display = 'none';
                return;
            }

            const firstWeight = weightData[0].weight;
            const currentWeight = weightData[weightData.length - 1].weight;
            const totalLost = firstWeight - currentWeight;

            // Only show badges if there's been some weight loss
            if (totalLost <= 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            const badges = [
                { loss: 1, icon: 'üåü', label: 'Ëµ∑Ê≠•1kg', reward: '+5 XP' },
                { loss: 2, icon: '‚≠ê', label: 'ÂáèÈáç2kg', reward: '+10 XP' },
                { loss: 3, icon: 'üí´', label: 'ÂáèÈáç3kg', reward: '+15 XP' },
                { loss: 5, icon: 'üèÖ', label: 'ÂáèÈáç5kg', reward: '+25 XP' },
                { loss: 7, icon: 'üéñÔ∏è', label: 'ÂáèÈáç7kg', reward: '+35 XP' },
                { loss: 10, icon: 'üèÜ', label: 'ÂáèÈáç10kg', reward: '+50 XP' },
                { loss: 15, icon: 'üëë', label: 'ÂáèÈáç15kg', reward: '+75 XP' },
                { loss: 20, icon: 'üíé', label: 'ÂáèÈáç20kg', reward: '+100 XP' },
                { loss: 25, icon: 'üåà', label: 'ÂáèÈáç25kg', reward: '+125 XP' },
                { loss: 30, icon: 'üî•', label: 'ÂáèÈáç30kg', reward: '+150 XP' }
            ];

            grid.innerHTML = badges.map(badge => {
                const achieved = totalLost >= badge.loss;
                return `
                    <div class="badge-item ${achieved ? 'achieved' : 'locked'}">
                        <span class="badge-icon">${badge.icon}</span>
                        <div class="badge-label">${badge.label}</div>
                        <div class="badge-target">${badge.reward}</div>
                    </div>
                `;
            }).join('');
        }

        // Weight Stability Indicator
        let stabilityPeriod = 7;

        function setStabilityPeriod(days) {
            stabilityPeriod = days;
            // Update active tab
            document.querySelectorAll('.stability-tab').forEach(tab => {
                tab.classList.toggle('active', parseInt(tab.dataset.period) === days);
            });
            updateStabilityIndicator();
        }

        function updateStabilityIndicator() {
            const section = document.getElementById('stabilityIndicator');

            if (weightData.length < 3) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            // Get data for the selected period
            const now = new Date();
            const startDate = new Date(now);
            startDate.setDate(now.getDate() - stabilityPeriod);

            const periodData = weightData.filter(item => new Date(item.date) >= startDate);

            if (periodData.length < 2) {
                document.getElementById('stabilityStatus').textContent = 'Êï∞ÊçÆ‰∏çË∂≥';
                document.getElementById('stabilityDescription').textContent = 'ÈúÄË¶ÅÊõ¥Â§öËÆ∞ÂΩïÊù•ÂàÜÊûêË∂ãÂäø';
                document.getElementById('stabilityIcon').textContent = 'üìä';
                return;
            }

            // Calculate metrics
            const weights = periodData.map(d => d.weight);
            const avgWeight = weights.reduce((a, b) => a + b) / weights.length;
            const minWeight = Math.min(...weights);
            const maxWeight = Math.max(...weights);
            const firstWeight = weights[0];
            const lastWeight = weights[weights.length - 1];
            const weightChange = lastWeight - firstWeight;
            const weightRange = maxWeight - minWeight;

            // Determine stability status
            const changePercent = Math.abs(weightChange / avgWeight) * 100;
            const rangePercent = (weightRange / avgWeight) * 100;

            let icon, status, description;

            if (changePercent < 0.5 && rangePercent < 1) {
                icon = '‚ú®';
                status = 'ÈùûÂ∏∏Á®≥ÂÆö';
                description = '‰Ω†ÁöÑ‰ΩìÈáç‰øùÊåÅÂæóÂæàÁ®≥ÂÆöÔºåÁªßÁª≠‰øùÊåÅÔºÅ';
            } else if (changePercent < 1 && rangePercent < 2) {
                icon = 'üìä';
                status = 'Âü∫Êú¨Á®≥ÂÆö';
                description = '‰ΩìÈáçÂèòÂåñÂú®Ê≠£Â∏∏ËåÉÂõ¥ÂÜÖÔºåÁä∂ÊÄÅËâØÂ•Ω„ÄÇ';
            } else if (weightChange > 0) {
                icon = 'üìà';
                status = '‰∏äÂçáË∂ãÂäø';
                description = `ËøëÊúü‰ΩìÈáçÂ¢ûÂä†‰∫Ü ${weightChange.toFixed(1)} kgÔºåÊ≥®ÊÑèÈ•ÆÈ£üÂíåËøêÂä®„ÄÇ`;
            } else {
                icon = 'üìâ';
                status = '‰∏ãÈôçË∂ãÂäø';
                description = `ËøëÊúü‰ΩìÈáçÂáèÂ∞ë‰∫Ü ${Math.abs(weightChange).toFixed(1)} kgÔºåËøõÊ≠•ÊòæËëóÔºÅ`;
            }

            // Update UI
            document.getElementById('stabilityIcon').textContent = icon;
            document.getElementById('stabilityStatus').textContent = status;
            document.getElementById('stabilityDescription').textContent = description;
            document.getElementById('stabilityAvg').textContent = avgWeight.toFixed(1) + ' kg';
            document.getElementById('stabilityChange').textContent = (weightChange >= 0 ? '+' : '') + weightChange.toFixed(1) + ' kg';
            document.getElementById('stabilityRange').textContent = weightRange.toFixed(1) + ' kg';
        }

        function updateStats() {
            if (weightData.length === 0) {
                ['currentWeight', 'weightChange', 'totalChange', 'avgWeight', 'bmiValue'].forEach(id => {
                    document.getElementById(id).textContent = '--';
                });
                ['miniLastWeight', 'miniCurrentWeight', 'miniGoalWeight'].forEach(id => {
                    document.getElementById(id).textContent = '--';
                });
                document.getElementById('bmiMarker').style.left = '0%';
                document.getElementById('bmiStatus').textContent = '';
                document.getElementById('goalSection').style.display = 'none';
                document.getElementById('trendSection').style.display = 'none';
                document.getElementById('summaryCards').style.display = 'none';
                document.getElementById('predictionBadge').style.display = 'none';
                return;
            }

            const current = weightData[weightData.length - 1].weight;
            const previous = weightData.length > 1 ? weightData[weightData.length - 2].weight : current;
            const first = weightData[0].weight;
            const avg = weightData.reduce((sum, item) => sum + item.weight, 0) / weightData.length;

            // Update mini stats
            document.getElementById('miniLastWeight').textContent = previous.toFixed(1);
            document.getElementById('miniCurrentWeight').textContent = current.toFixed(1);
            document.getElementById('miniGoalWeight').textContent = settings.goalWeight ? settings.goalWeight.toFixed(1) : '--';

            const change = current - previous;
            const totalChange = current - first;

            document.getElementById('currentWeight').textContent = current.toFixed(1);
            document.getElementById('weightChange').textContent = (change >= 0 ? '+' : '') + change.toFixed(1);
            document.getElementById('weightChange').style.color = change > 0 ? '#e74c3c' : change < 0 ? '#27ae60' : '#7f8c8d';
            document.getElementById('totalChange').textContent = (totalChange >= 0 ? '+' : '') + totalChange.toFixed(1);
            document.getElementById('totalChange').style.color = totalChange > 0 ? '#e74c3c' : totalChange < 0 ? '#27ae60' : '#7f8c8d';
            document.getElementById('avgWeight').textContent = avg.toFixed(1);

            // BMI
            const bmi = calculateBMI(current, settings.height);
            if (bmi) {
                document.getElementById('bmiValue').textContent = bmi.toFixed(1);
                const status = getBMIStatus(bmi);
                document.getElementById('bmiStatus').textContent = status.text;
                document.getElementById('bmiStatus').style.color = status.color;

                const bmiPercent = Math.max(0, Math.min(100, ((bmi - 15) / 20) * 100));
                document.getElementById('bmiMarker').style.left = bmiPercent + '%';
            } else {
                document.getElementById('bmiValue').textContent = '--';
                document.getElementById('bmiStatus').textContent = 'ËØ∑Âú®ËÆæÁΩÆ‰∏≠Â°´ÂÜôË∫´È´ò‰ª•ËÆ°ÁÆó BMI';
                document.getElementById('bmiMarker').style.left = '0%';
            }

            // Goal
            if (settings.goalWeight) {
                const startWeight = first;
                const goalDiff = startWeight - settings.goalWeight;
                const currentDiff = startWeight - current;
                const progress = goalDiff !== 0 ? Math.min(100, Math.max(0, (currentDiff / goalDiff) * 100)) : 0;

                const goalSection = document.getElementById('goalSection');
                goalSection.style.display = 'block';

                if (current <= settings.goalWeight) {
                    goalSection.classList.add('achieved');
                } else {
                    goalSection.classList.remove('achieved');
                }

                document.getElementById('goalText').textContent = `${startWeight.toFixed(1)} ‚Üí ${settings.goalWeight.toFixed(1)} kg`;
                document.getElementById('goalProgress').style.width = progress + '%';

                const remaining = current - settings.goalWeight;
                if (remaining > 0) {
                    document.getElementById('goalRemaining').textContent = `ËøòÊúâ ${remaining.toFixed(1)} kg ËææÊàêÁõÆÊ†á üí™`;
                } else {
                    document.getElementById('goalRemaining').textContent = `üéâ Â∑≤ËææÊàêÁõÆÊ†áÔºÅ`;
                }
            } else {
                document.getElementById('goalSection').style.display = 'none';
            }

            // Trends
            const trend7 = calculateTrend(7);
            const trend30 = calculateTrend(30);
            const maxW = Math.max(...weightData.map(d => d.weight));
            const minW = Math.min(...weightData.map(d => d.weight));

            document.getElementById('trendSection').style.display = 'grid';

            if (trend7 !== null) {
                const trendEl = document.getElementById('trend7days');
                trendEl.textContent = (trend7 >= 0 ? '+' : '') + trend7.toFixed(1) + ' kg';
                trendEl.className = 'trend-value ' + (trend7 > 0 ? 'up' : trend7 < 0 ? 'down' : 'neutral');
            } else {
                document.getElementById('trend7days').textContent = '--';
                document.getElementById('trend7days').className = 'trend-value';
            }

            if (trend30 !== null) {
                const trendEl = document.getElementById('trend30days');
                trendEl.textContent = (trend30 >= 0 ? '+' : '') + trend30.toFixed(1) + ' kg';
                trendEl.className = 'trend-value ' + (trend30 > 0 ? 'up' : trend30 < 0 ? 'down' : 'neutral');
            } else {
                document.getElementById('trend30days').textContent = '--';
                document.getElementById('trend30days').className = 'trend-value';
            }

            document.getElementById('maxWeight').textContent = maxW.toFixed(1) + ' kg';
            document.getElementById('minWeight').textContent = minW.toFixed(1) + ' kg';

            // Weekly/Monthly summary
            const weeklyAvg = calculateWeeklyAverage();
            const monthlyAvg = calculateMonthlyAverage();
            const weeklyChange = calculateTrend(7);
            const monthlyChange = calculateTrend(30);

            document.getElementById('summaryCards').style.display = 'grid';

            document.getElementById('weeklyAvg').textContent = weeklyAvg ? weeklyAvg.toFixed(1) : '--';
            document.getElementById('monthlyAvg').textContent = monthlyAvg ? monthlyAvg.toFixed(1) : '--';

            const weeklyChangeEl = document.getElementById('weeklyChange');
            if (weeklyChange !== null) {
                weeklyChangeEl.textContent = (weeklyChange >= 0 ? '+' : '') + weeklyChange.toFixed(1);
                weeklyChangeEl.style.color = weeklyChange > 0 ? '#e74c3c' : weeklyChange < 0 ? '#27ae60' : '#7f8c8d';
            } else {
                weeklyChangeEl.textContent = '--';
                weeklyChangeEl.style.color = '#7f8c8d';
            }

            const monthlyChangeEl = document.getElementById('monthlyChange');
            if (monthlyChange !== null) {
                monthlyChangeEl.textContent = (monthlyChange >= 0 ? '+' : '') + monthlyChange.toFixed(1);
                monthlyChangeEl.style.color = monthlyChange > 0 ? '#e74c3c' : monthlyChange < 0 ? '#27ae60' : '#7f8c8d';
            } else {
                monthlyChangeEl.textContent = '--';
                monthlyChangeEl.style.color = '#7f8c8d';
            }

            // Prediction
            const predictedWeight = predictWeight();
            if (predictedWeight !== null) {
                document.getElementById('predictionBadge').style.display = 'inline-block';
                document.getElementById('predictionValue').textContent = predictedWeight.toFixed(1) + ' kg';
            } else {
                document.getElementById('predictionBadge').style.display = 'none';
            }
        }

        function updateList() {
            const list = document.getElementById('weightList');

            if (weightData.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <span class="emoji">üóíÔ∏è</span>
                        <p>ËøòÊ≤°ÊúâËÆ∞ÂΩïÂì¶ÔºåÂºÄÂßãËÆ∞ÂΩï‰Ω†ÁöÑÁ¨¨‰∏ÄÊ¨°ÂêßÔºÅ</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = weightData.map((item, index) => {
                const change = index > 0 ? item.weight - weightData[index - 1].weight : 0;
                const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                const changeText = change > 0 ? '‚Üë' : change < 0 ? '‚Üì' : '‚àí';
                const noteHtml = item.note ? `<span class="weight-note">"${item.note}"</span>` : '';
                const moodHtml = item.mood ? `<span class="mood-display" title="ÂøÉÊÉÖ">${moodEmojis[item.mood]}</span>` : '';

                return `
                    <li class="weight-item">
                        <div class="weight-item-main">
                            <span class="weight-date">${formatDate(item.date)}</span>
                            ${noteHtml}
                        </div>
                        ${moodHtml}
                        <span class="weight-value">${item.weight.toFixed(1)} kg</span>
                        <span class="weight-change ${changeClass}">
                            <span class="weight-trend-icon">${changeText}</span>
                            <span>${Math.abs(change).toFixed(1)}</span>
                        </span>
                        <div class="weight-actions">
                            <button class="edit-btn" onclick="editEntry(${index})" title="ÁºñËæë">‚úèÔ∏è</button>
                            <button class="delete-btn" onclick="deleteEntry(${index})" title="Âà†Èô§">√ó</button>
                        </div>
                    </li>
                `;
            }).reverse().join('');
        }

        function updateTimeline() {
            const section = document.getElementById('progressTimeline');
            const timeline = document.getElementById('timeline');

            if (weightData.length < 2) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            // Build timeline items
            let items = [];

            // Add weight entries (show every entry or important ones)
            weightData.forEach((item, index) => {
                const change = index > 0 ? item.weight - weightData[index - 1].weight : 0;
                const isMilestone = index === 0 || index === weightData.length - 1;
                const moodEmoji = item.mood ? moodEmojis[item.mood] : '';

                items.push({
                    type: 'weight',
                    date: new Date(item.date),
                    data: { item, change, isMilestone, moodEmoji }
                });
            });

            // Add milestone achievements (every 5kg lost)
            if (weightData.length > 0) {
                const startWeight = weightData[0].weight;
                const currentWeight = weightData[weightData.length - 1].weight;
                const totalLost = startWeight - currentWeight;

                for (let kg = 5; kg <= totalLost; kg += 5) {
                    items.push({
                        type: 'milestone',
                        date: null, // Will be calculated
                        data: { kg, startWeight }
                    });
                }
            }

            // Sort items by date
            items.sort((a, b) => {
                if (a.type === 'milestone' && b.type === 'milestone') return a.data.kg - b.data.kg;
                if (a.type === 'milestone') return 1;
                if (b.type === 'milestone') return -1;
                return new Date(a.date) - new Date(b.date);
            });

            // Generate HTML (show last 15 items)
            const recentItems = items.slice(-15);

            timeline.innerHTML = recentItems.map((item, idx) => {
                if (item.type === 'weight') {
                    const { item: weightItem, change, isMilestone, moodEmoji } = item.data;
                    const changeText = change > 0 ? `+${change.toFixed(1)}` : change.toFixed(1);
                    const changeColor = change > 0 ? '#e74c3c' : change < 0 ? '#27ae60' : '#7f8c8d';
                    const milestoneClass = isMilestone ? 'timeline-milestone' : '';

                    return `
                        <div class="timeline-item" style="animation-delay: ${idx * 0.05}s">
                            <div class="timeline-dot weight">${isMilestone ? 'üéØ' : '‚öñÔ∏è'}</div>
                            <div class="timeline-content ${milestoneClass}">
                                <div class="timeline-date">${formatDate(weightItem.date)}</div>
                                <div class="timeline-header">
                                    <span class="timeline-icon">‚öñÔ∏è</span>
                                    <span class="timeline-label">‰ΩìÈáçËÆ∞ÂΩï</span>
                                    ${moodEmoji ? `<span class="timeline-mood">${moodEmoji}</span>` : ''}
                                </div>
                                <div class="timeline-value">${weightItem.weight.toFixed(1)} kg</div>
                                ${weightItem.note ? `<div class="timeline-note">"${weightItem.note}"</div>` : ''}
                                <div class="timeline-stats">
                                    <div class="timeline-stat" style="color: ${changeColor}">
                                        ${changeText} kg
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    const { kg, startWeight } = item.data;
                    const targetWeight = startWeight - kg;

                    return `
                        <div class="timeline-item" style="animation-delay: ${idx * 0.05}s">
                            <div class="timeline-dot milestone">üèÜ</div>
                            <div class="timeline-content timeline-milestone">
                                <div class="timeline-header">
                                    <span class="timeline-icon">üèÜ</span>
                                    <span class="timeline-label">ÈáåÁ®ãÁ¢ëËææÊàê</span>
                                </div>
                                <div class="timeline-value">ÊàêÂäüÂáèÈáç ${kg} ÂÖ¨Êñ§ÔºÅ</div>
                                <div class="timeline-note">‰ªé ${startWeight.toFixed(1)}kg Âà∞ ${targetWeight.toFixed(1)}kg</div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        function updateChart() {
            const canvas = document.getElementById('weightChart');
            const ctx = canvas.getContext('2d');

            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Use filtered data
            const filteredData = getFilteredWeightData();

            if (filteredData.length < 2) {
                ctx.font = '24px Caveat';
                ctx.fillStyle = '#95a5a6';
                ctx.textAlign = 'center';
                ctx.fillText('Ê∑ªÂä†Êõ¥Â§öËÆ∞ÂΩïÊù•Êü•ÁúãÊõ≤Á∫øÂõæ üìà', canvas.width / 2, canvas.height / 2);
                return;
            }

            const padding = 50;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;

            const weights = filteredData.map(d => d.weight);
            const minWeight = Math.min(...weights) - 2;
            const maxWeight = Math.max(...weights) + 2;
            const weightRange = maxWeight - minWeight;

            // Draw sketchy grid lines
            ctx.strokeStyle = 'rgba(44, 62, 80, 0.15)';
            ctx.lineWidth = 1.5;

            for (let i = 0; i <= 4; i++) {
                const y = padding + (chartHeight / 4) * i;

                ctx.beginPath();
                for (let x = padding; x <= canvas.width - padding; x += 10) {
                    const offsetY = (Math.random() - 0.5) * 2;
                    if (x === padding) {
                        ctx.moveTo(x, y + offsetY);
                    } else {
                        ctx.lineTo(x, y + offsetY);
                    }
                }
                ctx.stroke();

                const weight = maxWeight - (weightRange / 4) * i;
                ctx.font = '15px Patrick Hand';
                ctx.fillStyle = '#7f8c8d';
                ctx.textAlign = 'right';
                ctx.fillText(weight.toFixed(1), padding - 15, y + 5);
            }

            // Draw prediction line
            const predictedWeight = predictWeight();
            if (predictedWeight !== null && settings.goalWeight) {
                const goalY = padding + chartHeight - ((settings.goalWeight - minWeight) / weightRange) * chartHeight;
                const predY = padding + chartHeight - ((predictedWeight - minWeight) / weightRange) * chartHeight;

                ctx.strokeStyle = 'rgba(168, 230, 207, 0.4)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                for (let x = padding; x <= canvas.width - padding; x += 15) {
                    const offsetY = (Math.random() - 0.5) * 3;
                    if (x === padding) {
                        ctx.moveTo(x, predY + offsetY);
                    } else {
                        ctx.lineTo(x, predY + offsetY);
                    }
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Draw goal line
            if (settings.goalWeight) {
                const goalY = padding + chartHeight - ((settings.goalWeight - minWeight) / weightRange) * chartHeight;

                ctx.strokeStyle = 'rgba(231, 76, 60, 0.4)';
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                for (let x = padding; x <= canvas.width - padding; x += 15) {
                    const offsetY = (Math.random() - 0.5) * 3;
                    if (x === padding) {
                        ctx.moveTo(x, goalY + offsetY);
                    } else {
                        ctx.lineTo(x, goalY + offsetY);
                    }
                }
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.font = '14px Patrick Hand';
                ctx.fillStyle = '#e74c3c';
                ctx.textAlign = 'right';
                ctx.fillText(`ÁõÆÊ†á ${settings.goalWeight}`, canvas.width - padding + 5, goalY - 5);
            }

            // Draw sketchy line
            ctx.strokeStyle = '#a8e6cf';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.beginPath();

            let firstPoint = true;
            filteredData.forEach((item, index) => {
                const x = padding + (chartWidth / (filteredData.length - 1)) * index;
                const baseY = padding + chartHeight - ((item.weight - minWeight) / weightRange) * chartHeight;
                const y = baseY + (Math.random() - 0.5) * 3;

                if (firstPoint) {
                    ctx.moveTo(x, y);
                    firstPoint = false;
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // Second pass
            ctx.strokeStyle = 'rgba(168, 230, 207, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();

            firstPoint = true;
            filteredData.forEach((item, index) => {
                const x = padding + (chartWidth / (filteredData.length - 1)) * index;
                const baseY = padding + chartHeight - ((item.weight - minWeight) / weightRange) * chartHeight;
                const y = baseY + (Math.random() - 0.5) * 5;

                if (firstPoint) {
                    ctx.moveTo(x, y);
                    firstPoint = false;
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // Draw hand-drawn points
            filteredData.forEach((item, index) => {
                const x = padding + (chartWidth / (filteredData.length - 1)) * index;
                const y = padding + chartHeight - ((item.weight - minWeight) / weightRange) * chartHeight;

                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                for (let angle = 0; angle <= Math.PI * 2; angle += 0.3) {
                    const radius = 12 + (Math.random() - 0.5) * 3;
                    const px = x + Math.cos(angle) * radius;
                    const py = y + Math.sin(angle) * radius;
                    if (angle === 0) {
                        ctx.moveTo(px, py);
                    } else {
                        ctx.lineTo(px, py);
                    }
                }
                ctx.closePath();
                ctx.stroke();

                ctx.fillStyle = '#ffffff';
                ctx.fill();

                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fillStyle = '#a8e6cf';
                ctx.fill();
            });

            // Date labels
            ctx.font = '13px Patrick Hand';
            ctx.fillStyle = '#7f8c8d';
            ctx.textAlign = 'center';

            const labelInterval = Math.ceil(filteredData.length / 5);
            filteredData.forEach((item, index) => {
                if (index % labelInterval === 0) {
                    const x = padding + (chartWidth / (filteredData.length - 1)) * index;
                    ctx.fillText(formatDate(item.date), x, canvas.height - 15);
                }
            });
        }

        // BMI Chart
        function updateBMIChart() {
            const section = document.getElementById('bmiChartSection');
            const canvas = document.getElementById('bmiChart');
            const ctx = canvas.getContext('2d');

            // Check if we have height set and enough data
            if (!settings.height || weightData.length < 2) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Calculate BMI for each weight entry
            const filteredData = getFilteredWeightData();
            const bmiData = filteredData.map(item => ({
                date: item.date,
                bmi: item.weight / ((settings.height / 100) ** 2)
            }));

            if (bmiData.length < 2) {
                ctx.font = '20px Caveat';
                ctx.fillStyle = '#95a5a6';
                ctx.textAlign = 'center';
                ctx.fillText('ÈúÄË¶ÅÊõ¥Â§öËÆ∞ÂΩïÊù•Êü•ÁúãBMIÊõ≤Á∫ø üìä', canvas.width / 2, canvas.height / 2);
                return;
            }

            const padding = 50;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;

            // BMI zones background
            const zones = [
                { max: 18.5, color: 'rgba(52, 152, 219, 0.1)' },
                { max: 24, color: 'rgba(46, 204, 113, 0.1)' },
                { max: 28, color: 'rgba(243, 156, 18, 0.1)' },
                { max: 40, color: 'rgba(231, 76, 60, 0.1)' }
            ];

            const minBMI = 15;
            const maxBMI = 35;

            zones.forEach(zone => {
                const zoneTop = padding + chartHeight - ((zone.max - minBMI) / (maxBMI - minBMI)) * chartHeight;
                const zoneBottom = zone.max === 40 ? padding + chartHeight : zoneTop;

                ctx.fillStyle = zone.color;
                ctx.fillRect(padding, zoneBottom, chartWidth, zoneTop - zoneBottom);
            });

            // Draw BMI zone lines
            ctx.strokeStyle = 'rgba(44, 62, 80, 0.2)';
            ctx.lineWidth = 1;
            [18.5, 24, 28].forEach(bmi => {
                const y = padding + chartHeight - ((bmi - minBMI) / (maxBMI - minBMI)) * chartHeight;
                ctx.beginPath();
                for (let x = padding; x <= canvas.width - padding; x += 10) {
                    const offsetY = (Math.random() - 0.5) * 2;
                    if (x === padding) ctx.moveTo(x, y + offsetY);
                    else ctx.lineTo(x, y + offsetY);
                }
                ctx.stroke();
            });

            // Draw BMI curve
            ctx.strokeStyle = '#d4a5db';
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.beginPath();

            let firstPoint = true;
            bmiData.forEach((item, index) => {
                const x = padding + (chartWidth / (bmiData.length - 1)) * index;
                const y = padding + chartHeight - ((item.bmi - minBMI) / (maxBMI - minBMI)) * chartHeight;

                if (firstPoint) {
                    ctx.moveTo(x, y);
                    firstPoint = false;
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // Draw points
            bmiData.forEach((item, index) => {
                const x = padding + (chartWidth / (bmiData.length - 1)) * index;
                const y = padding + chartHeight - ((item.bmi - minBMI) / (maxBMI - minBMI)) * chartHeight;

                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let angle = 0; angle <= Math.PI * 2; angle += 0.3) {
                    const radius = 8 + (Math.random() - 0.5) * 2;
                    const px = x + Math.cos(angle) * radius;
                    const py = y + Math.sin(angle) * radius;
                    if (angle === 0) ctx.moveTo(px, py);
                    else ctx.lineTo(px, py);
                }
                ctx.closePath();
                ctx.stroke();

                ctx.fillStyle = '#d4a5db';
                ctx.fill();
            });

            // Y-axis labels
            ctx.font = '12px Patrick Hand';
            ctx.fillStyle = '#7f8c8d';
            ctx.textAlign = 'right';
            for (let bmi = 18; bmi <= 32; bmi += 2) {
                const y = padding + chartHeight - ((bmi - minBMI) / (maxBMI - minBMI)) * chartHeight;
                ctx.fillText(bmi.toFixed(0), padding - 10, y + 4);
            }

            // X-axis labels
            ctx.textAlign = 'center';
            const labelInterval = Math.ceil(bmiData.length / 5);
            bmiData.forEach((item, index) => {
                if (index % labelInterval === 0) {
                    const x = padding + (chartWidth / (bmiData.length - 1)) * index;
                    ctx.fillText(formatDate(item.date), x, canvas.height - 10);
                }
            });
        }

        function exportData(format) {
            if (weightData.length === 0) {
                alert('Ê≤°ÊúâÊï∞ÊçÆÂèØÂØºÂá∫');
                return;
            }

            // Unlock data exporter achievement
            if (!unlockedAchievements.includes('data_exporter')) {
                unlockedAchievements.push('data_exporter');
                localStorage.setItem(UNLOCKED_KEY, JSON.stringify(unlockedAchievements));
                checkAndUnlockAchievements();
            }

            let content, filename, type;

            if (format === 'csv') {
                const headers = ['Êó•Êúü', '‰ΩìÈáç(kg)', 'Â§áÊ≥®'];
                const rows = weightData.map(item => [item.date, item.weight, item.note || '']);
                content = [headers, ...rows].map(row => row.join(',')).join('\n');
                filename = `‰ΩìÈáçËÆ∞ÂΩï_${new Date().toISOString().split('T')[0]}.csv`;
                type = 'text/csv;charset=utf-8;';
            } else {
                content = JSON.stringify(weightData, null, 2);
                filename = `‰ΩìÈáçËÆ∞ÂΩï_${new Date().toISOString().split('T')[0]}.json`;
                type = 'application/json;charset=utf-8;';
            }

            const blob = new Blob([content], { type });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (Array.isArray(imported)) {
                        if (confirm('ÂØºÂÖ•Â∞ÜË¶ÜÁõñÁé∞ÊúâÊï∞ÊçÆÔºåÁ°ÆÂÆöÁªßÁª≠ÂêóÔºü')) {
                            weightData = imported;
                            saveData();
                            updateUI();
                            alert('Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÔºÅ');
                            launchConfetti(30);
                        }
                    } else {
                        alert('Êñá‰ª∂Ê†ºÂºè‰∏çÊ≠£Á°Æ');
                    }
                } catch (err) {
                    alert('ÂØºÂÖ•Â§±Ë¥•Ôºö' + err.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        updateUI();
        window.addEventListener('resize', updateChart);

        // Initialize new features
        initWaterTracker();
        initExerciseLogger();
        initHealthCalculators();

        // Sleep quality selector
        document.querySelectorAll('#sleepQuality .quality-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('#sleepQuality .quality-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                selectedSleepQuality = this.dataset.quality;
            });
        });

        document.getElementById('settingsModal').addEventListener('click', function(e) {
            if (e.target === this) closeSettings();
        });

        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) closeEditModal();
        });

        document.getElementById('measurementsModal').addEventListener('click', function(e) {
            if (e.target === this) closeMeasurementsModal();
        });

        document.getElementById('sleepModal').addEventListener('click', function(e) {
            if (e.target === this) closeSleepModal();
        });

        // Edit modal mood selector
        const editMoodOptions = document.querySelectorAll('#editMoodSelector .mood-option');
        editMoodOptions.forEach(option => {
            option.addEventListener('click', function() {
                editMoodOptions.forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                document.getElementById('editMood').value = this.dataset.mood;
            });
        });
    </script>
</body>
</html>
